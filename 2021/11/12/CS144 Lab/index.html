<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"eimadrigal.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Introduction to Computer Networking">
<meta property="og:type" content="article">
<meta property="og:title" content="CS144 Lab">
<meta property="og:url" content="https://eimadrigal.github.io/2021/11/12/CS144%20Lab/index.html">
<meta property="og:site_name" content="EI Madrigal&#39;s Space">
<meta property="og:description" content="Introduction to Computer Networking">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211103183846716-1107297673.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211104155702139-1679706369.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211104215913218-403717095.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211106090516675-391035638.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211106091008967-598610443.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211207143452338-2049325007.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211207210801604-1226780700.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211118103108010-1947303917.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211211135443937-770319647.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211212162034900-680357364.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211216213718402-1668481893.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211217214005787-1024116698.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211217214722866-2056520012.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211224201911692-472858794.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211222163312884-1740072168.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211225200758037-1347511939.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108112730514-116878135.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220111214607248-1624579305.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220111154943808-1022957497.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220111155822569-889084045.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108170606232-1565549109.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108170639108-1941733275.png">
<meta property="og:image" content="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108170828819-1433823727.png">
<meta property="article:published_time" content="2021-11-12T12:49:00.000Z">
<meta property="article:modified_time" content="2022-01-15T08:08:10.144Z">
<meta property="article:author" content="EIMadrigal">
<meta property="article:tag" content="System">
<meta property="article:tag" content="Network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211103183846716-1107297673.png">

<link rel="canonical" href="https://eimadrigal.github.io/2021/11/12/CS144%20Lab/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>CS144 Lab | EI Madrigal's Space</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">EI Madrigal's Space</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2021/11/12/CS144%20Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CS144 Lab
        </h1>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-11-12 20:49:00" itemprop="dateCreated datePublished" datetime="2021-11-12T20:49:00+08:00">2021-11-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer-Science/" itemprop="url" rel="index"><span itemprop="name">Computer Science</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">Introduction to Computer Networking</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a target="_blank" rel="noopener" href="https://cs144.github.io/">Introduction to Computer Networking</a>æ˜¯Stanfordçš„ç½‘ç»œè¯¾ï¼Œæ®è¯´labè´¨é‡å¾ˆé«˜ï¼Œå°±æŠŠå®ƒä½œä¸ºè½¬Systemåçš„ç¬¬ä¸€ä¸ªå°ç³»ç»Ÿå§ï¼</p>
<h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2>
<p>Stanfordå¤§æ°”ï¼èƒ½è®©æˆ‘ä»¬è¿™äº›é‡é¸¡å­¦æ ¡çš„åŒå­¦æ¥è§¦åˆ°æœ€é¡¶çº§çš„æ•™è‚²èµ„æºï¼Œç”šè‡³å¼€æ”¾äº†labï¼Œä¹Ÿå¸Œæœ›å¤§ä¼™ä¸è¦æŠŠé¢˜è§£poåˆ°githubä¸Šï¼</p>
<p>å› æ­¤æˆ‘åšçš„æ˜¯Fall 2021çš„ç‰ˆæœ¬ï¼Œæ‰€æœ‰çš„starter codeéƒ½åœ¨<a target="_blank" rel="noopener" href="https://github.com/CS144/sponge">è¿™é‡Œ</a>ã€‚</p>
<p>è‡³äºå¦‚ä½•åœ¨è‡ªå·±çš„githubä¸Šå¤‡ä»½ä»£ç ï¼Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10065526/github-how-to-make-a-fork-of-public-repository-private">è¿™é‡Œ</a>ã€‚</p>
<p>è™šæ‹Ÿæœºå¹³å°ç”¨çš„æ˜¯VirtualBoxï¼Œ144å®˜æ–¹æä¾›äº†åŸºäºUbuntuçš„ç³»ç»Ÿé•œåƒï¼ŒCPUå’ŒRAMéšä¾¿è®¾ã€‚</p>
<p>å¤§è‡´æŒ‰ç…§<a target="_blank" rel="noopener" href="https://stanford.edu/class/cs144/vm_howto/">å®˜æ–¹æ–‡æ¡£</a>é…ç½®ç¯å¢ƒï¼Œwindowsç¯å¢ƒå¯ä»¥ç”¨powershellï¼Œæ— éœ€<a target="_blank" rel="noopener" href="https://putty.org/">Putty</a>ã€‚ å¼€å¯è™šæ‹Ÿæœºï¼Œé€šè¿‡ssh clientå»ºç«‹TCPè¿æ¥åˆ°è¿œç¨‹ä¸»æœºçš„æŸç«¯å£ï¼š<code>ssh user@remote -p port</code>ï¼Œ<code>user</code>æ˜¯åœ¨è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·åï¼Œ<code>remote</code>æ˜¯è¿œç¨‹æœºå™¨çš„åœ°å€ï¼ˆIP/åŸŸåï¼‰ï¼Œ<code>port</code>æ˜¯ssh serverç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤22ï¼ˆå³ç™»å½•è¯·æ±‚ä¼šé€è¿›è¿œç¨‹ä¸»æœºçš„22ç«¯å£ï¼‰ï¼Œä¸Šé¢é€šè¿‡-på‚æ•°æ”¹å˜äº†è¯¥ç«¯å£ã€‚</p>
<p>ä¸è¿‡é‡åˆ°äº†ç‚¹é—®é¢˜ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211103183846716-1107297673.png" alt="image" /> å¥‡æ€ªï¼è¿œç¨‹è™šæ‹Ÿæœºæ˜æ˜å®‰è£…äº†sshæœåŠ¡!</p>
<p>ä»ä¸»æœºå»pingè™šæ‹Ÿæœºè¶…æ—¶ï¼Œä½†æ˜¯è™šæ‹Ÿæœºå¯ä»¥pingé€šä¸»æœºï¼Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mengjie88/p/11803879.html">è¿™ä¸ªè®¾ç½®</a>æˆåŠŸpingé€šï¼Œåæ¥å‘ç°å›½å†…çš„è¿™äº›blogéƒ½æ˜¯åœ¨èƒ¡è¯´å…«é“ï¼ŒçœŸæ­£çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆåœ¨<a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/145997/trying-to-ssh-to-local-vm-ubuntu-with-putty">è¿™é‡Œ</a>ï¼Œæœ¬è´¨ä¸Šæ˜¯è™šæ‹Ÿæœºçš„ç«¯å£è½¬å‘æ²¡è®¾ç½®å¥½ï¼Œè®¾ç½®å¥½åVBä¼šæŠŠè¿æ¥localhost:2222çš„TCPè¯·æ±‚è½¬å‘åˆ°è™šæ‹Ÿæœºçš„22å·ç«¯å£ã€‚</p>
<p>å…³äºIDEï¼Œå¼€å§‹ç”¨çš„VIMï¼Œåæ¥æƒ³ç”¨vscodeï¼ŒHostä¸Šå®‰è£…vscodeä»¥åŠremote-sshæ’ä»¶ï¼Œå…³äºé…ç½®ç½‘ä¸Šä¸€å¤§å †æ•™ç¨‹ï¼Œè‡ªè¡Œå­¦ä¹ å§ï¼Œpowershellä»¥åå°±è´Ÿè´£ç¼–è¯‘è¿è¡Œäº†ã€‚</p>
<h2 id="lab-0">Lab 0</h2>
<h3 id="networking-by-hand">Networking by hand</h3>
<p>è¿™äº›å°æ¸¸æˆéƒ½æ˜¯ä¸ºäº†ç¿»è¯‘ç¿»è¯‘ï¼šä»€ä¹ˆæ˜¯å¯é çš„åŒå‘å­—èŠ‚æµï¼Œç½‘ç»œé€šè¿‡è¿™ç§æŠ½è±¡å®Œæˆè®¸å¤šé‡è¦çš„äº¤äº’ï¼Œå¦‚ä¸Šç½‘å†²æµªã€å‘é‚®ä»¶ç­‰ã€‚</p>
<p>ç¬¬ä¸€ä¸ªäº‹æ˜¯è¦æ‰‹åŠ¨æ¨¡æ‹Ÿæµè§ˆå™¨çš„è¯·æ±‚è¿‡ç¨‹ï¼ˆæ³¨æ„æ‰‹é€Ÿï¼Œä¸ç„¶è¿˜æ²¡è¾“å®Œå°±408 Timeoutäº†ï¼‰ï¼š 1. <code>telnet cs144.keithw.org http</code>ï¼š<code>telnet</code>ä½œä¸ºä¸€ç§clientç¨‹åºï¼Œè´Ÿè´£å’ŒæœåŠ¡å™¨çš„æŸä¸ªæœåŠ¡å»ºç«‹è¿æ¥ã€‚ç”¨telnetå®¢æˆ·ç«¯ç¨‹åºåœ¨æœ¬æœºå’ŒæœåŠ¡å™¨ä¹‹é—´å¼€ä¸€ä¸ªå¯é çš„å­—èŠ‚æµï¼Œå¹¶è¯·æ±‚æœåŠ¡å™¨çš„httpæœåŠ¡ï¼ˆ80ç«¯å£ï¼‰ï¼Œè¿æ¥æˆåŠŸè¯æ˜ç«¯å£å¯ç”¨ 2. å»ºç«‹è¿æ¥åå°±è¦é€šè¿‡HTTPåè®®è¯·æ±‚å†…å®¹ï¼šéœ€è¦å‘Šè¯‰æœåŠ¡å™¨æ‰€è¯·æ±‚URLçš„pathå’Œhostï¼š<code>GET /hello HTTP/1.1</code> <code>Host: cs144.keithw.org</code>ï¼Œä¸è¿‡ä¸ºå•¥éœ€è¦hostå‘¢ï¼Ÿéš¾é“æœåŠ¡å™¨ä¸çŸ¥é“è‡ªå·±çš„ipå—ï¼Œå¥½åƒæ˜¯å› ä¸ºæœåŠ¡å™¨å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªç½‘ç«™/æœåŠ¡ 3. <code>Connection: close</code>ï¼šè¡¨ç¤ºå¸Œæœ›æœåŠ¡å™¨ä¸€æ—¦å®Œæˆå“åº”ï¼Œå°±å…³é—­è¿æ¥ 4. è¾“å…¥å›è½¦ï¼ˆç©ºè¡Œï¼‰ï¼šè¡¨ç¤ºHTTPè¯·æ±‚å¤´ç»“æŸï¼Œæ¥ä¸‹æ¥æ˜¯è¯·æ±‚æ•°æ®ï¼ˆå½“ç„¶GETæ²¡æœ‰ï¼ŒPOSTæœ‰ï¼‰</p>
<p>å…¶å®è¿™å°±æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ï¼Œæ•ˆæœï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211104155702139-1679706369.png" alt="image" /> ä½œä¸šå°±æ˜¯çç©ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211104215913218-403717095.png" alt="image" /></p>
<p>ç¬¬äºŒä¸ªäº‹æ˜¯å­¦ç€å‘é‚®ä»¶ï¼Œè¯·æ±‚æœåŠ¡å™¨çš„SMTPæœåŠ¡ï¼ˆä¸»è¦ç”¨æ¥å‘é‚®ä»¶ï¼‰ï¼Œæˆ‘è¯•è¯•å’Œè‡ªå·±çš„é‚®ç®±äº’åŠ¨ä¸‹ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211106090516675-391035638.png" alt="image" /> è¿™é‡Œè¦æ³¨æ„ï¼šé¦–å…ˆè¦å¼€å¯IMAP/SMTPæœåŠ¡ï¼Œè¿˜éœ€è¦è·å–ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ç™»å½•çš„æˆæƒç ï¼Œç™»å½•æ—¶é‚®ç®±åç§°å’Œæˆæƒç éƒ½éœ€è¦Base64æ ¼å¼ã€‚</p>
<p>æ–‡æ¡£é‡Œè¯´Fromåœ°å€æ˜¯å¯ä»¥ä¼ªé€ çš„ï¼Œæœ‰ç‚¹ç¥å¥‡ï¼Œåƒåœ¾é‚®ä»¶å¯èƒ½æŒºå–œæ¬¢å¹²è¿™äº‹ï¼ä½†æ˜¯æˆ‘å®é™…æ“ä½œæ—¶æ˜¯ä¼ªé€ ä¸äº†çš„ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211106091008967-598610443.png" alt="image" /> å› ä¸ºå·²ç»ç™»å½•äº†æœ¬äººè´¦æˆ·ï¼Œæ‰€ä»¥å‘ä»¶äººå¿…é¡»ä¸€è‡´ï¼ŒStanfordé‚£ä¸ªæ²¡æœ‰ç™»å½•ï¼Œä¹Ÿè®¸æ˜¯å•†ä¸šé‚®ä»¶ç³»ç»Ÿä¸€èˆ¬éƒ½æ¯”è¾ƒå®Œå–„ï¼Ÿ</p>
<p>ç¬¬ä¸‰ä¸ªäº‹æ˜¯ä½œä¸ºæœåŠ¡å™¨å»ç›‘å¬ï¼Œä¸»è¦ä½¿ç”¨æ‰€è°“çš„ç‘å£«å†›åˆ€netcatï¼š <code>netcat -v -l -p 9090</code>ï¼š-vè¡¨ç¤ºæ˜¾ç¤ºæ‰§è¡Œå‘½ä»¤è¿‡ç¨‹ï¼Œ-lè¡¨ç¤ºå¼€å¯ç›‘å¬ï¼Œ-pè¡¨ç¤ºåœ¨æŒ‡å®šç«¯å£ç›‘å¬ <code>telnet localhost 9090</code>ï¼š ç„¶åæœåŠ¡å™¨ï¼ˆnetcatï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆtelnetï¼‰å°±å¯ä»¥é€šä¿¡å•¦ï¼</p>
<h3 id="network-program-using-an-os-stream-socket">Network program using an OS stream socket</h3>
<p>è¿™éƒ¨åˆ†è®©åŒå¿—ä»¬åˆ©ç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›çš„stream socketä»Internetä¸ŠæŠ“ç½‘é¡µï¼Œå’Œä¸Šæ–‡ä¸­æ‰‹åŠ¨æŠ“å·®ä¸å¤šï¼Œä¸è¿‡è¿™æ¬¡æ˜¯æŠŠæ‰‹åŠ¨è¿‡ç¨‹å†™æˆä»£ç ã€‚</p>
<p>ç”±äºInternetåªèƒ½æä¾›å°½æœ€å¤§åŠªåŠ›äº¤ä»˜çš„æ•°æ®æŠ¥æœåŠ¡ï¼Œå› æ­¤è¿™äº›æ•°æ®æŠ¥å¯èƒ½ä¼šï¼šä¸¢å¤±ã€ä¹±åºã€å†…å®¹æ›´æ”¹ã€é‡å¤ï¼Œæ‰€ä»¥é€šå¸¸OSä¼šæŠŠInternetçš„è¿™ç§æŠ½è±¡è½¬ä¸ºå¯é çš„åŒå‘å­—èŠ‚æµï¼Œä»¥ä¾¿åº”ç”¨å±‚è½¯ä»¶ä½¿ç”¨ã€‚OSä¸€èˆ¬ä½¿ç”¨socketæ¥å®Œæˆè¿™ç§è½¬å˜å¹¶å‘ç¨‹åºå‘˜æä¾›æ¥å£ï¼Œsocketå’Œæ–‡ä»¶æè¿°ç¬¦ç±»ä¼¼ï¼Œä¸€æ—¦å»ºç«‹è¿æ¥å°±èƒ½è¿›è¡Œå¯é çš„é€šä¿¡ã€‚åç»­ä¼šè‡ªå·±å®ç°ä¸€ä¸ªTCPå»æ£æ‘©è¿™ç§è½¬å˜ã€‚</p>
<p>è¿™ä¸ªç®€å•çš„web clientç¨‹åºæœ‰å‡ ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼š 1. ç”±äº<code>connection: close</code>ï¼Œå› æ­¤æœåŠ¡å™¨åªä¼šå¤„ç†ä¸€æ¬¡httpè¯·æ±‚ 2. æœåŠ¡å™¨å“åº”åå°±ä¼šå…³é—­ä»serveråˆ°clientçš„socketè¿æ¥ï¼Œä½†æ˜¯clientçš„<code>socket.read()</code>å¯ä»¥æŒç»­è¯»ï¼šIf the connection is broken on a stream socket, but data is available, then the read() function reads the data and gives no error. If the connection is broken on a stream socket, but no data is available, then the read() function returns 0 bytes as EOF. 3. EOFä¸€èˆ¬æ˜¯ä¸€ä¸ªå®šä¹‰ä¸º-1çš„å®ï¼Œå› æ­¤æ²¡æœ‰å¯¹åº”çš„ASCIIå­—ç¬¦ï¼Œå› æ­¤ä¹Ÿæ— æ³•æ˜¾ç¤ºå‡ºæ¥ï¼ˆå¯ä»¥å¼ºåˆ¶è½¬intï¼‰ï¼ŒCè¯­è¨€å°†å…¶å®šä¹‰åœ¨æŸä¸ªå¤´æ–‡ä»¶çš„å®é‡Œï¼ˆå¯ä»¥ç›´æ¥ç”¨EOFåˆ¤æ–­ï¼‰ï¼ŒC++ä¸€èˆ¬ä½¿ç”¨å‡½æ•°åˆ¤æ–­ã€‚EOFçš„ä½œç”¨å°±æ˜¯clientå¯ä»¥åˆ¤æ–­æ˜¯å¦è¯»å®Œäº†serverå‘æ¥çš„å“åº”ï¼Œç»ˆç«¯è¾“å…¥windowsç¯å¢ƒæ˜¯ctrl+Zï¼Œlinuxæ˜¯ctrl+D 4. ä¸ºä»€ä¹ˆä¸€ä¸ª<code>read()</code>ä¸å¤Ÿå‘¢ï¼Ÿå› ä¸º<code>read()</code>æ˜¯æœ‰limitçš„ï¼Œè¶…è¿‡ä¸Šé™å°±å¾—å¤šæ¬¡è¯»ï¼Œ<code>std:string FileDescriptor::read(const size_t limit=std::numeric_limits&lt;size_t&gt;::max())</code> 5. åŠæ—¶å…³æ‰socketçš„å†™åŠŸèƒ½æ˜¯ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4160347/close-vs-shutdown-socket">å¥½ä¹ æƒ¯</a></p>
<figure>
<img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211207143452338-2049325007.png" alt="" /><figcaption>image</figcaption>
</figure>
<h3 id="an-in-memory-reliable-byte-stream">An in-memory reliable byte stream</h3>
<p>åœ¨å•æœºä¸Šå®ç°ä¸€ä¸ªå¯é çš„å­—èŠ‚æµï¼ˆå†…å­˜é‡Œå½“ç„¶æ˜¯å¯é çš„ï¼‰ï¼Œwriterå¯ä»¥ç»“æŸå­—èŠ‚æµè¾“å…¥ï¼Œreaderè¯»åˆ°EOFåå°±æ— æ³•ç»§ç»­è¯»ã€‚ åŸºæœ¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹é‡ä¸º<code>capacity</code>çš„bufferï¼Œ<code>capacity</code>ç”¨æ¥è¿›è¡Œæµé‡æ§åˆ¶ï¼Œæ–‡æ¡£è¯´äº†åªä¼šè¿›è¡Œå•çº¿ç¨‹æ“ä½œï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒå¹¶å‘çš„è¯»/å†™ã€‚ éœ€è¦æ³¨æ„ï¼šæµæœ¬èº«å¯ä»¥æ— é™é•¿ï¼Œ<code>capacity</code>å­˜å‚¨çš„æ˜¯å·²ç»å†™å…¥ä½†è¿˜æœªè¯»å–çš„å­—èŠ‚ï¼Œå“ªæ€•<code>capacity = 1</code>ï¼Œåªè¦writeræ¯æ¬¡å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œreaderè¯»èµ°ï¼Œè¿™ä¸ªæµå°±å¯ä»¥æ— é™é•¿ã€‚</p>
<p>å¼€å§‹æƒ³ç”¨<code>queue</code>ï¼Œä½†æ˜¯<code>queue</code>æ— æ³•æ”¯æŒ<code>peek_output</code>æ“ä½œï¼Œé‚£å°±ç”¨<code>deque</code>äº†ã€‚ <code>size_t write(const std::string &amp;data)</code>ï¼šå¦‚æœé•¿åº¦å¤§äº<code>capacity</code>è¯¥å¦‚ä½•å¤„ç†ï¼Ÿè¿™ç§æƒ…å†µå¤šä½™çš„å†™å…¥åªèƒ½è¢«ä¸¢å¼ƒï¼Œå°±å’Œç½‘ç»œä¸Šè¶…å‡ºçº¿è·¯å®¹é‡çš„å†™å…¥è¢«ä¸¢å¼ƒä¸€æ ·ã€‚ <code>size_t bytes_read() const</code>è¿”å›çš„æ˜¯æ‰€æœ‰popçš„å­—èŠ‚æ•°ç›®ï¼ŒåŒ…æ‹¬<code>read(const size_t len)</code>å’Œ<code>pop_output(const size_t len)</code>ã€‚ <code>bool input_ended() const</code>è¿”å›æµè¾“å…¥æ˜¯å¦ç»“æŸï¼›<code>bool eof() const</code>æ˜¯readeråˆ¤æ–­æ˜¯å¦è¯»å–åˆ°äº†æµè¾“å‡ºçš„ç»“æŸä½ç½®ï¼Œå› æ­¤å¿…é¡»æ»¡è¶³writerå·²ç»æœ‰è¿‡å†™å…¥ä¸”bufferä¸ºç©ºã€‚</p>
<p>è®°å¾—å…ˆ<code>make format</code>ï¼Œå†<code>make</code>ç¼–è¯‘ï¼Œæœ€å<code>make check_lab0</code>è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p>
<h2 id="lab-1">Lab 1</h2>
<p>æ¥ä¸‹æ¥çš„4ä¸ªlabè¦è‡ªè¡Œå®ç°ä¸€ä¸ªTCPï¼Œæ¨¡å—å¦‚ä¸‹ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211207210801604-1226780700.png" alt="image" /></p>
<p>ç”±äºsenderä¼šå°†å‘é€çš„å­—èŠ‚æµåˆ†å‰²ä¸ºè‹¥å¹²segmentsï¼Œæ¯æ®µä¸è¶…è¿‡1460Bï¼Œå°è£…ä¸ºæ•°æ®æŠ¥äº¤ç»™ç½‘ç»œä¼ é€ï¼Œä½†è¿™äº›segmentså¯èƒ½ä¼šä¹±åºã€ä¸¢å¤±ã€é‡å¤ã€äº¤å‰é‡å ã€é•¿åº¦ä¸ä¸€ï¼Œä½†æ˜¯ä¸ä¼šå‡ºç°inconsistentçš„æ®µï¼Œå› æ­¤Lab 1è¦å®ç°ä¸€ä¸ªæµé‡ç»„å™¨ï¼Œå°†æ”¶åˆ°çš„å­—èŠ‚æµä¸­çš„segmentsæ‹¼æ¥è¿˜åŸä¸ºå…¶åŸæœ¬æ­£ç¡®çš„é¡ºåºã€‚</p>
<p><code>StreamReassembler</code>ä¼šç”¨ä¸€ä¸ªå¯é å­—èŠ‚æµ<code>ByteStream</code>ä½œä¸ºè¾“å‡ºï¼šas soon as the reassembler knows the next byte of the stream, it will write it into the <code>ByteStream</code>. æ¥ç€åº”ç”¨å±‚å°±å¯ä»¥ä»<code>ByteStream</code>è¯»å–æœ‰åºçš„å­—èŠ‚æµã€‚<code>StreamReassembler</code>å’Œ<code>ByteStream</code>çš„å®¹é‡å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡<code>ByteStream</code>çœŸæ­£çš„sizeï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚</p>
<p><code>push_substring(const string &amp;data, const uint64_t index, const bool eof)</code>ä¸€æ—¦è¶…å‡º<code>StreamReassembler</code>çš„å®¹é‡ï¼Œå°±åªèƒ½ä¸¢å¼ƒè¯¥ç¢ç‰‡ï¼ˆæˆ–è€…ä¸¢å¼ƒéƒ¨åˆ†ï¼‰ï¼› <img src="https://img2020.cnblogs.com/blog/1260581/202111/1260581-20211118103108010-1947303917.png" alt="image" /> æ ¹æ®ä¸Šå›¾ï¼šå¯ä»¥æƒ³è±¡ä¸ºæˆ‘ä»¬æ‹¥æœ‰ä¸€æ¡indexä»0å¼€å§‹çš„æ— é™é•¿çš„å­—èŠ‚æµï¼Œæ¯ä¸ªæ®µéƒ½æœ‰è‡ªå·±åœ¨æµä¸­çš„ä½ç½®ï¼Œéšç€åº”ç”¨å±‚è¯»å–æµä¸­çš„æ•°æ®ï¼Œ<code>StreamReassembler</code>å°±åƒä¸€ä¸ªæ»‘åŠ¨çš„çª—å£ï¼Œè½åœ¨è¯¥çª—å£å†…çš„æ®µéƒ½éœ€è¦è¢«æŒ‰åºç»„è£…ã€‚</p>
<p>æ˜¾ç„¶ï¼Œéœ€è¦ç”¨æŸç§æ•°æ®ç»“æ„æŠŠä¸èƒ½ç›´æ¥å†™å…¥<code>ByteStream</code>ä¸­çš„segmentså­˜èµ·æ¥ï¼š<strong>data+index</strong>å³å¯å”¯ä¸€ç¡®å®šï¼Œå› æ­¤å•ä¸ªsegmentå¯ä»¥ç”¨ç±»ã€ç»“æ„ä½“æˆ–<code>std::pair</code>å­˜å‚¨ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œåœ¨segmentç»“æ„ä½“ä¸­å¢åŠ æˆå‘˜å˜é‡<code>len</code>æ¥æŒ‡ç¤ºå…¶æœ‰æ•ˆé•¿åº¦ã€‚ ç”±äºå¯èƒ½éœ€è¦æ ¹æ®indexå¿«é€ŸæŸ¥æ‰¾åˆå¹¶ä½ç½®ï¼Œå› æ­¤æœ€å¥½æŒ‰åºå­˜å‚¨ï¼Œå¹¶ä¸”è‡ªåŠ¨å»é‡ï¼Œæ‰€æœ‰ä¸èƒ½å†™å…¥çš„segmentså¯ä»¥ç”¨<code>std::set</code>æ¥å­˜ï¼Œåº•å±‚åŸºäºçº¢é»‘æ ‘å®ç°ã€‚</p>
<p>å¤„ç†é€»è¾‘ï¼š 1. æ–°æ¥æ®µæ˜¯å¦è¶…å‡º/éƒ¨åˆ†è¶…å‡ºäº†<code>StreamReassembler</code>çš„çª—å®½ï¼Œå¦‚è¶…è¿‡åˆ™è¿›è¡Œå‰ªåˆ‡ï¼› 2. æ–°æ¥æ®µæ˜¯å¦å’Œ<code>ByteStream</code>ä¹‹å‰ï¼ˆè“è‰²+ç»¿è‰²éƒ¨åˆ†ï¼‰æœ‰é‡å ï¼Œå¦‚æœ‰åˆ™åˆ‡é™¤é‡å éƒ¨åˆ†ï¼› 3. åˆå¹¶æ–°æ®µå’Œæš‚å­˜æ®µï¼šç¡®å®šæ–°æ®µæ’å…¥ä½ç½®ï¼Œä¸æ–­å°†å…¶å‰åçš„æš‚å­˜æ®µå¾€æ–°æ®µä¸Šåˆå¹¶ï¼Œç›´åˆ°æ‰¾ä¸åˆ°å¯ä»¥ç»§ç»­åˆå¹¶çš„æš‚å­˜æ®µï¼› 4. åˆ¤æ–­èƒ½å¦å†™å…¥<code>ByteStream</code>ï¼› 5. <strong>å¤„ç†å</strong>æ–°æ®µçš„eofä¸ºtrueï¼š<del>è‹¥æš‚å­˜åŒºä¸ºç©ºï¼Œç»“æŸå‘<code>ByteStream</code>çš„å†™å…¥</del>ç»“æŸå†™å…¥çš„æ—¶æœºå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨bugï¼Œåé¢æœ‰è¡€æ³ªæ•™è®­ï¼›è‹¥æš‚å­˜åŒºéç©ºï¼Œ<del>æŠ¥é”™</del>ï¼Œå¯èƒ½æ˜¯last segmentå…ˆåˆ°è¾¾ä½†è¿˜ä¸èƒ½å†™å…¥ï¼Œå› æ­¤å­˜å…¥æš‚å­˜åŒºã€‚</p>
<p>æ ¹æ®ä¸Šè¿°é€»è¾‘å‡†å¤‡ç”¨3ä¸ªå‡½æ•°å®Œæˆï¼š 1. <code>void _cut_overlap(segment &amp;seg);</code>å®Œæˆ12 2. <code>void _merge_segs(segment &amp;seg);</code>å®Œæˆ3 3. <code>void _write_to_stream();</code>å®Œæˆ4 4. ç›´æ¥åœ¨<code>push_substring()</code>å¤„ç†5</p>
<p>è¿™ä¸ªå®éªŒä¸€èˆ¬å°±ä¼šå¼€å§‹å‡ºbugï¼Œæˆ‘ç›´æ¥è·ªåœ¨äº†corner caseï¼Œæ¥äº†ä¸€ä¸ªeofä¸º<code>true</code>çš„<code>""</code>ï¼Œç©ºä¸²æ˜¯è¦è¢«å¿½ç•¥çš„ï¼Œä½†æ˜¯è¿™ä¸ªç©ºä¸²å¸¦äº†æˆ‘ä»¬éœ€è¦çš„eofä¿¡æ¯ï¼Œç”±äºåœ¨<code>_cut_overlap</code>ç›´æ¥è¿”å›ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (seg.index &gt;= _first_unacceptable || seg.index + seg.len &lt;= _first_unassembled) <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure> æ‰€ä»¥æ²¡æœ‰æ­£ç¡®è®¾ç½®<code>_eof</code>ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211211135443937-770319647.png" alt="image" /> æµ‹è¯•æ ·ä¾‹<code>t_strm_reassem_single</code>æŠ¥é”™ï¼Œæ‰€æœ‰çš„æµ‹è¯•æºç éƒ½åœ¨<code>./tests</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯¹åº”çš„å¯æ‰§è¡Œç¨‹åºåœ¨<code>./build/tests</code>ã€‚ <code>sudo apt-get install gdb</code>å®‰è£…GDBï¼Œæ‰¾åˆ°å¯¹åº”çš„æµ‹è¯•æºç æ–‡ä»¶<code>fsm_stream_reassembler_single.cc</code>æ‰“æ–­ç‚¹å¼€å§‹è°ƒè¯•ï¼Œè·³å‡º<code>launch.json</code>ç¨ä½œä¿®æ”¹å°±å¯ä»¥æ„‰å¿«åœ°debugï¼ˆé¢å‘æµ‹è¯•ç¼–ç¨‹ğŸ˜‚ï¼‰äº†ï¼š <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;sponge debug&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;cppdbg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/build/tests/$&#123;fileBasenameNoExtension&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;args&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;environment&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span>: <span class="string">&quot;gdb&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Enable pretty-printing for gdb&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;-enable-pretty-printing&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="comment">// &quot;preLaunchTask&quot;: &quot;C/C++: g++-8 build active file&quot;,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerPath&quot;</span>: <span class="string">&quot;/usr/bin/gdb&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åæ¥ç¬¬7ä¸ªæ ·ä¾‹ä¸€ç›´è¿‡ä¸äº†ï¼Œè€Œä¸”Byte Streamå®é™…è¯»å–çš„å­—èŠ‚æ•°å’ŒçœŸå®å€¼å·®è·å¾ˆå¤§ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211212162034900-680357364.png" alt="image" /></p>
<p>æ€€ç–‘æ˜¯æå‰<code>end_input()</code>äº†ï¼Œä¸»è¦æ˜¯ä¸‹é¢è¿™ç§caseï¼š first unassembled=7ä¸”first unacceptableå¾ˆå¤§ï¼Œå…ˆæ¥ä¸€ä¸ª<code>index=9, eof=true</code>çš„""ï¼Œå†æ¥ä¸€ä¸ª<code>index=7, eof=false</code>çš„"ab"ï¼Œå¦‚æœè¿™æ ·åˆ¤æ–­ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (_eof &amp;&amp; _unassembled_bytes == <span class="number">0</span>) &#123;</span><br><span class="line">    _output.<span class="built_in">end_input</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> å¾ˆå®¹æ˜“åœ¨ç¬¬ä¸€ä¸ªæ®µå°±<code>end_input()</code>å¯¼è‡´æå‰ç»“æŸå†™å…¥ã€‚ å› æ­¤æ ¸å¿ƒé—®é¢˜åœ¨äºä»€ä¹ˆæ—¶å€™è°ƒç”¨<code>end_input()</code>ï¼Œæˆ‘ç”¨äº†<code>_eof_index</code>æ¥æŒ‡ç¤ºç»“æŸçš„ä½ç½®è€Œéç”¨å¸ƒå°”å˜é‡<code>_eof</code>ï¼Œä¸€æ—¦<code>_first_unassembled &gt;= _eof_index</code>å°±ç»“æŸè¾“å…¥ã€‚</p>
<h2 id="lab-2">Lab 2</h2>
<p>Lab 2è¦å®ç°<code>TCPReceiver</code>ï¼Œå°†ä»Internetæ¥æ”¶çš„segmentsé€å…¥<code>StreamReassembler</code>è½¬ä¸ºå¯é çš„<code>ByteStream</code>ï¼Œä»¥ä¾›åº”ç”¨å±‚ä»socketè¯»å–ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œ<code>TCPReceiver</code>è¿˜è¦è´Ÿè´£å’Œsenderåé¦ˆï¼š1. first unassembledå­—èŠ‚çš„indexï¼Œä¹Ÿå«åšç¡®è®¤å·<strong>acknowledgment</strong>ï¼Œè¿™æ ·senderæ‰çŸ¥é“ä¸‹æ¬¡è¯¥å‘é€å•¥ï¼›2. first unassembledå’Œfirst unacceptableä¹‹é—´çš„çª—å®½window sizeï¼Œç”¨æ¥å‘Šè¯‰senderå…è®¸å‘é€çš„å­—èŠ‚èŒƒå›´ã€‚ä¸¤è€…ç»“åˆå½¢æˆæ»‘åŠ¨çª—å£ç”¨æ¥è¿›è¡Œ<strong>flow control</strong>ã€‚</p>
<p>ç¬¬ä¸€ä»¶å¿…é¡»è¦å¤„ç†çš„äº‹å°±æ˜¯åºåˆ—å·sequence numberçš„è½¬æ¢ï¼šåœ¨<code>StreamReassembler</code>ä¸­æˆ‘ä»¬ç”¨çš„æ˜¯64ä½çš„stream indexï¼Œå› æ­¤ä¸å¤ªå¯èƒ½æº¢å‡ºï¼Œä½†æ˜¯TCP headerç©ºé—´å®è´µï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå­—èŠ‚çš„indexé‡‡ç”¨32ä½çš„seqnoï¼Œè¿™æ ·å°±å¸¦æ¥å‡ ä¸ªé—®é¢˜ï¼š 1. stream indexå¯ä»¥è¿‘ä¼¼äºæ— é™å¤§ï¼Œä½†æ˜¯seqnoåªèƒ½ä»<span class="math inline">\(0\sim2^{32}-1\)</span>ä¸æ–­å¾ªç¯ï¼› 2. ä¸ºäº†å®‰å…¨èµ·è§ï¼Œseqnoå¹¶ä¸æ˜¯ä»0å¼€å§‹ï¼Œè€Œæ˜¯å–ä¸€ä¸ªéšæœºæ•°Initial Sequence Number(ISN)æ¥è¡¨ç¤ºstreamçš„å¼€å§‹SYN(beginning of stream)ï¼› 3. TCP headerä¸­çš„SYNå’ŒFIN(end of stream)æ ‡å¿—ä½éƒ½è¦è¢«åˆ†é…seqnoï¼Œä½†æ˜¯SYNå’ŒFINå¹¶ä¸æ˜¯çœŸæ­£çš„æ•°æ®ï¼Œåªæ˜¯è¡¨ç¤ºæµçš„å¼€å§‹å’Œç»“æŸã€‚</p>
<figure>
<img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211216213718402-1668481893.png" alt="" /><figcaption>image</figcaption>
</figure>
<table>
<thead>
<tr class="header">
<th>isn</th>
<th>isn+1</th>
<th>isn+2</th>
<th>...</th>
<th>2^32-2</th>
<th>2^32-1</th>
<th>0</th>
<th>1</th>
<th>...</th>
<th>isn-2</th>
<th>isn-1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>2</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>2^32-2</td>
<td>2^32-1</td>
</tr>
<tr class="even">
<td>2^32</td>
<td>2^32+1</td>
<td>2^32+2</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>2^33-2</td>
<td>2^33-1</td>
</tr>
<tr class="odd">
<td>NaN</td>
<td>0</td>
<td>1</td>
<td>...</td>
<td>first unassemble</td>
<td>...</td>
<td></td>
<td>first unacceptable</td>
<td></td>
<td>2^32-3</td>
<td>2^32-2</td>
</tr>
<tr class="even">
<td>2^32-1</td>
<td>2^32</td>
<td>2^32+1</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>2^33-3</td>
<td>2^33-2</td>
</tr>
</tbody>
</table>
<p>ç¬¬ä¸€è¡Œæ˜¯32ä½çš„seqnoï¼Œå¯ä»¥æƒ³è±¡æˆåœ¨åœ†ç¯ä¸Šèµ°è·¯ï¼ˆæ­£åèµ°å‡å¯ï¼‰ï¼ŒäºŒä¸‰è¡Œæ˜¯64ä½çš„absolute seqnoï¼Œå››äº”è¡Œæ˜¯64ä½çš„stream indexã€‚</p>
<p>absolute seqnoè½¬seqnoï¼š<span class="math inline">\(isn+n\%2^{32}\)</span>ï¼Œ<span class="math inline">\(n\)</span>ç›´æ¥å¼ºåˆ¶ç±»å‹è½¬æ¢å³å¯æˆªå–ä½32ä½ã€‚ seqnoè½¬absolute seqnoï¼šæœ‰ç‚¹éº»çƒ¦ï¼Œå¯èƒ½å¯¹åº”å¤šä¸ªç»“æœï¼Œå› æ­¤é€‰æ‹©è·ç¦»<code>checkpoint</code>æœ€è¿‘çš„é‚£ä¸ªç»“æœï¼Œ<code>checkpoint</code>å–å‰ä¸€æ¬¡æ‰€æ”¶æ®µçš„absolute seqnoã€‚åŸå› åœ¨äºä¸¤ä¸ªå‰ååˆ°è¾¾çš„æ®µabsolute seqnoçš„å·®å€¼å‡ ä¹ä¸å¯èƒ½è¶…è¿‡<span class="math inline">\(2^{32}\)</span>ã€‚æœ‰ä¸ªcorner caseæ˜¯å½“<code>checkpoint</code>æ¯”è¾ƒå°æ—¶è®¡ç®—å¾—åˆ°çš„absolute seqnoå¯èƒ½å°äº0ï¼Œéœ€è¦åŠ ä¸Š<span class="math inline">\(2^{32}\)</span>å³<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4201301/warning-left-shift-count-width-of-type"><code>1UL&lt;&lt;32</code></a>ã€‚</p>
<p>åšå¥½ç´¢å¼•çš„è½¬æ¢åï¼Œå› ä¸ºéº»çƒ¦çš„éƒ¨åˆ†å·²ç»åœ¨Lab 1å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®<code>TCPSegment</code>å†™ä¸€äº›ä¸šåŠ¡é€»è¾‘ã€‚ <img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211217214005787-1024116698.png" alt="image" /> æ³¨æ„ä¸‹SYNå’ŒFINå¯¹acknoçš„å¤„ç†å°±è¡Œï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211217214722866-2056520012.png" alt="image" /></p>
<h2 id="lab-3">Lab 3</h2>
<p>è¿™æ¬¡çš„æ´»æ˜¯TCP Senderï¼Œè´Ÿè´£å°†åº”ç”¨å±‚çš„ByteStreamåˆ†å‰²ä¸ºæ®µå‘é€ï¼Œæ ¹æ®æ¥æ”¶æ–¹çš„åé¦ˆæƒ…å†µè¿›è¡Œè¶…æ—¶é‡ä¼ ã€‚</p>
<p>æ¯æ¬¡æ”¶åˆ°æ¥æ”¶æ–¹çš„ACKå°±å¯ä»¥çŸ¥é“å…¶window size, å‘é€æ–¹åœ¨æ¯æ¬¡æ”¶åˆ°ACKæ—¶æ›´æ–°çª—å®½ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡æ”¶åˆ°ACKå‰ï¼Œæ ¹æ®å‘é€æƒ…å†µè®°å½•çª—å£çš„å‰©ä½™å®¹é‡ï¼Œå†³å®šæ˜¯å¦ç»§ç»­å‘é€ã€‚ åªè¦<code>_stream</code>è¿˜æœ‰éœ€è¦å‘é€çš„å†…å®¹å¹¶ä¸”receiverè¿˜æœ‰ç©ºé—²ç©ºé—´ï¼Œ<code>fill_window</code>å°±è¦ä¸€ç›´ç»„è£…æˆæ®µå¹¶å‘é€ç›´åˆ°å¡«æ»¡è¯¥çª—å£ï¼ŒreceiverçœŸæ­£çš„free spaceåº”è¯¥æ˜¯å…¶å£°æ˜çš„çª—å®½å‡å»å·²å‘é€ä½†æœªè¢«ç¡®è®¤çš„æ‰€æœ‰æ®µçš„é•¿åº¦æ€»å’Œï¼Œè¿™ä¸ªfree spaceæ‰æ˜¯å¯ä»¥ä¸æ–­ç»§ç»­ç»„è£…æ–°æ®µå¹¶å‘é€æ—¶å¯ä»¥åˆ©ç”¨çš„ï¼Œåœ¨<code>fill_window</code>ç»„è£…æ–°æ®µä¹‹å‰è¦checkè¯¥ç©ºé—´æ˜¯å¦å¤§äº0ã€‚</p>
<p>å¦å¤–ï¼Œå‘é€çš„ç¬¬ä¸€ä¸ªæ®µæ˜¯SYNæ®µï¼Œæ²¡æœ‰æ•°æ®ï¼Œåªæœ‰SYNå’Œinitial sequence numberï¼ŒSYNæ®µå‘å®Œåå°±è¿”å›ç­‰å¾…receiverçš„connection grantedï¼Œå³ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œæ­¤æ—¶çª—å®½çœ‹ä½œ1ï¼š &gt; What should my TCPSender assume as the receiver's window size before I've gotten an ACK from the receiver? &gt; One byte.</p>
<p>å¹¶ä¸”åœ¨TCP Headerä¸­SYNå’ŒFINä¸èƒ½åŒæ—¶ä¸º1ï¼Œå¦åˆ™åº”è¯¥æŠ¥é”™RSTï¼ŒFINæ®µæ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ã€‚</p>
<p>å¦‚æœæ”¶åˆ°ackè¡¨æ˜çª—å£å¤§å°ä¸º0ï¼Œåœ¨<code>fill_window</code>å½“ä½œ1å¤„ç†ï¼Œä½†æ˜¯è¶…æ—¶çš„æ®µä¸åº”double RTOï¼Œå› ä¸ºè¿™æ˜¯receiverçš„åŸå› è€Œéçº¿è·¯æµé‡é™åˆ¶å¯¼è‡´çš„ï¼Œä½†æ˜¯SYNæ®µè¶…æ—¶éœ€è¦double RTOå¹¶å¢åŠ é‡ä¼ counterï¼Œä»¥ä¾¿åˆ¤æ–­æ˜¯å¦ç»ˆæ­¢æœ¬æ¬¡è¿æ¥è¯·æ±‚ã€‚</p>
<p>FINæ®µçš„å¤„ç†éœ€è¦ä»”ç»†ä¸€äº›ï¼š å¦‚æœ<code>_stream.read</code>ä»¥å<code>_stream.eof()</code>æ„å‘³ç€ByteStreamå·²ç»æ²¡æœ‰éœ€è¦å‘é€çš„ä¸œè¥¿äº†ï¼Œè¿™æ—¶å°±è¦è€ƒè™‘è®¾ç½®FINçš„é—®é¢˜äº†ï¼Œä½†æ˜¯FINæ˜¯è¦å åºåˆ—å·çš„ï¼Œä¹Ÿå°±æ„å‘³ç€è¦åœ¨æ¥æ”¶æ–¹çš„windowé‡Œå ç©ºé—´ï¼Œå¦‚æœfree spaceä¸º50æœ€åä¸€æ®µçš„payload sizeä¸º30ï¼Œé‚£å¯ä»¥è®¾ç½®FINï¼›å¦‚æœfree spaceä¸º50æœ€åä¸€æ®µçš„payload sizeä¸º51ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå­—èŠ‚å°±éœ€è¦è¿›è¡Œä¸‹ä¸€æ¬¡å‘é€ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡è€ƒè™‘FINçš„è®¾ç½®é—®é¢˜ï¼›å¦‚æœfree spaceä¸º50æœ€åä¸€æ®µçš„payload sizeä¹Ÿä¸º50ï¼Œé‚£ä¹ˆè¿™æ®µæ•°æ®å¯ä»¥å‘é€ï¼Œä½†æ˜¯è¿™æ¬¡æ²¡æ³•è®¾ç½®FINäº†ï¼Œä¹Ÿå°±åªèƒ½ç­‰åˆ°æ¥æ”¶æ–¹è…¾å‡ºç©ºé—´åæ‰èƒ½ç»§ç»­ã€‚å› æ­¤åªæœ‰free spaceä¸¥æ ¼å¤§äºæœ€åä¸€æ®µçš„payload sizeæ‰å¯ä»¥è®¾ç½®FINã€‚</p>
<p><code>fill_window</code>æœ‰ä¸€ç§æƒ…å†µï¼Œfree spaceè¿˜æœ‰ä½†æ˜¯<code>_stream.buffer_empty()</code>å·²ç»ç©ºäº†ï¼Œä½†æ˜¯åªæ˜¯æ•°æ®å‘å®Œäº†ï¼ŒFINæ ‡å¿—è¿˜æ²¡å‘ï¼Œå°±éœ€è¦å†å‘ä¸€ä¸ªæ®µï¼Œå› æ­¤è¿™æ ·å†™æ˜¯ä¸è¡Œçš„ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!_stream.<span class="built_in">buffer_empty</span>() &amp;&amp; _receiver_free_space) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211224201911692-472858794.png" alt="" /><figcaption>image</figcaption>
</figure>
<p>å¯ä»¥ç›´æ¥å¤šå¾ªç¯ä¸€æ¬¡ç„¶åç”¨segmentçš„<code>length_in_sequence</code>åˆ¤æ–­æµæ˜¯å¦çœŸçš„ç©ºäº†ä»¥åŠæ˜¯å¦è¦ç»§ç»­å‘é€ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (_receiver_free_space) &#123;</span><br><span class="line">    <span class="keyword">size_t</span> payload_size =</span><br><span class="line">        <span class="built_in">min</span>(&#123;_stream.<span class="built_in">buffer_size</span>(), <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(_receiver_free_space),</span><br><span class="line">             TCPConfig::MAX_PAYLOAD_SIZE&#125;);</span><br><span class="line">    TCPSegment seg;</span><br><span class="line">    <span class="keyword">if</span> (_stream.<span class="built_in">eof</span>() &amp;&amp;</span><br><span class="line">        <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(_receiver_free_space) &gt; payload_size) &#123;</span><br><span class="line">        seg.<span class="built_in">header</span>().fin = <span class="literal">true</span>;</span><br><span class="line">        _fin = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    seg.<span class="built_in">payload</span>() = <span class="built_in">Buffer</span>(_stream.<span class="built_in">read</span>(payload_size));</span><br><span class="line">    <span class="keyword">if</span> (seg.<span class="built_in">length_in_sequence_space</span>() == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    _send_segment(seg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> ä½†æ˜¯è¿™æ ·å¯èƒ½å¯¼è‡´ä¸€ç›´å‘é€åªåŒ…å«FINçš„æ®µï¼Œå› æ­¤è¦åœ¨whileå¾ªç¯é™å®š<code>_fin</code>æ¥ç¡®ä¿åªå‘ä¸€æ¬¡FINæ®µã€‚</p>
<p>å…³äºé‡ä¼ ï¼Œé—²æ¥æ— äº‹ï¼ŒæŠŠé‡ä¼ è®¡æ—¶å™¨å•ç‹¬å†™ä¸€ä¸ªç±»ï¼Œå› ä¸ºè¿™ä¸ªç±»ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥å°±å’Œsenderæ”¾åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶å§ï¼Œä¸è¿‡æ®è¯´æœ‰äº›å…¬å¸çš„coding guidelineæœ‰è§„å®šï¼š &gt; Each class shall have it's own header and implementation file.</p>
<p>é‡‡ç”¨ç´¯è®¡ç¡®è®¤ï¼šå¦‚æœå‘é€æ–¹æ”¶åˆ°acknoä»£è¡¨ä¹‹å‰çš„æ‰€æœ‰æ®µéƒ½æ­£å¸¸æ¥æ”¶ï¼Œå› æ­¤ç”¨<code>std::queue</code>å­˜æ²¡æœ‰æ”¶åˆ°ackçš„æ®µï¼ˆåŒ…æ‹¬åªè¢«ackäº†ä¸€éƒ¨åˆ†çš„æ®µï¼‰ï¼Œè¶…æ—¶åä»é˜Ÿå¤´å¼€å§‹ä¼ ã€‚ <code>_segments_outstanding</code>å‘é€æ—¶åœ¨<code>std::queue</code>é‡Œæ˜¯æŒ‰ç…§seqnoæœ‰åºçš„ï¼Œåªæœ‰æ¯æ¬¡æ”¶åˆ°ackæ‰ä»<code>std::queue</code>é‡Œæ‰”æ‰ä¸€äº›å·²ç»è¢«å®Œå…¨ç¡®è®¤æ”¶åˆ°çš„æ®µï¼Œå¦åˆ™è®¤ä¸º<code>std::queue</code>é‡Œçš„æ‰€æœ‰æ®µæ¥æ”¶æ–¹å‡æœªæ”¶åˆ°ã€‚</p>
<p>æ”¶åˆ°ackå¹¶æ¸…ç†å®Œ<code>_segments_outstanding</code>åï¼Œå¦‚æœæ­¤æ—¶è¿˜æœ‰æœªè¢«ç¡®è®¤çš„æ®µï¼Œé‡å¯è®¡æ—¶å™¨å¹¶å°†RTOå’Œé‡ä¼ counteræ¢å¤åˆå§‹å€¼ã€‚ æ³¨æ„æ”¶åˆ°çš„ackå¯èƒ½æ˜¯éæ³•çš„ï¼Œæ¯”å¦‚ackäº†ä¸€ä¸ªè¿˜æ²¡æœ‰å‘é€çš„æ®µæˆ–è€…ackäº†å·²ç»æ”¶åˆ°çš„æ®µçš„åºåˆ—å· è¿˜æœ‰ä¸€ä¸ªcorner caseåœ¨<code>send_extra.cc</code>çš„95è¡Œï¼Œå¦‚æœæ”¶åˆ°äº†ä¸ä¸Šæ¬¡ç›¸åŒçš„ackï¼Œè®¡æ—¶å™¨æ˜¯ä¸åº”è¯¥é‡å¯çš„ï¼Œé‡ä¼ æ—¶åªæœ‰æ”¶åˆ°çš„acknoä¸¥æ ¼å¤§äºä¸Šä¸€æ¬¡çš„acknoæ‰é‡å¯ã€‚</p>
<p>è®¡æ—¶å™¨çš„å¯åŠ¨å¯ä»¥å‚è€ƒè¯¾æœ¬ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211222163312884-1740072168.png" alt="image" /></p>
<h2 id="lab-4">Lab 4</h2>
<p>æœ¬æ¬¡å®éªŒè¦å®ç°<code>TCPConnection</code>è´Ÿè´£å°†åŒä¸€ä¸ªä¸»æœºå†…çš„<code>TCPSender</code>å’Œ<code>TCPReceiver</code>è¡”æ¥èµ·æ¥ï¼Œç†è®ºä¸Šå¦‚æœ<code>TCPSender</code>å’Œ<code>TCPReceiver</code>è¶³å¤Ÿé²æ£’ï¼Œé‚£ä¹ˆ<code>TCPConnection</code>å†™èµ·æ¥å¾ˆå¿«ï¼Œç„¶è€Œç°å®å¤ªè¿‡å†°å†·...ç¬¬ä¸€æ¬¡åœ¨é¡¹ç›®ä¸­ä½“ä¼šåˆ°æµ‹è¯•çš„é‡è¦æ€§ï¼Œä¹Ÿæœ‰ç‚¹ç†è§£TDDçš„å¥½å¤„äº†ï¼Œå¥½çš„æµ‹è¯•ä¸ä»…èƒ½å¤Ÿå‘ç°é—®é¢˜ï¼Œè¿˜èƒ½æ ¹æ®æµ‹è¯•æ ·ä¾‹debugï¼Œå†æ¬¡è·ªè°¢Stanford~</p>
<p><code>TCPConnection</code>æ—¢å……å½“æ¥æ”¶è€…ï¼Œä¹Ÿå……å½“å‘é€è€…ï¼Œå¯ä»¥ç†è§£ä¸ºå®ç°ä»¥åå°±å¯ä»¥åœ¨ä½ è‡ªå·±çš„ä¸»æœºä¸Šä½¿ç”¨ï¼Œæ¥æ”¶åˆ«äººçš„æ¶ˆæ¯ï¼Œå‘é€è‡ªå·±çš„æ¶ˆæ¯ã€‚</p>
<p>é€šè¿‡<code>segment_received</code>æ”¶åˆ°TCPæ®µåï¼š</p>
<ul>
<li>å¦‚æœRSTä¸ºçœŸï¼Œsenderå’Œreceiveréƒ½è¦å°†å…¶å­—èŠ‚æµè®¾ç½®ä¸ºå‡ºé”™çŠ¶æ€å¹¶ç«‹å³ç»ˆæ­¢è¿æ¥ï¼›</li>
<li><code>TCPReceiver</code>è·å–è‡ªå·±éœ€è¦çš„ä¿¡æ¯ï¼šseqno, SYN, payload, FINã€‚å¦‚æœACKä¸ºçœŸï¼Œéœ€è¦å‘Šè¯‰<code>TCPSender</code>ç›¸å…³ä¿¡æ¯ï¼šackno, window sizeã€‚</li>
<li><strong>åªè¦æ”¶åˆ°äº†<code>length_in_sequence&gt;0</code>çš„æ®µéƒ½éœ€è¦å‘ACKï¼Œå¦‚æœsenderè¦å‘æ•°æ®é‚£å¯ä»¥é¡ºä¾¿æºå¸¦ACKï¼Œå¦åˆ™å°±è¦å‘ç©ºACK</strong>ï¼Œä¾¿äºpeeræ›´æ–°acknoå’Œwindow sizeã€‚æˆ‘é‡åˆ°çš„ç¬¬ä¸€ä¸ªcorner caseå°±æ˜¯ç©ºACKæ®µï¼ˆæ¯”å¦‚ç¬¬3æ¬¡æ¡æ‰‹ï¼‰ï¼Œç”±äºLab 3çš„senderåªå…³æ³¨acknoå’Œwindow sizeï¼Œé€šè¿‡è¦å‘é€çš„segçš„<code>length_in_sequence</code>åˆ¤æ–­æ˜¯å¦ç»§ç»­å‘é€ï¼Œç¬¬äºŒæ¬¡æ¡æ‰‹æ”¶åˆ°ä¸€ä¸ªpayloadä¸º0çš„æ®µï¼Œä»¥åæ­£å¸¸äº¤æµæ˜¯ä¸ä¼šè¿™æ ·çš„ï¼Œå› æ­¤ç¬¬ä¸‰æ¬¡æ¡æ‰‹åº”è¯¥å›ä¸€ä¸ªæ®µï¼ˆå¯å¸¦å¯ä¸å¸¦æ•°æ®ï¼‰ï¼Œä½†æ˜¯Lab 3çš„<code>fill_window</code>é‡åˆ°è¿™ç§æƒ…å†µä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå‘é€ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå‘é€ä¸€ä¸ªç©ºACKæ®µä½œä¸ºç¬¬ä¸‰æ¬¡æ¡æ‰‹ã€‚</li>
</ul>
<figure>
<img src="https://img2020.cnblogs.com/blog/1260581/202112/1260581-20211225200758037-1347511939.png" alt="" /><figcaption>ä¸‰æ¬¡æ¡æ‰‹</figcaption>
</figure>
<ul>
<li><p>è¿˜æœ‰æ”¶åˆ°keep-aliveæ®µçš„å¤„ç†ï¼špeerå¯èƒ½å‘é€äº†ä¸€ä¸ªéæ³•åºåˆ—å·çš„ç©ºACKæ®µæ¥åˆ¤æ–­è¿æ¥æ˜¯å¦æ­£å¸¸å¹¶è·å–æˆ‘æ–¹çš„window sizeï¼Œéœ€è¦å›åº”ç©ºACKæ®µã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (_receiver.<span class="built_in">ackno</span>().<span class="built_in">has_value</span>() &amp;&amp; seg.<span class="built_in">length_in_sequence_space</span>() == <span class="number">0</span></span><br><span class="line">      &amp;&amp; seg.<span class="built_in">header</span>().seqno == _receiver.<span class="built_in">ackno</span>().<span class="built_in">value</span>() - <span class="number">1</span>) &#123;</span><br><span class="line">      _sender.<span class="built_in">send_empty_segment</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">`TCPSender`è´Ÿè´£ç”Ÿæˆè¦å‘é€çš„æ®µå¹¶å¡«å……ç›¸å…³ä¿¡æ¯ï¼šseqno, SYN, payload, FINã€‚å¹¶ä¸”ä»`TCPReceiver`è·å–acknoå’Œwindow sizeè¿›è¡Œå¡«å……ï¼Œå¦‚æœæœ‰acknoè¿˜è¦å¡«å……ACKã€‚</span><br><span class="line"></span><br><span class="line">`tick`è¿™é‡Œå¦‚æœè¶…è¿‡æœ€å¤§é‡ä¼ æ¬¡æ•°ï¼Œä¸ä»…éœ€è¦å…³é—­è¿æ¥ï¼Œè¿˜è¦ç»™peerå‘é€RSTæ®µï¼šå¦‚æœsenderçš„`<span class="built_in">segments_out</span>()`ä¸ç©ºï¼Œç›´æ¥å°†é˜Ÿå¤´çš„æ®µè®¾ä¸ºRSTï¼Œå¦åˆ™è°ƒç”¨`<span class="built_in">send_empty_segment</span>()`è®¾ç½®RSTå¹¶å‘é€ã€‚</span><br><span class="line"></span><br><span class="line">æ¯”è¾ƒæŠ½è±¡çš„æ˜¯TCPçš„å…³é—­è¿™éƒ¨åˆ†ï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åˆæ­¥å†™å®Œä»£ç åï¼Œå°±å¯¹ç€æµ‹è¯•æ ·ä¾‹ç–¯ç‹‚è°ƒbugå§ï¼ï¼</span><br><span class="line"></span><br><span class="line">æœ‰æ—¶å€™æ‰“æ–­ç‚¹ä¼šçè·³ï¼Œæ®è¯´æ˜¯ç¼–è¯‘ä¼˜åŒ–çš„é—®é¢˜ï¼Œ</span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220104111823209-669239914.png)</span></span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220104113021977-665516588.png)</span></span><br><span class="line"></span><br><span class="line">è¿˜æœ‰synçš„å¤„ç†éœ€è¦è€ƒè™‘ä½œä¸ºæ¥æ”¶æ–¹å’Œå‘é€æ–¹ä¸¤ç§æƒ…å†µåˆ†åˆ«å¤„ç†</span><br><span class="line"></span><br><span class="line">`txrx.sh`çš„æµ‹è¯•ä¸å¥½è¿‡</span><br><span class="line"></span><br><span class="line">è°ƒå•ä¸ªæµ‹è¯•ç”¨ä¾‹ctest -R test_name</span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220104161235764-1555046156.png)</span></span><br><span class="line"></span><br><span class="line">å»ºè®®æŒ‰ç…§çŠ¶æ€æœºæ¥å†™ï¼Œå¦åˆ™ä¼šè¢«ç»†èŠ‚æŠ˜ç£¨æ­»ã€‚å…¶å®ä¸ä¸€å®šéè¦æŒ‰ç…§çŠ¶æ€æœºå»å†™</span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220104180142069-201294829.png)</span></span><br><span class="line"></span><br><span class="line">ç¥å‘€ï¼<span class="number">104</span><span class="number">-160</span>ä¸€ç›´è¿‡ä¸äº†ï¼Œæ— å¥ˆåªèƒ½é€šè¿‡æ›¿æ¢ç½‘ä¸Šçš„æ¨¡å—æ‰¾bug</span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220104213010425-1104108783.png)</span></span><br><span class="line">ä½†æ˜¯lab0<span class="number">-4</span>å…¨éƒ¨æ›¿æ¢ä»ç„¶æ˜¯é‚£ä¸ªbugï¼Œä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜ã€‚ã€‚ã€‚ä¸¥é‡æ€€ç–‘ç”±äºæœåŠ¡å™¨åœ¨ç¾å›½çš„åŸå› </span><br><span class="line"></span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220104220146252-1499569230.png)</span></span><br><span class="line"></span><br><span class="line">æŠ˜è…¾vmwareï¼Œè‡ªå·±é…ç¯å¢ƒï¼ŒG++æ³¨æ„è®¾å¥½åhttps:<span class="comment">//blog.csdn.net/kenkao/article/details/89550641?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-4.no_search_link&amp;spm=1001.2101.3001.4242.3&amp;utm_relevant_index=7</span></span><br><span class="line"></span><br><span class="line">è¿˜è¦ä¿®æ”¹https:<span class="comment">//www.cnblogs.com/minglee/p/9016306.html</span></span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220105233420579-412125300.png)</span></span><br><span class="line">æ¥ç€å°±å¯ä»¥æ­£å¸¸makeå’Œæµ‹è¯•äº†ã€‚</span><br><span class="line">æ¢åˆ°VMwareæ²¡æœ‰ä»»ä½•æ”¹åŠ¨ä¸€æ¬¡æ€§é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•ï¼š</span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220105234831224-1290189010.png)</span></span><br><span class="line"></span><br><span class="line">æœ‰ç‚¹ç¦»è°±...ç¬¬ä¸€æ¬¡é‡åˆ°ç³»ç»Ÿçº§åˆ«çš„Bugï¼Œå¡äº†ä¸‰å¤©ï¼Œå…¨éƒ¨æ¨¡å—æ›¿æ¢ä¸ºåˆ«äººçš„è¿˜æ˜¯æŒ‚...</span><br><span class="line"></span><br><span class="line">## Lab <span class="number">5</span></span><br><span class="line">å®ç°IP/Ethernetç½‘ç»œæ¥å£ï¼Œä¹Ÿå«ç½‘ç»œé€‚é…å™¨/ç½‘å¡ï¼Œç”¨äºIPæ•°æ®æŠ¥å’Œä»¥å¤ªç½‘å¸§çš„è½¬æ¢ï¼Œå¯ä»¥ä½œä¸ºä¸»æœºçš„TCP/IPåè®®æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè·¯ç”±å™¨çš„ä¸€éƒ¨åˆ†ã€‚</span><br><span class="line">![image](https:<span class="comment">//img2020.cnblogs.com/blog/1260581/202201/1260581-20220114094034373-1300829794.png)</span></span><br><span class="line"></span><br><span class="line">ä¸»æœºä¸peerä¹‹é—´TCPæ®µçš„äº¤äº’ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</span><br><span class="line">- TCP-in-UDP-in-IPï¼šè¿›ç¨‹åªéœ€æä¾›TCPæ®µå’Œç›®çš„åœ°å€ï¼Œå‰©ä¸‹çš„äº‹æƒ…å‡ç”±Linuxçš„`UDPSocket`å®Œæˆã€‚å†…æ ¸è´Ÿè´£æ„é€ UDP/IP/Ethernet headerå¹¶å‘ç»™ä¸‹ä¸€è·³ï¼Œå¹¶ç¡®ä¿æ¯å¯¹socketçš„ç»„åˆéƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¿è¯ä¸åŒè¿›ç¨‹é—´çš„éš”ç¦»ã€‚</span><br><span class="line">- TCP-in-IPï¼šå¤§éƒ¨åˆ†æƒ…å†µä¸‹TCPæ®µéƒ½æ˜¯ç›´æ¥ä½œä¸ºIPæ•°æ®æŠ¥çš„payloadï¼Œéœ€è¦å‘Linuxçš„TUNæ¥å£æä¾›IPæ•°æ®æŠ¥ï¼Œå†…æ ¸è´Ÿè´£æ„é€ Ethernet headerå¹¶é€šè¿‡ç½‘å¡å‘é€ï¼Œå› æ­¤è¿›ç¨‹éœ€è¦è‡ªè¡Œæ„é€ IPå¤´ã€‚</span><br><span class="line">- TCP-in-IP-in-Ethernetï¼šç½‘ç»œæ¥å£`eth0/eth1/wlan0`è´Ÿè´£ç½‘ç»œå±‚å’Œé“¾è·¯å±‚çš„è½¬æ¢ï¼ŒLinuxæä¾›äº†æ›´ä½çº§çš„TAPæ¥å£è´Ÿè´£äº¤æ¢ä»¥å¤ªç½‘å¸§ã€‚</span><br><span class="line"></span><br><span class="line">å¤§éƒ¨åˆ†çš„å·¥ä½œéƒ½åœ¨ARPåè®®ï¼Œæœ‰<span class="number">3</span>ä¸ªå‡½æ•°ï¼š</span><br><span class="line">```cpp</span><br><span class="line"><span class="keyword">void</span> NetworkInterface::<span class="built_in">send_datagram</span>(<span class="keyword">const</span> InternetDatagram &amp;dgram, <span class="keyword">const</span> Address &amp;next_hop);</span><br><span class="line">std::optional&lt;InternetDatagram&gt; NetworkInterface::<span class="built_in">recv_frame</span>(<span class="keyword">const</span> EthernetFrame &amp;frame);</span><br><span class="line"><span class="keyword">void</span> NetworkInterface::<span class="built_in">tick</span>(<span class="keyword">const</span> <span class="keyword">size_t</span> ms_since_last_tick);</span><br></pre></td></tr></table></figure>
<p>å½“<code>TCPConnection</code>æˆ–è€…è·¯ç”±å™¨è¦å‘é€IPæ•°æ®æŠ¥æ—¶ï¼Œéœ€è¦è¯¥å‡½æ•°è½¬ä¸ºä»¥å¤ªç½‘å¸§å¹¶å‘é€ã€‚ å¦‚æœä¸‹ä¸€è·³çš„MACåœ°å€å·²çŸ¥ï¼Œåˆ›å»ºä¸€ä¸ªä»¥å¤ªç½‘å¸§<code>type = EthernetHeader::TYPE_IPv4</code>ï¼Œå°†payloadè®¾ç½®ä¸ºåºåˆ—åŒ–åçš„æ•°æ®æŠ¥ï¼› å¦‚æœä¸‹ä¸€è·³çš„MACåœ°å€æœªçŸ¥ï¼Œå¹¿æ’­ARPè¯·æ±‚æ¥è·å–MACåœ°å€ï¼Œç¼“å­˜å½“å‰IPæ•°æ®æŠ¥ã€‚ä¸ºäº†é¿å…ARPæ³›æ´ªæ”»å‡»ï¼Œå¦‚æœ5så†…æŸä¸ªIPåœ°å€å·²ç»å‘äº†ARPè¯·æ±‚ï¼Œä¸å†é’ˆå¯¹è¯¥IPç»§ç»­å‘é€ARPè¯·æ±‚ã€‚ç†è®ºä¸Šå¦‚æœä¸€ç›´æ”¶ä¸åˆ°ARPå“åº”ï¼Œç½‘ç»œæ¥å£åº”è¯¥å‘æºä¸»æœºå‘é€ICMP host unreachableæŠ¥æ–‡ï¼Œå¹¶ä¸”ä¸¢å¼ƒç›¸åº”çš„IPæ•°æ®æŠ¥ã€‚ åªè¦ARPè¡¨æ²¡æ‰¾åˆ°ï¼Œè¯´æ˜éœ€è¦å­¦ä¹ ç›®æ ‡MACåœ°å€ï¼Œå› æ­¤å‘é€çš„IPæ•°æ®æŠ¥å‡éœ€è¦ç¼“å­˜ã€‚ä¸è®ºæ”¶åˆ°ARPè¯·æ±‚è¿˜æ˜¯å›å¤ï¼Œéƒ½éœ€è¦å­¦ä¹ ARPè¡¨ï¼Œå¦‚æœæ˜¯è¯·æ±‚ï¼Œè¿˜è¦å‘é€ARPå“åº”ã€‚ARPè¡¨ä¸­æ¡ç›®çš„TTLä¸º30sã€‚</p></li>
</ul>
<p>ç”±äºä»¥å¤ªç½‘å¸§åªä¼ é€’ä¸€è·³ï¼Œå¦‚æœæ”¶åˆ°çš„å¸§çš„ç›®æ ‡MACæ—¢ä¸æ˜¯å½“å‰ç½‘ç»œæ¥å£çš„MACä¹Ÿä¸æ˜¯å¹¿æ’­MACå°±å¿½ç•¥ã€‚</p>
<p>å®Œæˆåï¼Œå°±å¯ä»¥å°†<code>webget.cc</code>ä¸­ä½¿ç”¨çš„<code>TCPSocket</code>æ¢æˆ<code>FullStackSocket</code>ï¼Œè¿™æ ·ä»ä¼ è¾“å±‚åˆ°é“¾è·¯å±‚çš„è½¬æ¢éƒ½æ˜¯è‡ªå·±çš„ç»„ä»¶ã€‚</p>
<p>VMwareå¯ä»¥è¿‡ï¼ŒVBè¿˜æ˜¯æŒ‚ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108112730514-116878135.png" alt="image" /></p>
<h2 id="lab-6">Lab 6</h2>
<p>è¿™ä¸ªå®éªŒè¦åŸºäºLab 5çš„<code>NetworkInterface</code>å®ç°ä¸€ä¸ªIPè·¯ç”±å™¨ï¼Œè´Ÿè´£å°†æ¥æ”¶åˆ°çš„æ•°æ®æŠ¥æ ¹æ®è·¯ç”±è¡¨è½¬å‘ï¼šä»å“ªä¸ªç½‘ç»œæ¥å£è½¬å‘ä»¥åŠä¸‹ä¸€è·³çš„IPåœ°å€ã€‚ æˆ‘ä»¬åªè´Ÿè´£æ ¹æ®ç”Ÿæˆçš„è·¯ç”±è¡¨è½¬å‘ï¼Œè‡³äºå¦‚ä½•ç”Ÿæˆè·¯ç”±è¡¨ï¼ˆRIP/OSPF/BGPï¼‰æ— éœ€å…³å¿ƒã€‚ <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220111214607248-1624579305.png" alt="image" /></p>
<p>ç¬¬ä¸€ä¸ªå‡½æ•°<code>void add_route(const uint32_t route_prefix, const uint8_t prefix_length, const optional&lt;Address&gt; next_hop, const size_t interface_num);</code>è´Ÿè´£ä¿å­˜æ¯æ¡è·¯ç”±ä¿¡æ¯ä»¥å¤‡åç»­ä½¿ç”¨ã€‚ <code>route_prefix</code>å’Œ<code>prefix_length</code>å…±åŒç¡®å®šä¸€ä¸ªç½‘æ®µï¼Œæ¯”å¦‚<code>18.47.0.0/16</code>çš„<code>route_prefix=18*2^24+47*2^16,prefix_length=16</code>ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®æŠ¥çš„ç›®çš„IPæ˜¯<code>18.47.x.y</code>é‚£ä¹ˆè¯¥æ¡è·¯ç”±å³åŒ¹é…ã€‚</p>
<p>å¦‚æœè·¯ç”±å™¨ç›´æ¥ç›®çš„ç½‘æ®µï¼Œè·¯ç”±ä¿¡æ¯çš„<code>next_hop</code>ä¸ºç©ºï¼Œç›´æ¥é€šè¿‡<code>NetworkInterface</code>å‘é€åˆ°ç›®çš„IPï¼›å¦‚æœè·¯ç”±å™¨é€šè¿‡å…¶å®ƒè·¯ç”±å™¨è¿æ¥åˆ°ç›®çš„ç½‘æ®µï¼Œè·¯ç”±ä¿¡æ¯çš„<code>next_hop</code>ä¸ºä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„IPã€‚</p>
<p>ç¬¬äºŒä¸ªå‡½æ•°<code>void route_one_datagram(InternetDatagram &amp;dgram);</code>é€šè¿‡æœ€é•¿å‰ç¼€åŒ¹é…æ‰¾åˆ°æœ€ä½³è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„è·¯ç”±åˆ™ä¸¢å¼ƒæ•°æ®æŠ¥ï¼Œå¦‚æœè¯¥æ•°æ®åŒ…çš„<span class="math inline">\(TTL\leq 1\)</span>ä¹Ÿä¸¢å¼ƒï¼Œç†è®ºä¸Šä¸¢å¼ƒæ•°æ®æŠ¥éœ€è¦å‘æºåœ°å€å‘é€ICMPæŠ¥æ–‡ï¼Œå¦åˆ™é€šè¿‡æœ€ä½³è·¯ç”±å¯¹åº”çš„<code>NetworkInterface</code>è½¬å‘ã€‚</p>
<p>è¿™é‡Œçš„abstractionåœ¨äºè·¯ç”±å™¨åªéœ€è¦å…³å¿ƒIPæ•°æ®æŠ¥è€Œæ— éœ€å…³å¿ƒé“¾è·¯å±‚å®ç°ç»†èŠ‚ï¼Œåªæ˜¯é€šè¿‡<code>NetworkInterface</code>ä¸é“¾è·¯å±‚äº¤äº’ã€‚</p>
<p>åœ¨é€šè¿‡ç§»ä½æ¯”è¾ƒä¸¤ä¸ªIPåœ°å€å‰Nä½æ˜¯å¦ç›¸åŒæ—¶ï¼Œéœ€è¦æ³¨æ„32ä½æ•´æ•°å³ç§»32ä½åœ¨C/C++ä¸­æ˜¯<strong>æœªå®šä¹‰è¡Œä¸º</strong>ï¼Œå› æ­¤<code>prefix_length == 0</code>éœ€è¦ç‰¹åˆ¤ã€‚</p>
<h2 id="lab-7">Lab 7</h2>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå®ç°äº†Internetçš„ä¼ è¾“å±‚TCPåè®®ã€ç½‘ç»œå±‚å’Œé“¾è·¯å±‚ä¹‹é—´çš„æ¥å£è½¬æ¢ä»¥åŠè·¯ç”±è½¬å‘ã€‚ è¿™ä¸ªå®éªŒè®©æˆ‘ä»¬ç”¨å®ç°çš„è¿™äº›ç»„ä»¶å’Œå¦ä¸€ä¸ªäººäº¤äº’ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220111154943808-1022957497.png" alt="image" /></p>
<p>ç”±äºå­¦æ ¡å±€åŸŸç½‘å†…çš„IPéƒ½æ˜¯ç§ç½‘åœ°å€ï¼ˆ10.0.0.0/8ï¼Œ172.16.0.0/12ï¼Œ192.168.0.0/16ï¼‰ï¼Œä¸ºäº†äº¤äº’ï¼Œéœ€è¦é€šè¿‡<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/31332694">NATæŠ€æœ¯</a>æ˜ å°„åˆ°å…¬ç½‘IPï¼Œæ‰€ä»¥ä½¿ç”¨äº†<code>cs144.keithw.org/104.196.238.229</code>ä½œä¸ºä¸­ç»§æœåŠ¡å™¨ã€‚ <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220111155822569-889084045.png" alt="image" /></p>
<p>æŒ‰ç…§æ–‡æ¡£äº¤äº’ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108170606232-1565549109.png" alt="image" /> <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108170639108-1941733275.png" alt="image" /></p>
<p>ä»»æ„ä¸€æ–¹æŒ‰<code>ctrl+D</code>å•æ–¹å‘å…³é—­è¿æ¥åï¼Œå°±ä¸èƒ½ç»§ç»­å‘é€æ•°æ®ï¼Œä½†ä»å¯ä»¥ç»§ç»­æ¥æ”¶ç›´åˆ°peerä¹Ÿå…³é—­è¿æ¥ã€‚åŒæ–¹éƒ½å…³é—­åï¼Œä»»æ„ä¸€æ–¹å®Œæˆäº†lingeringä¹‹åè¿æ¥æ‰çœŸæ­£å…³é—­ã€‚</p>
<p>é™¤äº†èŠå¤©ï¼Œè¿˜å¯ä»¥æ”¶å‘æ–‡ä»¶ã€‚</p>
<p>é€šå…³æˆªå›¾ï¼š <img src="https://img2020.cnblogs.com/blog/1260581/202201/1260581-20220108170828819-1433823727.png" alt="image" /></p>
<h2 id="reference">Reference</h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kangyupl/p/stanford_cs144_labs.html">ã€è®¡ç®—æœºç½‘ç»œã€‘Stanford CS144 Lab Assignments å­¦ä¹ ç¬”è®°</a><br />
<a target="_blank" rel="noopener" href="http://yuzijun.life/2021-02/CS144">æ–¯å¦ç¦è®¡ç½‘å®éªŒ / CS144 Lab Assignments</a><br />
<a target="_blank" rel="noopener" href="https://kiprey.github.io/2021/11/cs144-lab0/">CS144è®¡ç®—æœºç½‘ç»œ</a></p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="EIMadrigal WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="EIMadrigal Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>EIMadrigal
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://eimadrigal.github.io/2021/11/12/CS144%20Lab/" title="CS144 Lab">https://eimadrigal.github.io/2021/11/12/CS144 Lab/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/System/" rel="tag"># System</a>
              <a href="/tags/Network/" rel="tag"># Network</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/01/%E9%87%8D%E6%96%B0%E6%80%9D%E8%80%83%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%8F%8A%E8%81%8C%E4%B8%9A%E6%96%B9%E5%90%91%E9%80%89%E6%8B%A9/" rel="prev" title="é‡æ–°æ€è€ƒæœºå™¨å­¦ä¹ åŠèŒä¸šæ–¹å‘é€‰æ‹©">
      <i class="fa fa-chevron-left"></i> é‡æ–°æ€è€ƒæœºå™¨å­¦ä¹ åŠèŒä¸šæ–¹å‘é€‰æ‹©
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/23/Wilcoxon%20signed-rank%20test/" rel="next" title="Wilcoxon signed-rank test">
      Wilcoxon signed-rank test <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC81NTEzOS8zMTYwNw=="></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-0"><span class="nav-number">2.</span> <span class="nav-text">Lab 0</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#networking-by-hand"><span class="nav-number">2.1.</span> <span class="nav-text">Networking by hand</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#network-program-using-an-os-stream-socket"><span class="nav-number">2.2.</span> <span class="nav-text">Network program using an OS stream socket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#an-in-memory-reliable-byte-stream"><span class="nav-number">2.3.</span> <span class="nav-text">An in-memory reliable byte stream</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-1"><span class="nav-number">3.</span> <span class="nav-text">Lab 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-2"><span class="nav-number">4.</span> <span class="nav-text">Lab 2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-3"><span class="nav-number">5.</span> <span class="nav-text">Lab 3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-4"><span class="nav-number">6.</span> <span class="nav-text">Lab 4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-6"><span class="nav-number">7.</span> <span class="nav-text">Lab 6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lab-7"><span class="nav-number">8.</span> <span class="nav-text">Lab 7</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-number">9.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="EIMadrigal"
      src="/images/favicon.png">
  <p class="site-author-name" itemprop="name">EIMadrigal</p>
  <div class="site-description" itemprop="description">Hello World</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">169</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/EIMadrigal" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;EIMadrigal" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:andrew.renj@gmail.com" title="E-Mail â†’ mailto:andrew.renj@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/EIMadrigal" title="cnblogs â†’ https:&#x2F;&#x2F;www.cnblogs.com&#x2F;EIMadrigal" rel="noopener" target="_blank"><i class="fab fa-codiepie fa-fw"></i>cnblogs</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/EIMadrigal" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;EIMadrigal" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">EIMadrigal</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">Total views: <span id="busuanzi_value_site_pv"></span></span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">Total visitors: <span id="busuanzi_value_site_uv"></span></span>
    <span class="post-meta-divider">|</span>

<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);
    var countOffset = 20000;

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset);
            clearInterval(int);
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

</body>
</html>
