<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"eimadrigal.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Hello World">
<meta property="og:type" content="website">
<meta property="og:title" content="EI Madrigal&#39;s Space">
<meta property="og:url" content="https://eimadrigal.github.io/page/5/index.html">
<meta property="og:site_name" content="EI Madrigal&#39;s Space">
<meta property="og:description" content="Hello World">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="EIMadrigal">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://eimadrigal.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>EI Madrigal's Space</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">EI Madrigal's Space</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/11/28/Malloc%20Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/28/Malloc%20Lab/" class="post-title-link" itemprop="url">Malloc Lab</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-28 02:12:00" itemprop="dateCreated datePublished" datetime="2020-11-28T02:12:00+08:00">2020-11-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="basic-info">Basic Info</h2>
<p>è¿™æ˜¯CMU 15-213çš„Malloc Labï¼Œæœ¬æ¥æ²¡æ‰“ç®—åšï¼Œè¢«åŒå­¦å®‰åˆ©äº†ä¸€æ³¢~ éœ€è¦ç”¨Cå®ç°A Dynamic Storage Allocatorï¼Œç±»ä¼¼äº<code>libc</code>ä¸­çš„<code>malloc/free/realloc</code>ï¼Œæ•´ä½“æ¥çœ‹éš¾åº¦è¾ƒå¤§ã€‚</p>
<p>å¼€å§‹æ²¡ä»€ä¹ˆæ€è·¯ï¼Œçœ‹äº†ä¸‹CSAPPåŠ¨æ€å†…å­˜åˆ†é…é‚£ä¸€èŠ‚ã€‚ å†…å­˜çš„åˆ’åˆ†æ˜¯è¿™æ ·å­çš„ï¼š <img src="https://img-blog.csdnimg.cn/2020101116464245.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿è¡Œæ—¶åˆ†é…çš„è™šæ‹Ÿå†…å­˜ä¸»è¦æ˜¯Heapï¼ŒAllocatorå°†å †è§†ä½œä¸åŒsizeçš„å—ï¼ŒAllocatoræœ‰2ç§ï¼š</p>
<ul>
<li>Explicit Allocatorsï¼šéœ€è¦åº”ç”¨ç¨‹åºæ‰‹åŠ¨é‡Šæ”¾ç”³è¯·çš„å†…å­˜å—ï¼Œ<code>malloc/free</code></li>
<li>Implicit Allocatorsï¼šå°±æ˜¯garbage collectors</li>
</ul>
<p><code>malloc</code>è¿”å›çš„å¯¹é½åœ°å€å–å†³äºç¼–è¯‘ç¯å¢ƒï¼Œ32ä½æ˜¯8çš„å€æ•°ï¼Œ64ä½æ˜¯16çš„å€æ•°ï¼›<code>malloc</code>ä¸ä¼šåˆå§‹åŒ–ç”³è¯·çš„å†…å­˜ï¼Œ<code>calloc</code>ä¼šåˆå§‹åŒ–å†…å­˜ä¸º0ã€‚ å †çš„å¢é•¿æ˜¯é€šè¿‡å¢åŠ å†…æ ¸çš„<code>brk</code>æŒ‡é’ˆæ¥å¢åŠ /å‡å°å †ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">sbrk</span><span class="params">(<span class="keyword">intptr_t</span> incr)</span></span>;  <span class="comment">// success: old brk pointer; error: -1</span></span><br></pre></td></tr></table></figure> å¦‚æœ<code>free</code>çš„æ˜¯ä¸€ä¸ªéæ³•æŒ‡é’ˆï¼Œé‚£ä¹ˆç»“æœæœªå®šä¹‰ã€‚</p>
<p>ä¸»è¦å®ç°åœ¨<code>mm.c</code>ä¸­ï¼Œæœ‰4ä¸ªä¸»è¦å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mm_init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">mm_malloc</span><span class="params">(<span class="keyword">size_t</span> size)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mm_free</span><span class="params">(<span class="keyword">void</span> *ptr)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">mm_realloc</span><span class="params">(<span class="keyword">void</span> *ptr, <span class="keyword">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<p><code>mm_init</code>è´Ÿè´£åˆå§‹åŒ–ï¼Œæ¯”å¦‚åˆ†é…åˆå§‹çš„å †ç©ºé—´ï¼ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼› <code>mm_malloc</code>è´Ÿè´£åˆ†é…æŒ‡å®šå¤§å°çš„ç©ºé—´ï¼Œä½†æ˜¯è¿™ä¸ªç©ºé—´å¿…é¡»åœ¨å·²ç»åˆå§‹åŒ–çš„å †é‡Œï¼Œä¸èƒ½ä¸å…¶ä»–ç©ºé—´å†²çªï¼›è¿”å›çš„æŒ‡é’ˆæŒ‰ç…§8Bå¯¹é½ï¼Œä¸<code>libc</code>ä¸­å®ç°çš„<code>malloc</code>ç±»ä¼¼ï¼Œæœ€åä¼šæœ‰ä¸€ä¸ªPKï¼› <code>mm_realloc</code>è´Ÿè´£ï¼š</p>
<ul>
<li><code>ptr</code>ä¸º<code>NULL</code>ï¼Œç­‰ä»·äº<code>void *mm_malloc(size)</code></li>
<li>size=0ï¼Œç­‰ä»·äº<code>mm_free(ptr)</code></li>
<li>å¦‚æœ<code>ptr</code>ä¸ä¸º<code>NULL</code>ï¼ŒæŠŠ<code>ptr</code>æ‰€æŒ‡çš„å†…å­˜å—å¢åŠ /å‡å°åˆ°<code>size</code>ä¸ªå­—èŠ‚ï¼Œè¿”å›æ–°åœ°å€ï¼ˆå¯èƒ½ä¸åŸæ¥çš„å—ç›¸åŒï¼Œä¹Ÿå¯èƒ½ä¸åŒï¼Œå–å†³äºå®ç°æ–¹å¼ã€åŸå—é‡Œå†…ç¢ç‰‡çš„æ•°é‡ä»¥åŠè¯·æ±‚<code>size</code>çš„å¤§å°ï¼‰ï¼Œä¿æŒåŸå—çš„å†…å®¹ä¸å˜ï¼ˆå¦‚æœç”³è¯·å˜å¤§ï¼Œå‰©ä¸‹çš„ç©ºé—´æ˜¯æœªåˆå§‹åŒ–çš„ï¼›å¦‚æœç”³è¯·å˜å°ï¼Œé‚£ä¹ˆåªä¿ç•™<code>size</code>å¤§å°çš„åŸå—å†…å®¹ï¼‰</li>
</ul>
<p><code>memlib.c</code>ä¸ºæˆ‘ä»¬çš„åˆ†é…å™¨æ¨¡æ‹Ÿäº†å†…å­˜ç³»ç»Ÿï¼Œå¯ä»¥è°ƒç”¨é‡Œé¢çš„ä¸€äº›å‡½æ•°ï¼š <code>void *mem_sbrk(int incr)</code>: å°†å †æ‰©å±•<code>incr</code>Bï¼Œå‚æ•°æ˜¯æ­£æ•´æ•°ï¼Œè¿”å›æ–°åˆ†é…çš„å†…å­˜é¦–åœ°å€ï¼› <code>void *mem_heap_lo(void)</code>: è¿”å›å †çš„é¦–åœ°å€ï¼› <code>void *mem_heap_hi(void)</code>: è¿”å›å †çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åœ°å€ï¼› <code>size_t mem_heapsize(void)</code>: è¿”å›å½“å‰å †çš„å¤§å°ï¼› <code>size_t mem_pagesize(void)</code>: è¿”å›ç³»ç»Ÿé¡µé¢å¤§å°ã€‚ ## Implementation é¦–å…ˆæ˜ç¡®è®¾è®¡çº¦æŸæ¡ä»¶ï¼š</p>
<ul>
<li>å¯ä»¥å¤„ç†ä»»æ„çš„è¯·æ±‚é‡Šæ”¾åºåˆ—</li>
<li>è¯·æ±‚éœ€è¦è¢«ç«‹å³å“åº”</li>
<li>å†…å­˜å¯¹é½è¦æ±‚</li>
<li>ä¸èƒ½ä¿®æ”¹å·²ç»åˆ†é…çš„å†…å­˜å—</li>
</ul>
<p>å†æ˜ç¡®è®¾è®¡ç›®æ ‡ï¼š</p>
<ul>
<li>æœ€å¤§åŒ–ååé‡</li>
<li>æœ€å¤§åŒ–å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
<p>ååé‡æœ€å¤§åŒ–ï¼šå•ä½æ—¶é—´å¤„ç†çš„è¯·æ±‚ï¼Œåˆ†é…å¤æ‚åº¦<span class="math inline">\(O(n)\)</span>ï¼Œnæ˜¯ç©ºé—²å—çš„æ•°ç›®ï¼Œé‡Šæ”¾å¤æ‚åº¦<span class="math inline">\(O(1)\)</span>ï¼› å†…å­˜åˆ©ç”¨ç‡æœ€å¤§åŒ–ï¼šç”¨peak utilizationè¡¡é‡ï¼Œå‡è®¾æœ‰<span class="math inline">\(n\)</span>ä¸ªè¯·æ±‚ï¼š<span class="math inline">\(R_0, R_1, ... R_k, ..., R_{n-1}\)</span>ï¼Œåœ¨<span class="math inline">\(R_k\)</span>å®Œæˆåï¼Œå°†aggregate payload(ç”³è¯·çš„å­—èŠ‚æ€»æ•°)è®°ä½œ<span class="math inline">\(P_k\)</span>ï¼Œå½“å‰çš„å †çš„å¤§å°è®°ä½œ<span class="math inline">\(H_k\)</span>(å•è°ƒä¸å‡)ï¼Œå•è°ƒä¸å‡çš„æ¡ä»¶å¯ä»¥é€šè¿‡ä½¿<span class="math inline">\(H_k\)</span>ä¸ºhigh-water markæ¥æ¾å¼›ï¼Œè¿™æ ·å †å°±å¯ä»¥ä¸Šä¸‹éƒ½å¢é•¿ã€‚é‚£ä¹ˆpeak utilizationä¸ºï¼š <span class="math display">\[U_k=\frac{max_{i\leq k}P_i}{H_k}\]</span> æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–<span class="math inline">\(U_{n-1}\)</span>ã€‚</p>
<p>è¿™ä¸¤ç›®æ ‡æ˜¯éœ€è¦trade-offçš„ï¼Œååé‡è¶Šå¤§ï¼Œæ„å‘³ç€éœ€è¦å‡å°æ“ä½œçš„æ—¶é—´ï¼Œå¾€å¾€å°±ä¸èƒ½èŠ±è´¹æ—¶é—´å»å¤„ç†ç¢ç‰‡ï¼›å†…å­˜åˆ©ç”¨ç‡è¶Šå¤§ï¼Œæ„å‘³ç€è¦ç²¾å¿ƒå¤„ç†åˆ†é…å’Œå›æ”¶çš„å—ï¼Œè‡ªç„¶éœ€è¦æ›´å¤šçš„æ—¶é—´ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š <img src="https://img-blog.csdnimg.cn/20201023215211206.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™äº›å…³é”®ç»†èŠ‚çš„è®¾è®¡éå¸¸é‡è¦ï¼Œå†BBä¸€æ¬¡ï¼šç¨‹åºæ¶æ„ã€æ•°æ®ç»“æ„å’Œæ¥å£è®¾è®¡æ˜¯ä¸€é—¨è‰ºæœ¯ï¼</p>
<ul>
<li><code>free</code>åªç»™ä¸€ä¸ªæŒ‡é’ˆï¼Œæ€ä¹ˆçŸ¥é“è¦é‡Šæ”¾å¤šå°‘ç©ºé—´ï¼šè®°å½•æ¯ä¸€å—çš„å¤§å°ï¼›</li>
<li>ç©ºé—²å—çš„ç»„ç»‡ç®¡ç†ï¼šéšå¼é“¾è¡¨ã€æ˜¾å¼é“¾è¡¨ï¼ˆåŒå‘é“¾è¡¨ï¼‰ï¼ˆå­˜å‚¨æŒ‡é’ˆåŸŸå¼€é”€å¤ªå¤§ï¼‰ã€Segregated Free Listsã€å°†ç©ºé—²å—å§‹ç»ˆæŒ‰å¤§å°æ’åºï¼›</li>
<li>Placement: æœ‰å¤šä¸ªæ»¡è¶³è¦æ±‚çš„ç©ºé—²å—ï¼Œå¦‚ä½•é€‰æ‹©ä»¥æ”¾ç½®æ–°çš„ç”³è¯·ï¼šFirst Fit, Next Fit, Best Fit</li>
<li>Splitting: åœ¨ä¸€ä¸ªç©ºé—²å—æ”¾ç½®ç”³è¯·åå¦‚ä½•å¤„ç†å‰©ä½™çš„ç©ºé—²ç©ºé—´ã€‚å¯ä»¥ç›´æ¥å°†æ•´ä¸ªç©ºé—²å—åˆ†é…å‡ºå»ï¼Œä¹Ÿå¯ä»¥å°†å‰©ä½™çš„ç©ºé—²ç©ºé—´é‡æ–°åˆ©ç”¨ï¼›</li>
<li>æ— æ³•æ‰¾åˆ°åˆé€‚çš„æ»¡è¶³è¯·æ±‚çš„å—ï¼šåšç©ºé—²å—åˆå¹¶åå†æ¬¡æ£€æŸ¥æ˜¯å¦å¯ä»¥æ»¡è¶³ï¼›ç”¨<code>sbrk</code>å‘å†…æ ¸ç”³è¯·æ›´å¤šçš„å†…å­˜ï¼Œæ’å…¥ç©ºé—²é“¾è¡¨ï¼›</li>
<li><strong>ç©ºé—²å—åˆå¹¶</strong>ï¼šéœ€è¦è€ƒè™‘ä½•æ—¶åˆå¹¶ï¼šç«‹å³åˆå¹¶ï¼ˆå¯èƒ½å¼•å‘æŠ–åŠ¨ï¼‰ã€å»¶è¿Ÿåˆå¹¶ï¼ˆç”³è¯·å¤±è´¥æ—¶åˆå¹¶æ•´ä¸ªå †é‡Œæ‰€æœ‰çš„ç©ºé—²å—ï¼‰ï¼›åˆå¹¶åé¢çš„å—å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯è¦é«˜æ•ˆåˆå¹¶å‰é¢çš„ç©ºé—²å—ï¼Œéœ€è¦ç”¨åŒå‘çš„Boundary Tag(å¯ä»¥ä¼˜åŒ–ä»¥å‡å°‘ç©ºé—´å¼€é”€)ï¼›</li>
</ul>
<p>ä¸ä»…éœ€è¦è®°å½•æ¯å—çš„å¤§å°ï¼Œè¿˜éœ€è¦åŒºåˆ†å·²åˆ†é…å—å’Œç©ºé—²å—ï¼Œæ‰€ä»¥blockçš„æ ¼å¼å¯ä»¥è®¾è®¡å¦‚ä¸‹ï¼š <img src="https://img-blog.csdnimg.cn/20201011195117307.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å¦‚æœè¦æ±‚double-word(8B)å¯¹é½ï¼Œé‚£ä¹ˆBlock sizeæ€»æ˜¯8çš„å€æ•°ï¼Œæ‰€ä»¥ä½3ä½éƒ½æ˜¯0ï¼Œå¯ä»¥åˆ©ç”¨å…¶å­˜å‚¨åˆ†é…çŠ¶æ€ã€‚</p>
<p>è¿™æ ·æ•´ä¸ªå †å°±å¯ä»¥ç»„ç»‡ä¸ºè¿ç»­çš„åˆ†é…å’Œç©ºé—²å—ï¼Œç”±äºå·²ç»å­˜å‚¨äº†æ¯å—çš„å¤§å°ï¼Œæ‰€ä»¥éšå¼ç©ºé—²é“¾è¡¨å°±åº”è¿è€Œç”Ÿï¼š <img src="https://img-blog.csdnimg.cn/20201014165121101.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> éšå¼é“¾è¡¨å¯ä»¥åœ¨<span class="math inline">\(O(1)\)</span>çš„æ—¶é—´é‡Œåˆå¹¶ä¹‹åçš„ç©ºé—²å—ï¼Œä½†æ˜¯è¦åˆå¹¶ä¹‹å‰çš„ç©ºé—²å—ï¼Œéœ€è¦<span class="math inline">\(O(n)\)</span>çš„æ—¶é—´æ‰«ææ•´ä¸ªå †ï¼Œè¿™æ˜¾ç„¶æ— æ³•æ¥å—ã€‚Knuthå¤§ä½¬æå‡ºäº†boundary tagsï¼Œè¿™æ ·å®é™…ä¸Šç›¸å½“äºéšå¼åŒå‘é“¾è¡¨ï¼š <img src="https://img-blog.csdnimg.cn/20201011214226551.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™æ ·å°±å¯ä»¥é€šè¿‡Footeråœ¨<span class="math inline">\(O(1)\)</span>æ£€æŸ¥ä¹‹å‰çš„å—çš„çŠ¶æ€åŠå…¶å¼€å§‹ä½ç½®ï¼Œç¼ºç‚¹åœ¨äºå¦‚æœå°çš„å†…å­˜å—æ¯”è¾ƒå¤šçš„è¯ï¼Œå†…å­˜å¼€é”€å¤ªå¤§ã€‚ åŒå‘tagå¸¦æ¥çš„å†…å­˜å¼€é”€å¯ä»¥ä¼˜åŒ–ï¼šåªæœ‰å‰é¢çš„å—æ˜¯ç©ºé—²ï¼Œæ‰éœ€è¦å®ƒfooteré‡Œçš„å¤§å°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ¯ä¸ªå—ç”¨å3ä½é‡Œçš„æŸä¸€ä½æ¥å­˜å‚¨å‰é¢å—çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå·²åˆ†é…å—å°±ä¸éœ€è¦footeräº†ï¼Œå¯ä»¥æŠŠfooterçš„ç©ºé—´ç”¨æ¥å½“ä½œpayloadï¼Œä½†æ˜¯ç©ºé—²å—ä»ç„¶éœ€è¦2ä¸ªtagã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æ•´ä¸ªå †å˜æˆäº†è¿™æ ·ï¼š <img src="https://img-blog.csdnimg.cn/20201016204303577.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™é‡Œçš„<code>heap_listp</code>æŒ‡å‘Prologue blockçš„ä¸­é—´æ˜¯åšäº†ä¸€äº›å°ä¼˜åŒ–ï¼Œæ–¹ä¾¿ç›´æ¥å®šä½åˆ°ä¸‹ä¸€å—çš„æ•°æ®ä½ç½®ã€‚</p>
<p>è¿™é‡Œçš„å®ç°éå¸¸trickyå’Œsubtleï¼Œä¸€å¼€å§‹åªç”³è¯·äº†4wordsï¼Œunused(1)+Prologue(2)+Epilogue(1)ï¼Œåç»­çš„<code>extend_heap</code>ç”³è¯·ä¸€ä¸ªç©ºé—²å—åï¼Œå°†åŸæ¥çš„Epilogueä½œä¸ºç©ºé—²å—çš„headerï¼Œç©ºé—²å—çš„æœ€åä¸€ä¸ªwordå˜ä¸ºæ–°çš„Epilogueã€‚</p>
<p>ç”±äºå¯¹é½è¦æ±‚ï¼ˆHeadersåœ¨éå¯¹é½ä½ç½®ï¼ŒPayloadså¯¹é½ï¼‰ï¼Œåˆ†é…å™¨åº”è¯¥æœ‰ä¸€ä¸ªminimum block sizeï¼Œå³ä½¿åªè¯·æ±‚äº†1Bï¼Œä¹Ÿè¦åˆ†é…minimum block sizeï¼Œè¿™é‡Œæ˜¯16Bã€‚</p>
<p>å†™ä»£ç æ—¶å…ˆå®ç°å¹¶æµ‹è¯•<code>malloc</code>å’Œ<code>free</code>ï¼Œå¦‚æœèƒ½æ­£ç¡®å¹¶ä¸”é«˜æ•ˆæ‰§è¡Œï¼Œå†å»å®ç°<code>realloc</code>ã€‚ ## Evaluation æ€§èƒ½ä¸»è¦è€ƒè™‘2æ–¹é¢å› ç´ ï¼š</p>
<ul>
<li>ç©ºé—´åˆ©ç”¨ç‡<span class="math inline">\(U\)</span>ï¼špeak ratioå³è¯„æµ‹ç¨‹åºç”³è¯·çš„æ€»å†…å­˜ï¼ˆ<code>mm_malloc/mm_realloc</code>ä½†æ˜¯è¿˜æ²¡æœ‰<code>mm_free</code>ï¼‰ä¸åˆ†é…å™¨ä½¿ç”¨çš„å †å®¹é‡çš„æ¯”å€¼ï¼Œéœ€è¦ç”¨å¥½çš„ç­–ç•¥å‡å°ç¢ç‰‡ï¼Œä½¿å¾—è¯¥å€¼æ¥è¿‘1ï¼›</li>
<li>ååé‡<span class="math inline">\(T\)</span>ï¼šæ¯ç§’å®Œæˆçš„æ“ä½œæ•°é‡</li>
</ul>
<p>è¯„æµ‹ç¨‹åºä¼šç»¼åˆè€ƒè™‘2ä¸ªæ–¹é¢ï¼Œè®¡ç®—ä¸€ä¸ªperformance index <span class="math display">\[P=wU+(1-w)min(1,\frac{T}{T_{libc}})\]</span> <span class="math inline">\(T_{libc}\)</span>æ˜¯<code>libc</code>ä¸­çš„<code>malloc</code>çš„ååé‡ï¼Œå¤§æ¦‚åœ¨600Kops/så·¦å³ï¼Œ<span class="math inline">\(w=0.6\)</span>ã€‚ è¿™ä¸ª<span class="math inline">\(P\)</span>æ—¢è€ƒè™‘äº†å†…å­˜èµ„æºï¼Œåˆè€ƒè™‘äº†CPUèµ„æºï¼Œä¸¤ä¸ªçŸ›ç›¾çš„æŒ‡æ ‡éœ€è¦é€‚å½“æƒè¡¡ã€‚</p>
<p>ç¬¬ä¸€ä¸ªç‰ˆæœ¬<code>mm1.c</code>åŸºæœ¬å°±æ˜¯æŠ„ä¹¦ï¼ŒImplicit Free Lists+First Fit+Bi Boundary Tagï¼ŒæŠ„ä¹¦ä¹Ÿå°±å°†å°†åŠæ ¼ã€‚ã€‚ <img src="https://img-blog.csdnimg.cn/20201115143013580.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å°†First-Fitæ”¹æˆNext-Fitï¼Œè¿˜ä¸é”™ï¼š <img src="https://img-blog.csdnimg.cn/20201115202312126.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å¯ä»¥çœ‹åˆ°ï¼šNext-Fitåœ¨é€Ÿåº¦ä¸Šæœ‰å¾ˆå¤§æå‡ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒæ˜¯ä»ä¸Šæ¬¡ç»ˆæ­¢çš„å—å¼€å§‹æœç´¢ï¼Œé¿å…äº†å‰é¢å¾ˆå¤šå—çš„æ— æ•ˆæœç´¢ã€‚</p>
<p>æœ€åå¯¹äºImplicit Listsçš„æ€§èƒ½åšä¸ªæ€»ç»“ï¼š åˆ†é…ï¼š<span class="math inline">\(O(n)\)</span> é‡Šæ”¾ï¼š<span class="math inline">\(O(1)\)</span> Memory Overheadï¼šå–å†³äºFirst Fitç­‰ç­–ç•¥</p>
<p>æ„Ÿè§‰è¿™ä¸ªæ€§èƒ½å·²ç»ä¸é”™äº†ï¼Œä½†æ˜¯ä¸€äº›æ— èŠçš„è®¡ç®—æœºç§‘å­¦å®¶è¿˜æ˜¯ä¸æ»¡æ„åˆ†é…æ—¶çš„æ•ˆç‡ã€‚æ¥ç€æˆ‘ä»¬çœ‹ä¸‹æ›´åŠ ğŸ‚ğŸºçš„æ–¹æ³•Segregated Free Listsï¼š <img src="https://img-blog.csdnimg.cn/20201024204031234.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> æ¯ä¸ªsizeçº§åˆ«çš„å—éƒ½æœ‰è‡ªå·±çš„free listï¼Œåˆ†é…å¤§å°ä¸ºnçš„å—æ—¶ï¼š</p>
<ul>
<li>æœç´¢åˆé€‚çš„free listä½¿å¾—size&gt;n</li>
<li>æ‰¾åˆ°ï¼šsplitå¹¶å°†remainderæ”¾å…¥åº”è¯¥å»çš„list</li>
<li>æœªæ‰¾åˆ°ï¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·æ›´å¤§çš„å†…å­˜ï¼Œåˆ†å‡ºå»nï¼Œå°†å‰©ä¸‹çš„æ”¾å…¥ç›¸åº”çš„list</li>
</ul>
<p>é‡Šæ”¾æ—¶åˆå¹¶ç©ºé—²å—å¹¶ä¸”æ”¾å…¥ç›¸åº”çš„free listå³å¯ã€‚</p>
<p>è¿™å®é™…ä¸Šè¿‘ä¼¼æ¨¡æ‹Ÿäº†Best Fitï¼Œè€Œä¸”ä¸ç”¨æœç´¢æ•´ä¸ªfree listï¼ŒBest Fitä¸€èˆ¬æœ‰ç€æœ€ä¼˜çš„å†…å­˜åˆ©ç”¨ç‡ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´<span class="math inline">\(O(n)\)</span>ï¼Œåˆæ˜¯ååé‡å’Œå†…å­˜åˆ©ç”¨ç‡çš„trade-offï¼Œç»ˆäºæ˜ç™½äº†ä¸ºä»€ä¹ˆå®˜æ–¹çš„<code>malloc</code>è¦ç”¨è¿™ä¸ªæ–¹å¼äº†ï¼šååé‡æ›´å¤§<span class="math inline">\(O(lgn)\)</span>ã€æ›´ä¼˜çš„å†…å­˜åˆ©ç”¨ç‡Best Fitã€‚</p>
<p>Segregated Free Listsä¸­çš„ç©ºé—²å—åŒ…å«Header+prev+next+padding+Footerï¼Œå·²åˆ†é…å—æ²¡æœ‰å‰åæŒ‡é’ˆã€‚ å†™ä»£ç è¦æ³¨æ„ï¼šæ•´ä¸ªå †ä¸­çš„å—ä½ç½®æ˜¯ä¸å˜çš„ï¼Œåªæ˜¯çŠ¶æ€ï¼ˆåˆ†é…ã€é‡Šæ”¾ï¼‰åœ¨æ”¹å˜ï¼Œæ•´ä¸ªå †ä¸­çš„ç©ºé—²å—æ˜¯ç”¨seg listçš„æ–¹å¼ä¸²èµ·æ¥çš„ã€‚</p>
<p>Debugå¯ä»¥è‡ªå·±å†™ä¸€ä¸‹<code>mm_check</code>ï¼Œè¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ <code>realloc</code>å¿«deç–¯äº†ï¼Œæ•´æ•´ä¸€ä¸ªæ™šä¸Šã€‚ã€‚ã€‚å…¶å®å°±4ç§æƒ…å†µï¼š</p>
<ol type="1">
<li>å¦‚æœå½“å‰å·²åˆ†é…å—åé¢æ˜¯ç»“å°¾å—ï¼Œç›´æ¥ç”³è¯·æ–°çš„å †ç©ºé—´ï¼Œä¸åŸå—ç»„åˆè¿”å›ï¼›</li>
<li>å¦‚æœå½“å‰å·²åˆ†é…å—åé¢æ˜¯ä¸€ä¸ªç©ºé—²å—ï¼Œä¸”ä¸¤è€…ä¹‹å’Œ&gt;=sizeï¼Œç»„åˆè¿”å›ï¼›</li>
<li>å¦‚æœå½“å‰å·²åˆ†é…å—åæ˜¯ä¸€ä¸ªç©ºé—²å—ï¼Œä½†ä¸¤è€…ä¹‹å’Œ&lt;sizeï¼Œä½†æ˜¯ç©ºé—²å—åæ˜¯ç»“æŸå—ï¼Œç”³è¯·æ–°çš„å †ç©ºé—´ï¼Œä¸‰è€…ç»„åˆè¿”å›ï¼›</li>
<li>mallocæ–°å—ï¼Œå°†åŸå—å¤åˆ¶ï¼Œé‡Šæ”¾åŸå—ã€‚</li>
</ol>
<p>ç¬¬ä¸€æ¬¡å†™å®Œï¼Œåªæœ‰85ï¼Œå†…å­˜åˆ©ç”¨ç‡å¤ªå·®äº†ï¼š <img src="https://img-blog.csdnimg.cn/20201117220719669.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> <code>place</code>çš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·å—æ¯”è¾ƒå¤§ï¼Œæˆ‘ä»¬å°†å…¶åˆ†é…åˆ°ååŠéƒ¨åˆ†ï¼Œå°†å‰åŠéƒ¨åˆ†åˆ‡å‰²ä¸ºç©ºé—²ï¼š <img src="https://img-blog.csdnimg.cn/2020111909030584.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> ä¹‹å‰classçš„åˆ’åˆ†æ˜¯1ï¼Œ2-3ï¼Œ4-7ï¼Œ8-15... ä½†æ˜¯æœ€å°å—æ˜¯16Bï¼Œæ‰€ä»¥16Bä»¥ä¸‹çš„ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥æ”¹ä¸º16-31ï¼Œ32-63ï¼Œ64-127ï¼Œ128-255...</p>
<p>è¿™æ ·ä¼˜åŒ–åç›´æ¥96ï¼š <img src="https://img-blog.csdnimg.cn/20201119092357832.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> åé¢è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–æ¦¨å¹²æ€§èƒ½ï¼Œæ¯”å¦‚å»æ‰å·²åˆ†é…å—çš„Footerï¼Œ<code>realloc</code>ç»„åˆå—ä»¥åå¯¹remainderè¿›è¡Œsplit... ä»¥åæœ‰æ—¶é—´å†è¯´......</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/11/17/Stacking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/17/Stacking/" class="post-title-link" itemprop="url">Stacking</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-17 02:29:00" itemprop="dateCreated datePublished" datetime="2020-11-17T02:29:00+08:00">2020-11-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Ensemble Learningçš„åŸºæœ¬æ€æƒ³å°±æ˜¯å°†å¤šä¸ªåŸºå­¦ä¹ å™¨ç»„åˆåœ¨ä¸€èµ·ï¼Œäº§ç”Ÿæ³›åŒ–èƒ½åŠ›æ›´å¼ºçš„æ¨¡å‹ã€‚ ç»„åˆç­–ç•¥æœ‰è®¸å¤šç§ï¼ŒåŒ…æ‹¬Votingã€å¹³å‡æ³•å’ŒStackingç­‰ï¼ŒStackingå°±æ˜¯é€‰æ‹©æŸç§å­¦ä¹ å™¨ä½œä¸ºç»„åˆåŸºå­¦ä¹ å™¨çš„æ–¹å¼ã€‚ <img src="https://img-blog.csdnimg.cn/20200926193430376.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> æ—¢ç„¶è¦ç»“åˆå¤šä¸ªåŸºå­¦ä¹ å™¨çš„ä¼˜ç‚¹ï¼Œé‚£ä¹ˆåŸºå­¦ä¹ å™¨çš„é€‰æ‹©æœ€å¥½æ˜¯â€œå‡†è€Œä¸åŒâ€ï¼Œå…ƒå­¦ä¹ å™¨ä¸€èˆ¬é€‰æ‹©æ¯”è¾ƒç®€å•çš„æ¨¡å‹ï¼ˆå¦‚é€»è¾‘å›å½’ï¼‰ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚ æ¯”è¾ƒç®€å•çš„æƒ³æ³•å°±æ˜¯å°†å…¨éƒ¨è®­ç»ƒé›†ç”¨äºè®­ç»ƒåŸºå­¦ä¹ å™¨ï¼Œå°†åŸºå­¦ä¹ å™¨çš„é¢„æµ‹ç»“æœä½œä¸ºå…ƒå­¦ä¹ å™¨çš„è®­ç»ƒé›†ï¼Œä»è€Œå¾—åˆ°æ•´ä¸ªæ¨¡å‹ã€‚ è¿™æ ·åšçš„é—®é¢˜åœ¨äºï¼šåŸºå­¦ä¹ å™¨æœ€ç»ˆåœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨ç°éå¸¸å¥½ï¼Œå†ç”¨åŸºå­¦ä¹ å™¨åœ¨è¯¥è®­ç»ƒé›†ä¸Šçš„é¢„æµ‹ç»“æœä½œä¸ºæ¬¡çº§è®­ç»ƒé›†ï¼ŒåŒæ ·å…ƒå­¦ä¹ å™¨åœ¨è¯¥è®­ç»ƒé›†ä¸Šè¡¨ç°ä¹Ÿä¼šéå¸¸å¥½ï¼Œä½†æ˜¯æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ä¸ä¸€å®šå¾ˆå¥½ï¼Œæœ‰è¿‡æ‹Ÿåˆçš„é£é™©ã€‚ å› æ­¤ï¼Œé‡‡ç”¨KæŠ˜äº¤å‰éªŒè¯çš„æ–¹å¼ï¼Œç”¨è®­ç»ƒåŸºå­¦ä¹ å™¨æœªä½¿ç”¨çš„æ ·æœ¬æ¥äº§ç”Ÿæ¬¡çº§è®­ç»ƒé›†ã€‚ <img src="https://img-blog.csdnimg.cn/20201109191045436.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å…·ä½“æ¥è®²ï¼š åœ¨è®­ç»ƒé˜¶æ®µï¼ˆå‡è®¾è®­ç»ƒé›†<span class="math inline">\(400*10\)</span>ï¼‰ï¼Œå¯¹äºæ¯ä¸ªåŸºå­¦ä¹ å™¨ï¼ˆå‡è®¾æœ‰3ä¸ªåŸºå­¦ä¹ å™¨ï¼‰ï¼Œè¿›è¡Œ5æ¬¡è®­ç»ƒä¸éªŒè¯ï¼Œå¾—åˆ°<span class="math inline">\(400*1\)</span>çš„éªŒè¯ç»“æœï¼Œé‚£ä¹ˆæœ€ç»ˆæ¬¡çº§è®­ç»ƒé›†æ˜¯<span class="math inline">\(400*3\)</span>ï¼ˆç±»æ ‡ç­¾è¿˜æ˜¯åŸå§‹ç±»æ ‡ç­¾ï¼‰ï¼Œç”¨è¿™äº›æ•°æ®è®­ç»ƒæ¬¡çº§å­¦ä¹ å™¨ï¼Œå®Œæˆåå†ç”¨å…¨éƒ¨çš„è®­ç»ƒé›†è®­ç»ƒæ‰€æœ‰çš„åŸºå­¦ä¹ å™¨ï¼ˆå¯é€‰ï¼Œæé«˜åŸºå­¦ä¹ å™¨æ€§èƒ½ï¼‰ï¼› åœ¨æµ‹è¯•é˜¶æ®µï¼Œå¦‚æœè®­ç»ƒé˜¶æ®µé€‰äº†æœ€åä¸€æ­¥ï¼Œé‚£ä¹ˆæ¯ä¸ªåŸºå­¦ä¹ å™¨ç›´æ¥å¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå°±ä¼šå¾—åˆ°3ä¸ªæµ‹è¯•ç»“æœï¼Œé€å…¥æ¬¡çº§å­¦ä¹ å™¨ï¼Œå¾—åˆ°æœ€ç»ˆçš„é¢„æµ‹ç»“æœï¼›å¦‚æœè®­ç»ƒæ—¶æ²¡æœ‰é€‰æœ€åä¸€æ­¥ï¼Œé‚£ä¹ˆæ¯ä¸ªåŸºå­¦ä¹ å™¨éƒ½æœ‰5ä¸ªå°æ¨¡å‹ï¼Œå°†æµ‹è¯•æ ·æœ¬ç”¨5ä¸ªå°æ¨¡å‹åˆ†åˆ«æµ‹è¯•ï¼Œå°†5ä¸ªç»“æœå¹³å‡å¾—åˆ°æŸä¸ªåŸºå­¦ä¹ å™¨çš„é¢„æµ‹ç»“æœï¼Œä¹Ÿä¼šå¾—åˆ°3ä¸ªæµ‹è¯•ç»“æœã€‚ <img src="https://img-blog.csdnimg.cn/20201109192340496.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> Wekaé‡Œçš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Buildclassifier selects a classifier from the set of classifiers</span></span><br><span class="line"><span class="comment">   * by minimising error on the training data.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data the training data to be used for generating the</span></span><br><span class="line"><span class="comment">   * boosted classifier.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if the classifier could not be built successfully</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// å»ºç«‹æ•´ä¸ªæ¨¡å‹</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildClassifier</span><span class="params">(Instances data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_MetaClassifier == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;No meta classifier has been set&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­åˆ†ç±»å™¨æ˜¯å¦æœ‰èƒ½åŠ›å¤„ç†è¯¥æ•°æ®é›†</span></span><br><span class="line">    getCapabilities().testWithFail(data);</span><br><span class="line">    <span class="comment">// åˆ é™¤ç±»æ ‡ç­¾ç¼ºå¤±æ•°æ®</span></span><br><span class="line">    Instances newData = <span class="keyword">new</span> Instances(data);</span><br><span class="line">    m_BaseFormat = <span class="keyword">new</span> Instances(data, <span class="number">0</span>);</span><br><span class="line">    newData.deleteWithMissingClass();</span><br><span class="line">    </span><br><span class="line">    Random random = <span class="keyword">new</span> Random(m_Seed);</span><br><span class="line">    newData.randomize(random); <span class="comment">// æ‰“ä¹±æ•´ä¸ªæ•°æ®é›†</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯åˆ†ç±»é—®é¢˜ï¼Œåˆ†å±‚æŠ½æ ·</span></span><br><span class="line">    <span class="comment">// åŸå§‹æ•°æ®æŒ‰ç…§ç±»æ ‡ç­¾é›†ä¸­åœ¨ä¸€èµ·ï¼ŒæŒ‰m_NumFoldsä¸ºæ­¥é•¿é‡æ–°æŠ½å–æ•°æ®ï¼Œä¿æŒè®­ç»ƒé›†/éªŒè¯é›†æ•°æ®åˆ†å¸ƒä¸€è‡´æ€§, é¿å…å› æ•°æ®åˆ’åˆ†å¼•å…¥é¢å¤–çš„åå·®</span></span><br><span class="line">    <span class="keyword">if</span> (newData.classAttribute().isNominal()) &#123;</span><br><span class="line">      newData.stratify(m_NumFolds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†åŸå§‹æ•°æ®å¾—åˆ°æ–°çš„æ•°æ®ï¼Œå»ºç«‹meta classifier</span></span><br><span class="line">    generateMetaLevel(newData, random);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// restart the executor pool because at the end of processing</span></span><br><span class="line">    <span class="comment">// a set of classifiers it gets shutdown to prevent the program</span></span><br><span class="line">    <span class="comment">// executing as a server</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¸ºä¸‹é¢çš„åŸºå­¦ä¹ å™¨è®­ç»ƒåšå‡†å¤‡</span></span><br><span class="line">    <span class="keyword">super</span>.buildClassifier(newData);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æé«˜åŸºç¡€æ¨¡å‹çš„å‡†ç¡®åº¦ï¼Œä½¿å…¶åœ¨æµ‹è¯•æ•°æ®è¡¨ç°æ›´å¥½ï¼Œç”¨æ‰€æœ‰çš„è®­ç»ƒé›†è¿›è¡ŒåŸºå­¦ä¹ å™¨çš„è®­ç»ƒ</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæµ‹è¯•æ—¶ï¼Œå¯ä»¥ç›´æ¥åœ¨å¤šä¸ªåŸºå­¦ä¹ å™¨é¢„æµ‹åå–å¹³å‡</span></span><br><span class="line">    <span class="comment">// Rebuild all the base classifiers on the full training data</span></span><br><span class="line">    buildClassifiers(newData);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Generates the meta data</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> newData the data to work on</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> random the random number generator to use for cross-validation</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if generation fails</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">generateMetaLevel</span><span class="params">(Instances newData, Random random)</span> </span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// å…ˆç”¨newDataå¾—åˆ°metaDataçš„æ ¼å¼m_MetaFormat</span></span><br><span class="line">    <span class="comment">// ç¡®å®šå…ƒåˆ†ç±»å™¨éœ€è¦çš„å±æ€§</span></span><br><span class="line">    Instances metaData = metaFormat(newData);</span><br><span class="line">    m_MetaFormat = <span class="keyword">new</span> Instances(metaData, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m_NumFolds; j++) &#123;</span><br><span class="line">      <span class="comment">// å¾—åˆ°è®­ç»ƒé›†</span></span><br><span class="line">      Instances train = newData.trainCV(m_NumFolds, j, random);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// start the executor pool (if necessary)</span></span><br><span class="line">      <span class="comment">// has to be done after each set of classifiers as the</span></span><br><span class="line">      <span class="comment">// executor pool gets shut down in order to prevent the</span></span><br><span class="line">      <span class="comment">// program executing as a server (and not returning to</span></span><br><span class="line">      <span class="comment">// the command prompt when run from the command line</span></span><br><span class="line">      <span class="comment">// çº¿ç¨‹æ± ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œæ„å»ºåŸºå­¦ä¹ å™¨</span></span><br><span class="line">      <span class="keyword">super</span>.buildClassifier(train);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ„å»ºåŸºå­¦ä¹ å™¨</span></span><br><span class="line">      buildClassifiers(train);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// Classify test instances and add to meta data</span></span><br><span class="line">      <span class="comment">// å°†æœªä½¿ç”¨è¿‡çš„åŸå§‹è®­ç»ƒæ•°æ®é€šè¿‡åŸºå­¦ä¹ å™¨é¢„æµ‹ååŠ å…¥metadataä½œä¸ºæ–°çš„è®­ç»ƒé›†</span></span><br><span class="line">      Instances test = newData.testCV(m_NumFolds, j);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; test.numInstances(); i++) &#123;</span><br><span class="line">	    metaData.add(metaInstance(test.instance(i)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ©ç”¨å…ƒæ•°æ®å»ºç«‹å…ƒåˆ†ç±»å™¨</span></span><br><span class="line">    m_MetaClassifier.buildClassifier(metaData);    </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºåŸºå­¦ä¹ å™¨ä¹‹é—´çš„è®­ç»ƒæ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æ¯æ¬¡äº¤å‰éªŒè¯åˆ’åˆ†å¥½æ•°æ®åï¼Œéƒ½æ˜¯åˆ©ç”¨çº¿ç¨‹æ± å¹¶è¡Œè®­ç»ƒã€‚ å¦‚æœæ˜¯åœ¨åˆ†å±‚æŠ½æ ·çš„åŸºç¡€ä¸Šåˆ’åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œ<code>trainCV()</code>æŠ½å–æ•°æ®åï¼Œéœ€è¦å°†æ–°çš„è®­ç»ƒé›†Shuffleï¼Œä¿è¯ç‹¬ç«‹åŒåˆ†å¸ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Makes the format for the level-1 data.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> instances the level-0 format</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the format for the meta data</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if the format generation fails</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// ç”Ÿæˆå…ƒæ•°æ®æ ¼å¼</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Instances <span class="title">metaFormat</span><span class="params">(Instances instances)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœm_BaseFormatå±æ€§è¿ç»­ï¼Œå°±åŠ å…¥m_Classifiers.lengthä¸ªå±æ€§</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç¦»æ•£çš„ï¼Œæ¯æ¬¡è¦åŠ å…¥level 0ç±»åˆ«å±æ€§å–å€¼ä¸ªæ•°ä¸ªå±æ€§</span></span><br><span class="line">    ArrayList&lt;attribute&gt; attributes = <span class="keyword">new</span> ArrayList&lt;attribute&gt;();</span><br><span class="line">    Instances metaFormat;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†åŸºå­¦ä¹ å™¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m_Classifiers.length; k++) &#123;</span><br><span class="line">      Classifier classifier = (Classifier) getClassifier(k);</span><br><span class="line">      String name = classifier.getClass().getName() + <span class="string">&quot;-&quot;</span> + (k+<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (m_BaseFormat.classAttribute().isNumeric()) &#123;</span><br><span class="line">	    attributes.add(<span class="keyword">new</span> Attribute(name));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœç¦»æ•£ï¼Œåç»­ä¼šé€šè¿‡æ¯ä¸ªå–å€¼çš„æ¦‚ç‡æ¥åˆ¤æ–­ï¼Œæ¯”å¦‚æ‚è‰²ã€åœ†èŠ±ï¼Œè¿™2ç§ç‰¹æ€§ä¸èƒ½ç”¨ä¸€ä¸ªå±æ€§è¡¨ç¤ºï¼Œæ‰€ä»¥æ¯ä¸ªå–å€¼éƒ½è¦ç‹¬ç«‹æˆå•ç‹¬çš„å±æ€§</span></span><br><span class="line">          <span class="comment">// æ¥ä¿å­˜æ¦‚ç‡å€¼</span></span><br><span class="line">	      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m_BaseFormat.classAttribute().numValues(); j++) &#123;</span><br><span class="line">	        attributes.add(</span><br><span class="line">	          <span class="keyword">new</span> Attribute(</span><br><span class="line">		      name + <span class="string">&quot;:&quot;</span> + m_BaseFormat.classAttribute().value(j)));</span><br><span class="line">	    &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ ä¸ŠåŸå§‹ç±»æ ‡ç­¾</span></span><br><span class="line">    attributes.add((Attribute) m_BaseFormat.classAttribute().copy());</span><br><span class="line">    <span class="comment">// å½¢æˆå…ƒæ•°æ®æ ¼å¼</span></span><br><span class="line">    metaFormat = <span class="keyword">new</span> Instances(<span class="string">&quot;Meta format&quot;</span>, attributes, <span class="number">0</span>);</span><br><span class="line">    metaFormat.setClassIndex(metaFormat.numAttributes() - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> metaFormat;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆå…ƒæ•°æ®æ ¼å¼æ—¶ï¼Œå¦‚æœæ˜¯åˆ†ç±»é—®é¢˜ï¼Œç±»æ ‡ç­¾çš„æ¯ä¸ªå±æ€§éƒ½è¢«ä½œä¸ºä¸€ä¸ªæ–°çš„å±æ€§ï¼š <img src="https://img-blog.csdnimg.cn/20201109195503863.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™é‡Œæˆ‘ä¸ªäººè¿™æ ·ç†è§£ï¼šæœ‰çš„åŸºåˆ†ç±»å™¨å¯ä»¥è¾“å‡ºå±äºæŸä¸ªç±»çš„æ¦‚ç‡ï¼ˆå¦‚é€»è¾‘å›å½’ï¼‰ï¼Œå°†æ¦‚ç‡ä½œä¸ºå…ƒå±æ€§è€Œä¸æ˜¯ç›´æ¥å°†åŸºå­¦ä¹ å™¨çš„åˆ†ç±»ç»“æœä½œä¸ºå…ƒå±æ€§ï¼Œè¿™æ ·åšèƒ½å¤Ÿå‡å°åŸºå­¦ä¹ å™¨çš„åˆ†ç±»è¯¯å·®å¸¦ç»™å…ƒå­¦ä¹ å™¨çš„å½±å“ï¼Œæ¨¡å‹æ•´ä½“æ›´åŠ ç²¾ç¡®ï¼š <img src="https://img-blog.csdnimg.cn/20201109195918632.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Makes a level-1 instance from the given instance.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> instance the instance to be transformed</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the level-1 instance</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if the instance generation fails</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// äº§ç”Ÿå…ƒæ•°æ®</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Instance <span class="title">metaInstance</span><span class="params">(Instance instance)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// valuesä¿å­˜åˆ†ç±»ç»“æœï¼Œè¿ç»­å±æ€§ç›´æ¥ä¿å­˜ï¼Œç¦»æ•£å±æ€§åˆ™å…ˆæ±‚å¾—åˆ†å¸ƒï¼Œå°†æ¯ç§å–å€¼çš„åˆ†å¸ƒåŠ å…¥valuesï¼Œè®¾ç½®ä¸ºm_MetaFormatæ ¼å¼è¿”å›</span></span><br><span class="line">    <span class="keyword">double</span>[] values = <span class="keyword">new</span> <span class="keyword">double</span>[m_MetaFormat.numAttributes()];</span><br><span class="line">    Instance metaInstance;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m_Classifiers.length; k++) &#123;</span><br><span class="line">      Classifier classifier = getClassifier(k);</span><br><span class="line">      <span class="keyword">if</span> (m_BaseFormat.classAttribute().isNumeric()) &#123;</span><br><span class="line">	    values[i++] = classifier.classifyInstance(instance);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// åŸºå­¦ä¹ å™¨å¯¹è¯¥å®ä¾‹çš„åˆ†ç±»çš„æ¦‚ç‡åˆ†å¸ƒ, sum(dist)=1</span></span><br><span class="line">	    <span class="keyword">double</span>[] dist = classifier.distributionForInstance(instance);</span><br><span class="line">	    <span class="comment">// å°†è¯¥åŸºå­¦ä¹ å™¨å¯¹è¯¥å®ä¾‹çš„é¢„æµ‹æ¦‚ç‡è¾“å‡ºåˆ°å¯¹åº”çš„å…ƒå±æ€§</span></span><br><span class="line">	    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; dist.length; j++) &#123;</span><br><span class="line">	      values[i++] = dist[j];</span><br><span class="line">	    &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ‡ç­¾å€¼å¯¹åº”æœ€åä¸€ä¸ªå…ƒå±æ€§</span></span><br><span class="line">    values[i] = instance.classValue();</span><br><span class="line">    metaInstance = <span class="keyword">new</span> DenseInstance(<span class="number">1</span>, values);</span><br><span class="line">    metaInstance.setDataset(m_MetaFormat);</span><br><span class="line">    <span class="keyword">return</span> metaInstance;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å®é™…æ•°æ®é›†ä¸Šçš„ç»“æœå…¶å®ä¸ä¸€å®šæ¯”å…¶ä»–æ¨¡å‹æ•ˆæœå¥½ï¼Œå¯èƒ½æ˜¯æˆ‘å‚æ•°è°ƒçš„ä¸å¥½å§ï¼ˆé›¾ï¼‰~ </attribute></attribute></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/11/07/Bear%20Maps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/07/Bear%20Maps/" class="post-title-link" itemprop="url">Bear Maps</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-07 07:45:00" itemprop="dateCreated datePublished" datetime="2020-11-07T07:45:00+08:00">2020-11-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="intro">Intro</h2>
<p>è¿™æ˜¯CS 61Bçš„Project 3ï¼Œä¹Ÿæ˜¯æœ€åä¸€ä¸ªProjã€‚åˆšå¥½ä¸Šå®Œè¿™é—¨è¯¾å‡ºå»æ—…ä¸ªæ¸¸ï¼Œæ”¾æ¾ä¸‹å¿ƒæƒ…å¼€å§‹15213ã€‚ å®ŒæˆåŸºæœ¬çš„è¦æ±‚èŠ±äº†5å¤©æ—¶é—´ï¼Œå½“ç„¶ç°åœ¨çš„ç‰ˆæœ¬è¿˜ååˆ†ç®€é™‹ï¼Œè¿™ä¸ªå·¥ç¨‹æˆ‘æ˜¯æƒ³åšå¾—æ¯”è¾ƒå¤§ï¼Œåé¢è¿˜å¾—æŠ½æ—¶é—´æ¶ˆåŒ–ç†è§£ã€å®Œå–„ä¼˜åŒ–ã€‚</p>
<p>SP18ç”¨äº†<a target="_blank" rel="noopener" href="https://maven.apache.org/">Apache Maven</a>åšé¡¹ç›®å»ºæ„å·¥å…·ï¼Œ<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41431457/article/details/102999439">æŠ˜è…¾</a>äº†ä¸€å¤©ä¹Ÿæ²¡æœ‰é…å¥½ï¼Œ<del>ä¸çŸ¥é“è¿™ä¹ˆåƒåœ¾çš„å·¥å…·æœ‰å•¥ç”¨</del> ï¼Œæœ€åå®åœ¨æ²¡è¾™å°±æŠŠè¯¥é¡¹ç›®æ‰€æœ‰éœ€è¦çš„jaråŒ…å¯¼è¿›æ¥ï¼Œåæ¥å‘ç°SP19å°±æŠ›å¼ƒäº†mavenã€‚ <img src="https://img-blog.csdnimg.cn/20200623161825813.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> é¡¹ç›®éœ€è¦çš„åœ°å›¾é›†ä»¥åŠåœ°å›¾ä¸Šçš„ç‚¹/è·¯ä¿¡æ¯éƒ½æ˜¯Googleé‡‡é›†å¥½çš„ï¼Œå¯åœ¨<a target="_blank" rel="noopener" href="https://github.com/Berkeley-CS61B">è¿™é‡Œ</a>ä¸‹è½½ï¼Œå½“ç„¶è¿™ä¸ªåœ°å›¾åªæ˜¯ä¸€å°éƒ¨åˆ†ï¼Œåé¢æƒ³è¦æ‰©å±•å¯ä»¥å»ä¸‹è½½éœ€è¦çš„<a target="_blank" rel="noopener" href="https://www.openstreetmap.org/">æ•°æ®é›†</a>ï¼ŒåŒ…æ‹¬tile imageså’Œmap feature dataã€‚</p>
<p>æ•´ä½“éœ€æ±‚æ˜¯å®ç°ä¸€ä¸ªç½‘é¡µç«¯åœ°å›¾ï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨è¾“å…¥URLï¼ŒJavaç¨‹åºæ¥æ”¶ï¼Œç„¶åç”Ÿæˆç›¸åº”çš„åœ°å›¾ç»“æœå¹¶è¿”å›ï¼Œåœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºã€‚æœåŠ¡å™¨æ¡†æ¶ç”¨çš„æ˜¯<a target="_blank" rel="noopener" href="http://sparkjava.com/documentation.html#getting-started">Spark</a>ï¼Œå‰ç«¯ä»¥åŠå‰åç«¯äº¤äº’çš„éƒ¨åˆ†å·²ç»å†™å¥½äº†ï¼ˆTAçœŸçš„å¤ªå¼ºäº†ï¼‰ï¼Œå…¶å®æˆ‘æœ‰æ—¶å€™è§‰å¾—è¿™äº›dirtyçš„å·¥ä½œæ¯”è¾ƒè€ƒéªŒç åŠ›ï¼Œè¿™äº›ä»£ç å†™å¾—æ¼‚äº®è¯´æ˜Systemçš„èƒ½åŠ›æ˜¯æŒºå¼ºçš„ã€‚</p>
<p>åç«¯è‡³å°‘éœ€è¦å®ç°3ä¸ªç±»ï¼š</p>
<ul>
<li><code>Rasterer</code> è¾“å…¥upper left latitude and longitude, lower right latitude and longitude, a window width, and a window height. è¾“å‡º2D array of filenames corresponding to the files to be rendered.</li>
<li><code>GraphDB</code> è¾“å…¥Open Street Mapæ•°æ®é›†ï¼Œå°†å…¶è½¬ä¸ºå›¾å­˜å‚¨èµ·æ¥ï¼šæ¯ä¸ªç»“ç‚¹æ˜¯a single intersectionï¼Œæ¯æ¡è¾¹æ˜¯ä¸€æ¡è·¯ã€‚</li>
<li><code>Router</code> è¾“å…¥GraphDB, a starting latitude and longitude, and a destination latitude and longitude. è¾“å‡ºä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„ä¸€ç³»åˆ—ç»“ç‚¹ï¼Œä»¥åŠè·¯å¾„å¯¼èˆªä¿¡æ¯ã€‚ ## Map Rastering é¦–å…ˆè¦å°†ç”¨æˆ·æŸ¥è¯¢çš„çœŸå®ä¸–ç•Œçš„ç»çº¬åº¦ä¿¡æ¯è½¬ä¸ºå®é™…åœ°å›¾ï¼Œ<code>Rasterer.java</code>ä¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚çš„çŸ©å½¢å‚æ•°<code>Map&lt;String, Double&gt; params</code>ï¼Œç”Ÿæˆå¯¹åº”çš„å›¾åƒåç§°<code>String[][]</code>ï¼š ä¸»è¦å·¥ä½œåœ¨<code>getMapRaster()</code>æ–¹æ³•ä¸­å®Œæˆï¼Œç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢è¯·æ±‚å…±æœ‰6ä¸ªå‚æ•°ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;lrlon=-<span class="number">122.2104604264636</span>, ullon=-<span class="number">122.30410170759153</span>, w=<span class="number">1085.0</span>, h=<span class="number">566.0</span>, ullat=<span class="number">37.870213571328854</span>, lrlat=<span class="number">37.8318576119893</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºç”¨æˆ·å¸Œæœ›æ˜¾ç¤ºç»åº¦èŒƒå›´<code>lrlon</code>~<code>ullon</code>ï¼Œçº¬åº¦èŒƒå›´<code>ullat</code>~<code>lrlat</code>çš„åŒºåŸŸï¼Œå¹¶ä¸”åˆ†è¾¨ç‡å¤§æ¦‚æ˜¯<code>w*h</code>ã€‚</p>
<p>è¡—æ™¯å›¾é‡‡ç”¨<strong>å†—ä½™å­˜å‚¨</strong>ï¼Œæ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯<code>256*256</code>ï¼š<code>d0_x0_y0.png</code>æ˜¯æ•´ä¸ªåŒºåŸŸçš„è¡—æ™¯ï¼Œä½†æ˜¯åˆ†è¾¨ç‡æœ€ä½ï¼Œ<code>d1_x0_y0.png/d1_x0_y1.png/d1_x1_y0.png/d1_x1_y1.png</code>åˆ†åˆ«ä»£è¡¨è¥¿åŒ—/ä¸œåŒ—/è¥¿å—/ä¸œå—å››ä¸ªè§’çš„è¡—æ™¯ï¼Œä½†æ˜¯åˆ†è¾¨ç‡åŠ å€ã€‚</p>
<p>æ›´åŠ è§„èŒƒçš„è¯´ï¼šåœ¨ç¬¬Dä¸ªç¼©æ”¾çº§åˆ«ï¼Œå…±æœ‰<span class="math inline">\(4^D\)</span>å¼ å›¾ç‰‡ï¼Œ<code>dD_x0_y0.png</code>åˆ°<code>dD_xk_yk.png</code>ï¼Œ<span class="math inline">\(k=2^D-1\)</span>ï¼Œéš<code>x</code>å¢å¤§å‘ä¸œç§»åŠ¨ï¼Œéš<code>y</code>å¢å¤§å‘å—ç§»åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›<code>String[][]</code>ä»£è¡¨ç”¨æˆ·è¯·æ±‚åŒºåŸŸçš„å›¾ç‰‡æ–‡ä»¶åçŸ©é˜µï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–å‚æ•°ï¼ˆæŸ¥è¯¢æ˜¯å¦æˆåŠŸç­‰ï¼‰ï¼šç”±äºJavaåªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥ç»“æœç»„è£…æˆ<code>Map&lt;String, Object&gt;</code>è¿”å›ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[d2_x0_y1.png, d2_x1_y1.png, d2_x2_y1.png, d2_x3_y1.png],</span><br><span class="line">[d2_x0_y2.png, d2_x1_y2.png, d2_x2_y2.png, d2_x3_y2.png],</span><br><span class="line">[d2_x0_y3.png, d2_x1_y3.png, d2_x2_y3.png, d2_x3_y3.png]]</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°è¿”å›ç»“æœçš„åˆ†è¾¨ç‡ä¸º<code>1024*768</code>ï¼Œå‡ ä¹æ»¡è¶³ç”¨æˆ·åˆ†è¾¨ç‡è¦æ±‚<code>1085*556</code>ã€‚</p>
<p>è¿™æ ·å¯¹äºåŒä¸€ä¸ªåŒºåŸŸï¼Œå¯ä»¥æœ‰å¾ˆå¤šé€‰æ‹©ï¼šå¯ä»¥ç”¨æ›´å¤šå¼ é«˜åˆ†è¾¨ç‡å›¾ç‰‡çš„ç»„åˆï¼Œä¹Ÿå¯ä»¥ç”¨è¾ƒå°‘å‡ å¼ ä½åˆ†è¾¨ç‡çš„å›¾ç‰‡ç»„åˆï¼Œåªè¦æ»¡è¶³ç”¨æˆ·è¦æ±‚ï¼Œæ¯”å¦‚å¯¹äºä¸Šè¿°ä¾‹å­ï¼Œ<code>d2_x0_y1.png</code>å¯ä»¥é‡‡ç”¨<code>d3_x0_y2.png/d3_x1_y2.png/d3_x0_y3.png/d3_x1_y3.png</code>ä»£æ›¿ï¼Œè¿™æ ·è¿”å›çš„å›¾ç‰‡æ˜¯<code>6*8</code>å…±48å¼ ï¼Œåˆ†è¾¨ç‡å¯è¾¾<code>2048*1536</code>ã€‚</p>
<p>ä½†è¿™æ ·åšå¾ˆå¯èƒ½overflowï¼Œè¿œè¿œè¶…è¿‡ç”¨æˆ·è¦æ±‚ï¼Œæµªè´¹æ—¶é—´å’Œèµ„æºï¼Œå› ä¸ºåˆ†è¾¨ç‡é«˜å°±æ„å‘³ç€å±•ç¤ºçš„ç©ºé—´å°ï¼Œå¹¶ä¸”å‰ç«¯æ˜¯ä¸ä¼šåšç¼©æ”¾çš„ï¼Œå¦‚æœç”¨å¾ˆå¤šé«˜åˆ†è¾¨ç‡å›¾ç‰‡ï¼Œæµè§ˆå™¨ä¼šæœ‰å¤ªå¤šå¤ªå¤šç…§ç‰‡åŠ è½½æ˜¾ç¤ºï¼Œå› ä¸ºå¤§å®¶éƒ½æ˜¯<code>256*256</code>çš„ã€‚</p>
<p>æ‰€ä»¥å®šä¹‰å•ä½åƒç´ çš„ç»åº¦è·ç¦»ï¼š<span class="math inline">\(\text{LonDPP} = \frac{\text{lower right longitude} - \text{upper left longitude}}{\text{width of the image (or box) in pixels}}\)</span>ï¼Œæˆ‘ä»¬è¦å±•ç¤ºçš„æ˜¯å°äºç”¨æˆ·è¦æ±‚çš„LonDPPçš„æœ€å¤§å€¼ï¼Œæ¯”æ–¹è¯´ç”¨æˆ·è¦æ±‚æ¯ä¸ªåƒç´ 2åº¦ï¼Œå¦‚æœæˆ‘ä»¬å¤§äº2ï¼Œé‚£ä¹ˆåˆ†è¾¨ç‡ä½åˆ°ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œåªæœ‰å°äº2æ‰èƒ½æ»¡è¶³è¦æ±‚ã€‚åˆä¸èƒ½å¤ªå°ï¼Œåˆ†è¾¨ç‡å¤ªé«˜å±•ç¤ºèŒƒå›´å˜å°ã€‚å½“ç„¶å¦‚æœç”¨æˆ·è¦æ±‚çš„LonDPPå¾ˆä½ï¼Œåªèƒ½ç”¨ç°æœ‰çš„æœ€ä½çš„LonDPPå›¾ç‰‡ï¼Œå³<code>d7</code>ç³»åˆ—ã€‚ å¯ä»¥å°†LonDPPç†è§£ä¸ºæ¨¡ç³Šç¨‹åº¦ï¼ŒLonDPPè¶Šå¤§ï¼Œæ˜¾ç¤ºçš„å›¾ç‰‡è¶Šæ¨¡ç³Šï¼Œæ¯”å¦‚<code>d0</code>ç³»åˆ—å°±æœ‰æœ€å¤§çš„LonDPPã€‚ çº¬åº¦ä¹Ÿè¦åšç±»ä¼¼å¤„ç†ã€‚</p>
<p>ä¸¾ä¾‹æ¥çœ‹ï¼š<code>d2</code>ç³»åˆ—å…±æœ‰16å¼ å›¾ç‰‡ï¼Œç”¨æˆ·è¯·æ±‚Query Boxåº”è¯¥è¿”å›9å¼ å›¾ç‰‡ï¼š <img src="https://img-blog.csdnimg.cn/20200624205748557.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å…·ä½“å®ç°åªæœ‰1ä¸ªæ–¹æ³•<code>public Map&lt;String, Object&gt; getMapRaster(Map&lt;String, Double&gt; params)</code>ï¼Œåˆ†2æ­¥ï¼š</p>
<ul>
<li>éœ€è¦çš„å›¾ç‰‡çš„<code>depth</code> å…¨å›¾å³<code>d0</code>çš„ç»çº¬åº¦èŒƒå›´æ˜¯ï¼š<code>-122.29980, 37.89220/-122.21191, 37.82280</code> å› ä¸ºåœ°çƒä¸æ˜¯è§„åˆ™çš„ï¼Œä½†æ˜¯åœ¨ç¡®å®šDepthæ—¶ï¼Œç»åº¦æ–¹å‘çš„LonDPPæ»¡è¶³è¦æ±‚å³å¯ï¼Œä¸éœ€è€ƒè™‘çº¬åº¦æ–¹å‘çš„å½±å“ã€‚</li>
<li>ç¡®å®šå››ä¸ªè§’çš„ä¸‹æ ‡</li>
<li>corner case åˆ¤æ–­è¾“å…¥æ˜¯å¦åˆæ³•æ—¶ï¼Œè¾¹ç•Œåˆ¤æ–­ä¸€å®šè¦åŠ EPSï¼Œä¸ç„¶ä¸€ç‚¹å°è¯¯å·®ä¼šå´©æ‰ç¨‹åºã€‚ è¾“å…¥ä¸åˆæ³•ï¼ˆç”¨æˆ·æ‹–åŠ¨è‡³å…¨å›¾å¤–ç­‰ï¼‰ï¼Œå°†<code>query_success</code>ç½®ä¸º<code>false</code>è¿”å›å³å¯ã€‚</li>
</ul>
<p>Bugï¼šè¯»å–å›¾ç‰‡æ–‡ä»¶æ—¶ï¼Œæ€»æ˜¯<code>javax.imageio.IOException: Can't read input file!</code>ã€‚ä¸€èˆ¬éƒ½æ˜¯è·¯å¾„é—®é¢˜ã€‚ ## Routing &amp; Location Data æ˜ç¡®äº†å‰ç«¯éœ€è¦æ˜¾ç¤ºå“ªäº›å›¾ç‰‡åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦å»ºä¸€ä¸ªå›¾ï¼Œå› ä¸ºæœ€åè¦è·¯å¾„è§„åˆ’å˜›ã€‚ è·¯ç”±å’Œä½ç½®æ•°æ®æ˜¯é€šè¿‡<code>berkeley-2018.osm.xml</code>æ–‡ä»¶ç»™çš„ï¼Œæ˜¯æ•´ä¸ª<a target="_blank" rel="noopener" href="https://download.bbbike.org/osm/">åœ°çƒæ•°æ®</a>çš„ä¸€éƒ¨åˆ†ï¼Œæ–‡ä»¶æ ¼å¼æ˜¯<a target="_blank" rel="noopener" href="https://wiki.openstreetmap.org/wiki/OSM_XML">OSM XML</a>ã€‚</p>
<p>è§£æXMLæ•°æ®ç”¨çš„æ˜¯SAX Parserï¼Œéå†æ¯ä¸ªelementï¼Œåœ¨æ¯ä¸ªå…ƒç´ çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œè°ƒç”¨<code>startElement</code>å’Œ<code>endElement</code>å›è°ƒå‡½æ•°ã€‚</p>
<p>å…ˆæ¥ç†Ÿæ‚‰ä¸‹OSM XMLæ–‡æ¡£ï¼š <img src="https://img-blog.csdnimg.cn/20200625122049178.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> <code>node</code>å…ƒç´ æ˜¯ç»„æˆåœ°å›¾çš„ä¸»å¹²ï¼Œæœ‰id/lat/lonç­‰å±æ€§ã€‚å¦‚æœç»“ç‚¹æ˜¯ä¸€ä¸ªä½ç½®ï¼Œé‚£ä¹ˆ<code>tag</code>æ ‡ç­¾å°±ä¼šæœ‰<code>name</code>ï¼Œå¦‚æœæ˜¯å…¶ä»–çš„ï¼Œæ¯”å¦‚è·¯ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰<code>tag</code>ã€‚ <img src="https://img-blog.csdnimg.cn/20200625122412890.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> <code>way</code>å…ƒç´ è¡¨ç¤ºä¸€æ¡è·¯ï¼Œè·¯ä¸Šå¯èƒ½æœ‰å¾ˆå¤š<code>node</code>ï¼Œç”¨<code>id</code>è¡¨ç¤ºã€‚<code>tag</code>ä¼šåŒ…å«é¢å¤–ä¿¡æ¯ï¼Œå¦‚æœ<code>name</code>æ˜¯highwayï¼Œé‚£ä¹ˆ<code>v</code>å°±æ˜¯é“è·¯ç±»å‹ã€‚å‡è®¾æ‰€æœ‰é“è·¯éƒ½æ˜¯åŒå‘çš„ã€‚</p>
<p>åœ¨ç±»<code>GraphDB</code>ä¸­å­˜å‚¨å›¾ï¼Œè¦æ±‚å…è®¸æ’å…¥å’Œåˆ é™¤ç»“ç‚¹ï¼Œæœ€åè¦ç”¨<code>clean()</code>æ¸…ç†æ‰æ²¡æœ‰è¿æ¥çš„ç»“ç‚¹ã€‚ <code>GraphBuildingHandler</code>ä¼šè§£æXMLæ–‡ä»¶å¹¶è°ƒç”¨<code>GraphDB</code>çš„ä¸€äº›æ¥å£å‡½æ•°æ„å»ºæ•´ä¸ªå›¾ã€‚</p>
<p>å¦‚æœé€‰æ‹©é‚»æ¥çŸ©é˜µå­˜å‚¨ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€çš„å›¾ï¼Œå¯èƒ½è¦å¢åŠ æˆ–è€…åˆ é™¤ç»“ç‚¹ï¼Œæ‰€ä»¥ä¸€å¼€å§‹é¡¶ç‚¹ä¸ªæ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œä¹Ÿå°±ä¸èƒ½ç”¨<code>int[][]</code>è¡¨ç¤ºã€‚æ‰€ä»¥é€‰æ‹©é‚»æ¥è¡¨ï¼Œå› ä¸ºæœ‰<code>clean()</code>æ“ä½œï¼Œéœ€è¦åˆ¤æ–­ç»“ç‚¹æ˜¯å¦ä¸å…¶ä»–ç»“ç‚¹ç›¸é‚»ï¼Œé‚»æ¥è¡¨é€Ÿåº¦æ›´å¿«ã€‚</p>
<p><code>GraphBuildingHandler</code>æ¯æ¬¡åªå¤„ç†XMLçš„ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œ<code>GraphBuildingHandler</code>è¿™ä¸ªç±»å¯ä»¥è¢«å…¶å®ƒæ–¹æ³•å¤šæ¬¡è°ƒç”¨å»å¤„ç†å®Œæ‰€æœ‰çš„XMLï¼Œæˆ‘å‘ç°è¿™ç§æ‹†åˆ†å¾ˆæœ‰ç”¨ï¼Œç³»ç»Ÿä¼šå˜å¾—ç®€å•ï¼Œåªéœ€è¦è€ƒè™‘å½“å‰çŠ¶æ€å°±å¾ˆå¥½å†™ã€‚æ¸…æ¥šéœ€æ±‚åï¼Œéœ€è¦è®¾è®¡ç±»çš„æ¥å£ï¼Œæ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿™æ‰æ˜¯æœ€éš¾çš„éƒ¨åˆ†ã€‚</p>
<p>ç”±äºparserçš„è§£ææ˜¯ä»ä¸Šåˆ°ä¸‹çš„ï¼Œæ‰€ä»¥å¤„ç†<code>way</code>æ—¶æœ€å¥½ä¸è¦ç›´æ¥æŠŠè¾¹å’Œè¾¹ä¸Šçš„ç»“ç‚¹ç›´æ¥åŠ è¿›å›¾é‡Œï¼Œå› ä¸ºåé¢çš„<code>highway</code>çš„å€¼å¯èƒ½ä¸åœ¨åˆæ³•èŒƒå›´å†…ï¼Œè¿™ç§è¾¹æ˜¯ä¸ç®—çš„ã€‚æ‰€ä»¥åœ¨ç¢°åˆ°è¾¹ä¸Šçš„ç‚¹ï¼Œå…ˆå­˜åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œæœ€å<code>endElement()</code>æ—¶å€™å¦‚æœè·¯åˆæ³•ï¼Œå†åŠ è¿›å›¾é‡Œã€‚å¤„ç†<code>node</code>ä¹ŸåŒç†ï¼Œåœ¨<code>endElement()</code>æ—¶åŠ å…¥å›¾ã€‚è®°å¾—æ¯æ¬¡åšå®Œä¸€ä¸ª<code>node</code>æˆ–<code>way</code>è¦<code>clear()</code>ä¸Šä¸€ä¸ªçš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>æ¯ä¸ª<code>node</code>æœ‰ä¸€äº›å±æ€§ï¼ˆid/lat/lonï¼‰ï¼Œæ¯æ¡è¾¹ä¹Ÿæœ‰ä¸€äº›å±æ€§ï¼ˆfromID/toID/nameï¼‰ï¼Œæ‰€ä»¥é¦–å…ˆè¦æœ‰<code>Node</code>ç±»å’Œ<code>Edge</code>ç±»ã€‚ é‚»æ¥è¡¨çš„é¡¶ç‚¹è¡¨<code>Map&lt;Long, Node&gt; vertex</code>ï¼Œè¾¹è¡¨<code>Map&lt;Long, Set&lt;Edge&gt;&gt; adj</code>ã€‚</p>
<p>Bugï¼šå¯¹<code>ArrayList</code>ç­‰åœ¨è¿­ä»£æ—¶åŒæ—¶è¿›è¡Œä¿®æ”¹å°±ä¼šå¼•å‘å¼‚å¸¸<code>ConcurrentModificationException</code>ã€‚</p>
<p><code>long closest(double lon, double lat)</code>æ–¹æ³•ä¼šè¢«ç”¨æ¥æ‰¾æœ€çŸ­è·¯ï¼Œéœ€è¦è¿”å›æœ€è¿‘çš„<strong>æœ‰é‚»å±…</strong>çš„<code>node</code>ï¼Œä¸€ä¸ªç‚¹å¯èƒ½æ²¡æœ‰é‚»å±…ï¼Œå› ä¸ºä»–æ˜¯é¥­åº—å•¥çš„ï¼Œä¸èƒ½ç”¨æ¥æ‰¾æœ€çŸ­è·¯ã€‚å¦å¤–ï¼Œè¿™ä¸ªæ–¹æ³•å¤æ‚åº¦è¦æ±‚<span class="math inline">\(O(lgn)\)</span>ï¼Œå…ˆå®ç°ä¸€ä¸ª<span class="math inline">\(O(n)\)</span>çš„åšæ³•ï¼Œåç»­æœ‰æ—¶é—´å†å»ä¼˜åŒ–å§ã€‚ ## Route Search å»ºå¥½åœ°å›¾åï¼Œå°±è¦åšè·¯ç”±å·¥ä½œï¼šç»™å®šèµ·ç‚¹å’Œç»ˆç‚¹çš„ç»çº¬åº¦ï¼Œé€‰ä¸€æ¡è·ç¦»æœ€çŸ­çš„è·¯å¾„ï¼Œéœ€è¦åœ¨ç±»<code>Router</code>ä¸­å®ç°<code>shortestPath</code>æ–¹æ³•ã€‚ åº”è¯¥ä»è·èµ·ç‚¹æœ€è¿‘çš„<code>node</code>å¼€å§‹å¯¼èˆªåˆ°è·ç»ˆç‚¹æœ€è¿‘çš„<code>node</code>ç»“æŸï¼Œå½“ç„¶è¿™äº›<code>node</code>å¿…é¡»æ˜¯connectedçš„ã€‚</p>
<p>ä¸¤ä¸ª<code>node</code>é—´çš„è·ç¦»é‡‡ç”¨<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Great-circle_distance">great-circle distance</a>ï¼Œå³å½“ä½œçƒæ¨¡å‹æ¥è®¡ç®—å¼§é•¿è·ç¦»ã€‚æ•´ä½“è·ç¦»å°±æ˜¯è®¡ç®—1/2ä¹‹é—´ã€2/3ä¹‹é—´...çš„è·ç¦»ä¹‹å’Œï¼Œè¿˜è¦è€ƒè™‘ç»åº¦å’Œçº¬åº¦æœ‰ä¸åŒçš„å°ºåº¦ï¼Œå¹¶ä¸”éšç€çº¬åº¦å˜åŒ–ï¼Œæ¯åº¦ä»£è¡¨çš„å®é™…è·ç¦»ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œè¿˜å¥½è®¡ç®—è·ç¦»çš„å‡½æ•°å·²ç»ç”±ğŸ‚ğŸºçš„TAå†™å¥½äº†ã€‚</p>
<p>æœ€å¥½ç”¨A*è€Œä¸æ˜¯Dijkstraï¼Œå¯å‘å‡½æ•°h(n)ç”¨ç»“ç‚¹nåˆ°ç»ˆç‚¹çš„great-circle distanceå°±è¡Œï¼Œè¦æ³¨æ„ç›®æ ‡ä¸å¯è¾¾çš„æƒ…å†µã€‚</p>
<p>å¼€å§‹åªèƒ½åœ¨<code>berkeley-2018-small-osm.xml</code>ä¸Šè·‘èµ·æ¥ï¼Œæˆ‘ä»¥ä¸ºæ˜¯ç¬”è®°æœ¬é…ç½®å¤ªçƒ‚ï¼Œè·‘å¤§çš„æ•°æ®é›†è·‘ä¸åŠ¨ï¼Œåªèƒ½ç”¨å°çš„æ¥æµ‹è¯•ï¼Œåæ¥å‘ç°<code>GraphDB</code>é‡Œä¸€è¡Œå†™é”™äº†ã€‚ã€‚ã€‚debugçœŸç—›è‹¦å•Šï¼ï¼</p>
<p>æ‰¾åˆ°æœ€ä¼˜è·¯çº¿åï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªoptional featureï¼Œå°±æ˜¯æ˜¾ç¤ºæ–¹å‘å¯¼èˆªä¿¡æ¯Turn-by-turn Navigationï¼Œéœ€è¦åœ¨ç±»<code>Router</code>ä¸­å®ç°<code>routeDirections</code>æ–¹æ³•ã€‚å¯¼èˆªæ–¹å‘çš„è¡¨ç¤ºæ˜¯åœ¨<code>Router</code>ç±»ä¸­å†™äº†ä¸€ä¸ªæ–°ç±»<code>NavigationDirection</code>ï¼Œå…·ä½“çš„å¯¼èˆªä¿¡æ¯æ ¼å¼å¦‚ä¸‹ï¼š DIRECTION on WAY for DISTANCE miles å…¶ä¸­ï¼ŒDIRECTIONæœ‰8ç§é€‰æ‹©ï¼š - â€œStartâ€ - â€œContinue straightâ€ - â€œSlight left/rightâ€ - â€œTurn left/rightâ€ - â€œSharp left/rightâ€</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®å®šæ­£ç¡®çš„DIRECTION/WAY/DISTANCEï¼Œæ–¹å‘å–å†³äºå½“å‰ç»“ç‚¹å’Œä¸Šä¸€ä¸ªèŠ‚ç‚¹é—´çš„<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bearing_(navigation)">relative bearing</a>ï¼š</p>
<ul>
<li>Between -15 and 15 degrees the direction should be â€œContinue straightâ€.</li>
<li>Beyond -15 and 15 degrees but between -30 and 30 degrees the direction should be â€œSlight left/rightâ€.</li>
<li>Beyond -30 and 30 degrees but between -100 and 100 degrees the direction should be â€œTurn left/rightâ€.</li>
<li>Beyond -100 and 100 degrees the direction should be â€œSharp left/rightâ€.</li>
</ul>
<p>éš¾ç‚¹åœ¨äºï¼šä¸€æ¡<code>way</code>ä¸Šå¯èƒ½åŒ…å«äº†è‹¥å¹²<code>node</code>ï¼Œå¦‚ä½•åœ¨éå†<code>node</code>çš„è¿‡ç¨‹ä¸­åˆ¤æ–­<code>way</code>æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œåªæœ‰<code>way</code>å˜åŒ–åæ‰èƒ½äº§ç”Ÿä¸€æ¡æ–°çš„å¯¼èˆªä¿¡æ¯ã€‚å¦‚æœæ°å¥½æ¥åˆ°äº†ä¸€æ¡æ²¡æœ‰<code>name</code>çš„è·¯ï¼Œå°±å°†WAYè®¾ä¸ºâ€œunknown roadâ€ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼š å‡è®¾å‡ºå‘çš„<code>node</code>åœ¨â€œShattuck Avenueâ€è¿™æ¡è·¯ä¸Šï¼Œé‚£ä¹ˆDIRECTIONåº”è¯¥è®¾ä¸ºâ€œStartâ€ï¼Œéå†æ¥ä¸‹æ¥çš„<code>node</code>æ—¶ï¼Œéœ€è¦ç´¯åŠ åœ¨è¿™æ¡è·¯ä¸Šèµ°è¿‡çš„è·ç¦»ï¼Œæœ€ç»ˆåˆ°è¾¾ä¸€ä¸ªä¸åœ¨â€œShattuck Avenueâ€çš„<code>node</code>æ—¶ï¼Œè®¾ç½®WAYä¸ºâ€œShattuck Avenueâ€ï¼ŒDISTANCEä¸ºä¹‹å‰çš„ç´¯åŠ å€¼ã€‚æ¥ç€ï¼Œä¸‹ä¸€æ¡å¯¼èˆªä¿¡æ¯çš„DIRECTIONåº”è¯¥æ ¹æ®ç›¸å¯¹æ–¹ä½è®¡ç®—ï¼ŒWAYæ˜¯å½“å‰<code>node</code>æ‰€åœ¨çš„è·¯ï¼ŒDISTANCEé‡æ–°ç´¯åŠ ã€‚</p>
<p>æœ€ç»ˆçš„æ•ˆæœï¼šè“è‰²çº¿è¡¨ç¤ºæœ€ä¼˜è·¯çº¿ï¼š <img src="https://img-blog.csdnimg.cn/20201126192103548.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å•å…ƒæµ‹è¯•è¿˜æ˜¯éå¸¸é‡è¦çš„ï¼Œåªæœ‰ç¡®ä¿æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯æ­£ç¡®çš„ï¼Œæœ€ç»ˆç»„åˆçš„åŠŸèƒ½æ‰å¯èƒ½æ­£ç¡®ã€‚ ## Autocomplete and Search ä½œä¸ºä¸€ä¸ªå¾ˆæœ‰ç”¨çš„Featureï¼Œè‡ªåŠ¨è¡¥å…¨è¿˜æ˜¯å¾ˆé…·çš„ï¼šæœç´¢åœ°åæ—¶åªè¾“å…¥ä¸€éƒ¨åˆ†ï¼Œå°±è¿”å›ä»¥å®ƒå¼€å¤´çš„æ‰€æœ‰åœ°åã€‚éœ€è¦åœ¨<code>MapServer</code>ç±»ä¸­å®ç°<code>List&lt;String&gt; getLocationsByPrefix(String prefix)</code>æ–¹æ³•ã€‚</p>
<p>è¾“å…¥çš„å‚æ•°<code>prefix</code>æ˜¯cleanåçš„å­—ç¬¦ä¸²ï¼šé™¤äº†å¤§å°å†™å­—æ¯ä»¥åŠç©ºæ ¼å¤–ï¼Œå…¶å®ƒå­—ç¬¦å…¨éƒ¨è¢«ç§»é™¤ï¼Œå…¨éƒ¨ç”±å°å†™å­—æ¯ç»„æˆã€‚ éœ€è¦è¿”å›æ‰€æœ‰locationsï¼ˆæœ‰<code>name</code>çš„<code>node</code>ï¼‰çš„å…¨åï¼Œå‰ææ˜¯cleanåçš„å…¨åä¸<code>prefix</code>åŒ¹é…ã€‚ å¤æ‚åº¦è¦æ±‚<span class="math inline">\(O(k)\)</span>ï¼Œkæ˜¯å…±äº«åŒä¸€å‰ç¼€çš„æ‰€æœ‰åœ°åã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼š <img src="https://img-blog.csdnimg.cn/20200902160016738.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> é™¤äº†è‡ªåŠ¨è¡¥å…¨ï¼Œè¿˜éœ€è¦å®ŒæˆSearchåŠŸèƒ½ï¼šcleanåçš„ç”¨æˆ·è¾“å…¥ä¸cleanåçš„<code>locationName</code>å®Œå…¨åŒ¹é…ï¼ŒåŒåçš„<code>location</code>éƒ½éœ€è¦åŠ å…¥<code>List</code>ã€‚ å¤æ‚åº¦è¦æ±‚<span class="math inline">\(O(k)\)</span>ï¼Œkæ˜¯åŒ¹é…çš„åœ°åä¸ªæ•°ã€‚ éœ€è¦åœ¨<code>MapServer</code>ç±»ä¸­å®ç°<code>List&lt;Map&lt;String, Object&gt;&gt; getLocations(String locationName)</code>æ–¹æ³•ï¼Œè¿”å›åŒåçš„æ‰€æœ‰åœ°æ–¹çš„ä¿¡æ¯ï¼Œå¦‚æœæ­£ç¡®å®ç°ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªmarkæ ‡è®°åœ¨é‚£ä¸ªåœ°æ–¹ï¼š <img src="https://img-blog.csdnimg.cn/20200906101859262.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å…·ä½“å®ç°ä¸€èˆ¬ç”¨Trieï¼Œè¿™é‡Œçš„éš¾ç‚¹åœ¨äºè¾“å…¥æ˜¯cleanåçš„å­—ç¬¦ä¸²ï¼Œéœ€è¦è¾“å‡ºcleanå‰çš„å…¨åï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Trieç»“ç‚¹é™¤äº†æœ‰<code>children</code>å’Œ<code>isWord</code>å¤–ï¼Œè¿˜éœ€è¦ä¿å­˜ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼ˆcleanå‰çš„<code>name</code>/<code>id</code>/<code>lat</code>/<code>lon</code>ï¼‰ï¼Œå½“ç„¶è¿™äº›ä¿¡æ¯åªæœ‰å¶å­ç»“ç‚¹æ‰éœ€è¦ä¿å­˜ï¼Œç”¨<code>List&lt;Map&lt;String, Object&gt;&gt; extraInfo</code>æ¥å­˜å‚¨ã€‚è¿™æ ·é‡åçš„åœ°ç‚¹è™½ç„¶å ç”¨äº†ç›¸åŒçš„å¶å­ï¼Œä½†æ˜¯æ‰€æœ‰åœ°ç‚¹çš„ä¿¡æ¯éƒ½å­˜åœ¨äº†è¯¥å¶å­çš„<code>extraInfo</code>å½“ä¸­ï¼Œå¯ä»¥ç›´æ¥å±•ç¤ºå‡ºæ¥ã€‚</p>
<p>Debugå¥½ç—›è‹¦å•Šï¼ï¼æœ‰ä¸€æ¬¡æ€ä¹ˆæ ·åœ¨æµè§ˆå™¨éƒ½æ¸²æŸ“ä¸å‡ºæ¥ï¼ŒæŠ˜è…¾äº†ä¸€å¤©ï¼Œæœ€åå‘ç°æ˜¯å› ä¸ºhtmlæ–‡ä»¶é‡Œä¸€ä¸ªjsæ–‡ä»¶è¦FQæ‰å¯ä»¥è®¿é—®ï¼Œé†‰äº†ã€‚ ## Extensions - Front-end Integration ç°åœ¨æ˜¯æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œå°±åœ¨åå°raster the entire imageï¼Œç„¶åä¼ åˆ°å‰ç«¯æ˜¾ç¤ºã€‚å®é™…ä¸­å‰ç«¯å¯ä»¥ç¼“å­˜ç”¨è¿‡çš„tilesä»¥åŠè·¯çº¿ï¼Œä¸‹æ¬¡è°ƒç”¨æ— éœ€åå°è®¡ç®—ã€‚ - Vectored Tiles ç°åœ¨çš„æ•°æ®æ˜¯ä¸€å¼ å¼ å›¾ç‰‡ï¼Œå®é™…ä¸Šè¿™äº›å›¾ç‰‡æ˜¯å¯ä»¥ä»roads, lines, filled areas, buildingsç­‰åŸºç¡€çŸ¢é‡å‡ ä½•å›¾å½¢æå–ï¼Œå¯ä»¥ç”¨OpenGL/WebGLå°†å…¶å…¨éƒ¨ç»˜åˆ¶ä¸ºä¸‰è§’å½¢ï¼Œè¿™æ ·éå¸¸åŒä¸€çš„å·¥ä½œå°±å¯ä»¥ç”¨GPUå»åšï¼Œé€Ÿåº¦æ¯”CPUè¦å¿«å¾ˆå¤šï¼Œè¿™äº›çŸ¢é‡å›¾å½¢å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://wiki.openstreetmap.org/wiki/Vector_tiles">è¿™é‡Œ</a>ä¸‹è½½ã€‚ - <a target="_blank" rel="noopener" href="https://sp19.datastructur.es/materials/proj/proj2c/heroku">Deploy on Heroku</a> ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åœ°å›¾è¿˜åªèƒ½åœ¨æœ¬åœ°è¿è¡Œï¼Œä¸‹æ¥å°±å°†å®ƒéƒ¨ç½²åˆ°æœåŠ¡å™¨~ å…·ä½“çš„éƒ¨ç½²è¿‡ç¨‹å¯ä»¥å‚è€ƒä¸Šè¿°é“¾æ¥ï¼Œå®ŒæˆåAPPå°±ä¼šéƒ¨ç½²åˆ°<a target="_blank" rel="noopener" href="http://bearmaps-fun.herokuapp.com/map.html">è¿™é‡Œ</a>ã€‚ åç»­çš„ä»£ç æ›´æ”¹éœ€è¦rebuild jaråŒ…ï¼Œç„¶åredeployã€‚ ## TODO åšå·¥ç¨‹çœŸæ˜¯é•¿æœŸçš„æ´»ï¼Œé‡åˆ°bugæ¯å¤©èƒ½å†™50è¡Œå°±ä¸é”™äº†ã€‚</p>
<p>æ‰€æœ‰<a target="_blank" rel="noopener" href="https://github.com/EIMadrigal/CS61B/tree/master/proj3">ä»£ç </a>å‡å·²é€šè¿‡AGçš„æµ‹è¯•ï¼š Part Iï¼š <img src="https://img-blog.csdnimg.cn/20200917210047412.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> PART II &amp; IIIï¼š <img src="https://img-blog.csdnimg.cn/20200917210119434.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> é™„åŠ Featureï¼š <img src="https://img-blog.csdnimg.cn/20201127214331958.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å•å…ƒæµ‹è¯•é™¤äº†<code>TestDirections</code>å¤–å…¨éƒ¨é€šè¿‡ã€‚ <img src="https://img-blog.csdnimg.cn/20201129193519713.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™ä¸ªBugçœŸçš„æœ‰äº›è¯¡å¼‚ï¼Œä¸è¿‡ï¼š <img src="https://img-blog.csdnimg.cn/20201201103328818.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å°½é‡å°‘ç”¨<code>protected</code>ä¿®é¥°æˆå‘˜å˜é‡ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥å£å»è®¿é—®ã€‚ ## Reference <a target="_blank" rel="noopener" href="https://sp18.datastructur.es/materials/proj/proj3/proj3">Project 3: Bear Maps, version 3.0</a> <a target="_blank" rel="noopener" href="https://sp19.datastructur.es/materials/proj/proj2c/proj2c">Project 2C: Bear Maps, version 4.0</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/11/02/Support%20Vector%20Machine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/02/Support%20Vector%20Machine/" class="post-title-link" itemprop="url">Support Vector Machine</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-02 04:52:00" itemprop="dateCreated datePublished" datetime="2020-11-02T04:52:00+08:00">2020-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SVMæ˜¯å…¥é—¨æœºå™¨å­¦ä¹ ç»•ä¸å¼€çš„ä¸€ä¸ªè¯é¢˜ï¼Œä½†æ„¿è¿™ç¯‡æ–‡ç« æˆ‘èƒ½æŠŠå®ƒè®²æ¸…æ¥šã€‚ ## çº¿æ€§å¯åˆ† SVMçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¯¹äº<span class="math inline">\(p\)</span>ç»´è¾“å…¥æ•°æ®é›†ï¼Œæ‰¾ä¸€ä¸ªæœ‰ç€maximum marginçš„<span class="math inline">\(p-1\)</span>ç»´çš„è¶…å¹³é¢å»åšdecision boundaryï¼Œè¿™ä¸ç›´è§‰æ˜¯ç›¸ç¬¦çš„ï¼š <img src="https://img-blog.csdnimg.cn/20200903193214259.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å›å¿†ä¸‹å°å­¦æ•°å­¦è®²è¿‡çš„å‡ ä½•çŸ¥è¯†ï¼šç©ºé—´ä¸­ä¸€ä¸ªè¶…å¹³é¢ç”±æ³•å‘é‡<span class="math inline">\(\vec w\)</span>å’Œæˆªè·<span class="math inline">\(b\)</span>å”¯ä¸€ç¡®å®šï¼š <span class="math display">\[a(x-x_1)+b(y-y_1)+c(z-z_1)+...=0, \\
w^Tx+b=0\]</span> é‚£ä¹ˆå¦‚ä½•æ±‚è§£æœ€ä¼˜è¶…å¹³é¢çš„<span class="math inline">\(w\)</span>å’Œ<span class="math inline">\(b\)</span>å‘¢ï¼Ÿ</p>
<p>å‡è®¾<span class="math inline">\(\vec w\)</span>æŒ‡å‘çš„ä¸€ä¾§ä¸ºæ­£ç±»ï¼ˆè®¾ä¸ºè´Ÿç±»ä¹Ÿæ²¡å…³ç³»ï¼Œåé¢ä¼šç»Ÿä¸€è¡¨ç¤ºçš„ï¼‰ï¼Œè¿˜<strong>å‡è®¾</strong>åœ¨æ­£ç±»çš„æ”¯æŒå‘é‡ä¸Šæœ‰<span class="math inline">\(w^Tx+b=1\)</span>ï¼Œåœ¨è´Ÿç±»çš„æ”¯æŒå‘é‡ä¸Šæœ‰<span class="math inline">\(w^Tx+b=-1\)</span>ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥å°†é—´éš”å‡è®¾ä¸º1ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºå’Œæ±‚è§£ï¼Œå¹¶ä¸å½±å“æœ€ç»ˆæ±‚å¾—çš„æœ€ä¼˜è¶…å¹³é¢å’Œå†³ç­–å‡½æ•°ï¼Œè¯æ˜å¦‚ä¸‹ï¼š</p>
<p>å‡è®¾æ­£ç±»æ”¯æŒå‘é‡è·æœ€ä¼˜è¶…å¹³é¢è·ç¦»ä¸º<span class="math inline">\(c(c&gt;0)\)</span>ï¼Œå³<span class="math inline">\(w^Tx+b=c\)</span>ï¼Œæ­¤æ—¶å¯¹åº”çš„æœ€ä¼˜è¶…å¹³é¢ä¸º<span class="math inline">\(w^Tx+b=0\)</span>ï¼›åˆ<span class="math inline">\(\frac{w^T}{c}x+\frac{b}{c}=1\)</span>ï¼Œå³<span class="math inline">\(w\)</span>å’Œ<span class="math inline">\(b\)</span>åŒæ—¶ç¼©å°<span class="math inline">\(c\)</span>å€ï¼Œé‚£ä¹ˆè¿™æ—¶è¶…å¹³é¢æ–¹ç¨‹åŒé™¤ä»¥<span class="math inline">\(c\)</span>å¹¶ä¸æ”¹å˜å…¶å½¢å¼ã€‚</p>
<p>å› æ­¤å¯¹äºæ­£è´Ÿæ ·æœ¬æœ‰ï¼š <span class="math display">\[w\cdot x_++b\geq 1 \\
w\cdot x_-+b\leq -1
\]</span> ä¸ºäº†ç»Ÿä¸€è¡¨ç¤ºä¸Šé¢2ç§æƒ…å†µï¼Œå¼•å…¥<span class="math inline">\(y_i=\begin{cases} 1,&amp;\text{+sample}\\ -1,&amp;\text{-sample} \end{cases}\)</span>ï¼Œæ‰€æœ‰æ ·æœ¬ç»Ÿä¸€è¡¨ç¤ºä¸ºï¼š <span class="math display">\[y_i(w\cdot x_i+b)-1\geq 0\]</span> å¦‚æœèƒ½ç¡®å®š<span class="math inline">\(b\)</span>å’Œ<span class="math inline">\(w\)</span>ï¼Œé‚£ä¹ˆåˆ†ç±»è¶…å¹³é¢å’Œå†³ç­–å‡½æ•°ä¹Ÿå°±éšå³ç¡®å®šã€‚</p>
<p>æ ¹æ®å°å­¦æ•°å­¦ï¼Œé—´éš”å³ä¸º2ä¸ªå¹³è¡Œè¶…å¹³é¢çš„è·ç¦»ï¼š <span class="math display">\[width=\frac{(b+1)-(b-1)}{||w||}=\frac{2}{||w||}\tag{1}\]</span></p>
<p>ç»¼ä¸Šï¼Œ<strong>åŸä¼˜åŒ–é—®é¢˜</strong>ä¸ºï¼š <span class="math display">\[
\begin{array}{ll}
\min _{w, b} &amp; \frac{1}{2}\|w\|^{2} \\
\text { s.t. } &amp; y_{i}\left(w \cdot x_{i}+b\right)-1 \geqslant 0, \quad i=1,2, \cdots, N
\end{array}\tag{2}
\]</span> è¿™é‡Œä¹‹æ‰€ä»¥æ„é€ ä¸º<span class="math inline">\(\frac{1}{2}\|w\|^{2}\)</span>è€Œä¸æ˜¯<span class="math inline">\(||w||\)</span>æ˜¯ä¸ºäº†åé¢æ„é€ çš„Lagrangianæ±‚å¯¼çš„ä¾¿åˆ©ã€‚</p>
<p>æ˜çœ¼äººéƒ½çœ‹å¾—å‡ºæ¥ï¼šä¼˜åŒ–ç›®æ ‡æ˜¯ä¸€ä¸ªConvex Quadratic Optimization Problemï¼Œå¹¶ä¸”åªæœ‰çº¿æ€§çº¦æŸæ¡ä»¶ï¼Œæ„å‘³ç€ä¸ä¼šå¡åœ¨å±€éƒ¨æå¤§ï¼Œä¸€å®šå¯ä»¥æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£ã€‚æ­¤æ—¶ä¸Šè¿°é—®é¢˜å·²ç»å®Œå…¨å¯ä»¥ç”¨ä¸€äº›QPè½¯ä»¶æ±‚è§£äº†ã€‚ä¹‹æ‰€ä»¥è¿˜è¦ç»§ç»­è®¨è®ºä¸‹å»å¾—åˆ°å…¶å¯¹å¶å½¢å¼ï¼Œä¸€æ˜¯ä¸ºäº†åœ¨é«˜ç»´ç©ºé—´åº”ç”¨kernelï¼ŒäºŒæ˜¯å¯¹å¶å½¢å¼çš„æ±‚è§£æœ‰ç€æ›´åŠ é«˜æ•ˆçš„ç®—æ³•ã€‚</p>
<p>å›å¿†ä¸‹å­¦è¿‡çš„é«˜ç­‰æ•°å­¦ï¼šæœ‰çº¦æŸä¼˜åŒ–é—®é¢˜å¯ä»¥é€šè¿‡æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•æ±‚è§£ã€‚é¦–å…ˆæ„é€ Lagrangianï¼š <span class="math display">\[L(w,b,\alpha)=\frac{||w||^2}{2}-\sum_{i=1}^{N}\alpha_i[y_i(w\cdot x_i+b)-1],\alpha_i\geq0\tag{3}\]</span> å¦‚æœ<span class="math inline">\(w\)</span>å’Œ<span class="math inline">\(b\)</span>æ»¡è¶³<span class="math inline">\((2)\)</span>ä¸­çš„çº¦æŸï¼Œé‚£ä¹ˆ<span class="math inline">\(\max_{\alpha}L(w,b,\alpha)=\frac{||w||^2}{2}\)</span>ï¼› å¦‚æœ<span class="math inline">\(w\)</span>å’Œ<span class="math inline">\(b\)</span>ä¸æ»¡è¶³<span class="math inline">\((2)\)</span>ä¸­çš„çº¦æŸï¼Œé‚£ä¹ˆ<span class="math inline">\(\max_{\alpha}L(w,b,\alpha)=+\infin\)</span>ã€‚ å› æ­¤ä¸‹å¼çš„ä¼˜åŒ–é—®é¢˜ä¸<span class="math inline">\((2)\)</span>å®Œå…¨ç­‰ä»·ï¼š <span class="math display">\[
\min_{w, b}\max_{\alpha} L(w, b, \alpha)\tag{4}
\]</span> æ ¹æ®æ‹‰æ ¼æœ—æ—¥å¯¹å¶æ€§ï¼ˆä¸æ‡‚å°±æš‚æ—¶å½“ä½œæˆç«‹å§å˜»å˜»ï¼‰ï¼Œ<span class="math inline">\((4)\)</span>çš„å¯¹å¶é—®é¢˜ä¸ºï¼š <span class="math display">\[
\max_{\alpha} \min_{w, b} L(w, b, \alpha)\tag{5}
\]</span> ä¸ºäº†æ±‚è§£å¯¹å¶é—®é¢˜<span class="math inline">\((4)\)</span>ï¼Œå…ˆæ±‚<span class="math inline">\(L\)</span>å¯¹<span class="math inline">\(w,b\)</span>çš„æå°ï¼Œå†æ±‚å¯¹<span class="math inline">\(\alpha\)</span>çš„æå¤§ï¼š</p>
<ol type="1">
<li>å›ºå®š<span class="math inline">\(\alpha\)</span>ï¼Œæ±‚<span class="math inline">\(\min_{w, b} L(w, b, \alpha)\)</span> åˆ†åˆ«æ±‚<span class="math inline">\(L\)</span>å¯¹<span class="math inline">\(\vec{w}\)</span>å’Œ<span class="math inline">\(b\)</span>çš„åå¯¼å¹¶ä»¤å…¶ä¸º0ï¼š <span class="math display">\[\frac{\partial L}{\partial\vec{w}}=\vec{w}-\Sigma\alpha_iy_ix_i=0, \vec{w}=\Sigma\alpha_iy_ix_i \\
\frac{\partial L}{\partial b}=\Sigma\alpha_iy_i=0, \Sigma\alpha_iy_i=0\tag{6}\]</span> å†³ç­–å‘é‡<span class="math inline">\(\vec{w}\)</span>æ˜¯æ ·æœ¬çš„çº¿æ€§å’Œï¼Œå°†<span class="math inline">\(\vec{w}\)</span>ä»£å…¥<span class="math inline">\((3)\)</span>ï¼š <span class="math display">\[\min_{w, b}L=\Sigma\alpha_i-\frac{1}{2}\Sigma_i\Sigma_j\alpha_i\alpha_jy_iy_jx_i\cdot x_j\tag{7}\]</span></li>
<li>æ±‚<span class="math inline">\(\min_{w, b} L(w, b, \alpha)\)</span>å¯¹<span class="math inline">\(\alpha\)</span>çš„æå¤§ å³æ±‚<span class="math inline">\((7)\)</span>å¯¹<span class="math inline">\(\alpha\)</span>çš„æå¤§ï¼Œç­‰ä»·äºå–è´Ÿå·æ±‚å¯¹<span class="math inline">\(\alpha\)</span>çš„æå°ï¼Œäºæ˜¯ç»ˆäºå¾—åˆ°äº†<strong>åŸä¼˜åŒ–é—®é¢˜</strong><span class="math inline">\((2)\)</span>çš„<strong>å¯¹å¶ä¼˜åŒ–é—®é¢˜</strong>ï¼š <span class="math display">\[
\begin{array}{ll}
\min _{\alpha} &amp; \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } &amp; \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
&amp; \alpha_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}\tag{8}
\]</span></li>
</ol>
<p>åˆ©ç”¨SMOç­‰ç®—æ³•å¯ä»¥æ¯”æ™®é€šçš„äºŒæ¬¡è§„åˆ’ç®—æ³•æ›´é«˜æ•ˆæ±‚å¾—æœ€ä¼˜çš„<span class="math inline">\(\alpha^*\)</span>ï¼Œè¿›è€Œæ ¹æ®<span class="math inline">\((6)\)</span>æ±‚å¾—ï¼š <span class="math display">\[w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i}\tag{9}\]</span> å†åˆ©ç”¨KKTæ¡ä»¶ï¼ˆä¸æ‡‚å°±è£…æ‡‚å§å˜»å˜»ï¼‰æ±‚å¾—ï¼š <span class="math display">\[b^{*}=y_{j}-(w^*)^Tx_j=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}\left(x_{i} \cdot x_{j}\right)\tag{10}\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(y_{j}\)</span>ä¸ºä»»æ„ä¸€ä¸ªæ”¯æŒå‘é‡ã€‚</p>
<p>æœ€ç»ˆçš„åˆ†ç±»è¶…å¹³é¢ä¸ºï¼š <span class="math display">\[w^{*}\cdot x+b^{*}=0,\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}(x_{i}\cdot x)+b^{*}=0\tag{11}\]</span> åˆ†ç±»å†³ç­–å‡½æ•°ä¸ºï¼š <span class="math display">\[f(x)=sign(w^{*}\cdot x+b^{*})=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}(x_{i}\cdot x)+b^{*}\tag{12}\]</span> æœ€åè¦bbçš„æ˜¯å…³äºæ”¯æŒå‘é‡ï¼Œæ ¹æ®KKTæ¡ä»¶é‡Œçš„äº’è¡¥æ¡ä»¶<span class="math inline">\(\alpha_{i}^{*}[y_{i}(x_{i}\cdot w^*+b^{*})-1]=0\)</span>ï¼šéæ”¯æŒå‘é‡å¿…ç„¶æœ‰<span class="math inline">\(\alpha_{i}^{*}=0\)</span>ï¼Œåªæœ‰æ”¯æŒå‘é‡æ‰å¯èƒ½å‡ºç°<span class="math inline">\(\alpha_{i}^{*}&gt;0\)</span>ã€‚</p>
<p>å¦‚æœå›å¤´çœ‹<span class="math inline">\((9)(10)(11)(12)\)</span>ï¼Œæ‰€æœ‰çš„éæ”¯æŒå‘é‡å¯¹SVMæ²¡æœ‰ä»»ä½•å½±å“ï¼Œæœ€ä¼˜è¶…å¹³é¢ä»¥åŠå†³ç­–å‡½æ•°éƒ½åªç”±å°‘é‡çš„æ”¯æŒå‘é‡å†³å®šï¼Œè¿™å¤§æ¦‚å°±æ˜¯æ”¯æŒå‘é‡æœºåç§°çš„ç”±æ¥å§~ ## è¿‘ä¼¼çº¿æ€§å¯åˆ† ä¸Šé¢è®¨è®ºäº†å®Œå…¨çº¿æ€§å¯åˆ†çš„æƒ…å†µï¼Œç„¶è€Œåœ¨ç°å®æƒ…å†µä¸­ï¼Œè®­ç»ƒæ•°æ®ä¼šæœ‰ä¸€äº›outliersï¼Œé™¤å»è¿™äº›ç‚¹åæ•°æ®æ˜¯çº¿æ€§å¯åˆ†çš„ã€‚ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œå…è®¸SVMåˆ†é”™ä¸€äº›æ ·æœ¬ã€‚å¯¹æ¯ä¸ªæ ·æœ¬ç‚¹å¼•å…¥æ¾å¼›å› å­<span class="math inline">\(\xi_{i} \geqslant 0\)</span>ï¼Œå³æ ·æœ¬ç‚¹çš„å‡½æ•°é—´éš”åªéœ€è¦å¤§äº<span class="math inline">\(1-\xi_{i}\)</span>ï¼Œæ”¾æ¾äº†é™åˆ¶æ¡ä»¶ï¼Œ<strong>åŸä¼˜åŒ–é—®é¢˜</strong>å˜ä¸ºï¼š <span class="math display">\[
\begin{array}{ll}
\min _{w, b, \xi} &amp; \frac{1}{2}\|w\|^{2}+C \sum_{i=1}^{N} \xi_{i} \\
\text { s.t. } &amp; y_{i}\left(w \cdot x_{i}+b\right) \geqslant 1-\xi_{i}, \quad i=1,2, \cdots, N \\
&amp; \xi_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}\tag{13}
\]</span> å¦‚æœæ ·æœ¬ç‚¹ä¸¥æ ¼æ»¡è¶³çº¦æŸï¼Œå¯¹äºæŸå¤±å‡½æ•°æ²¡æœ‰è´¡çŒ®ï¼›å¦‚æœä¸ä¸¥æ ¼æ»¡è¶³å³<span class="math inline">\(\xi_{i}&gt;0\)</span>ï¼ŒæŸå¤±å‡½æ•°å°±ä¼šæœ‰ç›¸åº”çš„æƒ©ç½šã€‚æƒ©ç½šå‚æ•°<span class="math inline">\(C\)</span>æ§åˆ¶äº†ä¸€ç§æƒè¡¡ï¼šæ—¢è¦é—´éš”æœ€å¤§ï¼ˆå³<span class="math inline">\(min\ ||w||\)</span>ï¼‰ï¼Œåˆè¦åˆ†å¯¹å°½å¯èƒ½å¤šçš„æ ·æœ¬ç‚¹ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œ<span class="math inline">\((13)\)</span>å¯ä»¥é€šè¿‡æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•è½¬æ¢ä¸ºå¯¹å¶é—®é¢˜åå†å»æ±‚è§£ï¼Œå»ºè®®åƒé¥±çš„åŒå­¦è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚<span class="math inline">\((13)\)</span>çš„<strong>å¯¹å¶ä¼˜åŒ–é—®é¢˜</strong>æ˜¯ï¼š <span class="math display">\[
\begin{array}{ll}
\min _{\alpha} &amp; \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(x_{i} \cdot x_{j}\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } &amp; \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
&amp; 0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{array}\tag{14}
\]</span> æ­¤æ—¶æ­¤åˆ»æ°å¦‚å½¼æ—¶å½¼åˆ»ï¼Œä½¿ç”¨æ™®é€šçš„äºŒæ¬¡è§„åˆ’ç®—æ³•æˆ–è€…æ›´é«˜æ•ˆçš„SMOæ±‚è§£<span class="math inline">\((14)\)</span>å¾—åˆ°æœ€ä¼˜çš„<span class="math inline">\(\alpha_{i}^{*}\)</span>ï¼Œè¿›è€Œå¾—åˆ°è½¯é—´éš”SVMçš„è§£ï¼š <span class="math display">\[
w^{*}=\sum_{i=1}^{N} \alpha_{i}^{*} y_{i} x_{i} \\
b^{*}=y_{j}-\sum_{i=1}^{N} \alpha_{i}^{*} y_{i}\left(x_{i} \cdot x_{j}\right)\tag{15}
\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(y_{j}\)</span>è¦æ»¡è¶³<span class="math inline">\(0&lt;\alpha_j&lt;C\)</span>ã€‚ ## éçº¿æ€§å¯åˆ† ä¸Šé¢è®¨è®ºäº†çº¿æ€§åˆ†ç±»é—®é¢˜ï¼Œå¯¹äºéçº¿æ€§å¯åˆ†é—®é¢˜ï¼ŒSVMçš„æ€æƒ³æ˜¯åšä¸€ä¸ªå˜æ¢<span class="math inline">\(\phi(\vec{x})\)</span>ï¼Œå°†æ ·æœ¬æ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªç©ºé—´ï¼Œä¹Ÿè®¸å°±çº¿æ€§å¯åˆ†äº†ã€‚ ç”±äºç›®æ ‡å‡½æ•°å’Œå†³ç­–å‡½æ•°<strong>åªä¾èµ–äºæ ·æœ¬å¯¹ä¹‹é—´çš„ç‚¹ç§¯</strong>ï¼Œæ‰€ä»¥æ— éœ€æ˜¾å¼å®šä¹‰å˜æ¢<span class="math inline">\(\phi(\vec{x})\)</span>ï¼Œåªè¦å®šä¹‰ä¸€ä¸ªå‡½æ•°<span class="math inline">\(K(\vec{x_i},\vec{x_j})=\phi(\vec{x_i})\cdot\phi(\vec{x_j})\)</span>æä¾›æ–°ç©ºé—´çš„æ ·æœ¬ç‚¹çš„ç‚¹ç§¯å³å¯ï¼Œ<span class="math inline">\(K\)</span>å«åš<strong>Kernel Function</strong>ã€‚ æ­¤æ—¶åŸä¼˜åŒ–é—®é¢˜ä¸ºï¼š <span class="math display">\[
\begin{array}{ll}
\min _{w, b, \xi} &amp; \frac{1}{2}\|w\|^{2}+C \sum_{i=1}^{N} \xi_{i} \\
\text { s.t. } &amp; y_{i}\left(w^T \phi(x_{i})+b\right) \geqslant 1-\xi_{i}, \quad i=1,2, \cdots, N \\
&amp; \xi_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}
\]</span> å¯¹å¶é—®é¢˜ä¸ºï¼š <span class="math display">\[
\begin{array}{ll}
\min _{\alpha} &amp; \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(K(x_{i},x_{j})\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } &amp; \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
&amp; 0 \leqslant \alpha_{i} \leqslant C, \quad i=1,2, \cdots, N
\end{array}
\]</span> ä¸€ç§å¸¸ç”¨çš„kernelæ˜¯çº¿æ€§çš„ï¼š<span class="math inline">\((\vec{u}\cdot\vec{v}+1)^n\)</span>ï¼Œå½“å‰ç©ºé—´çš„<span class="math inline">\(u\)</span>å’Œ<span class="math inline">\(v\)</span>é€šè¿‡ç®€å•çš„ç‚¹ç§¯æ˜ å°„åˆ°äº†å¦ä¸€ä¸ªç©ºé—´ï¼› å¦ä¸€ç§kernelæ˜¯é«˜æ–¯æ ¸ï¼š<span class="math inline">\(e^{-\frac{||x_i-x_j||^2}{\sigma}}=e^{-\gamma{||x_i-x_j||}^2}\)</span>ã€‚ é«˜æ–¯æ ¸å¯¹åº”é«˜æ–¯å¾„å‘åŸºå‡½æ•°åˆ†ç±»å™¨ï¼Œè¿™é‡Œæœ‰2ä¸ªå‚æ•°<span class="math inline">\(C\)</span>å’Œ<span class="math inline">\(\gamma\)</span>éœ€è¦è°ƒèŠ‚ï¼šæƒ©ç½šç³»æ•°<span class="math inline">\(C\)</span>è¡¨ç¤ºåˆ†ç±»å™¨å¯¹äºè¯¯å·®çš„å®½å®¹åº¦ï¼Œ<span class="math inline">\(C\)</span>è¶Šå¤§è¡¨ç¤ºè¶Šä¸èƒ½å®¹å¿è¯¯å·®ï¼Œå®¹æ˜“è¿‡æ‹Ÿåˆï¼ŒæŒ‰ç…§ç»éªŒå¯ä»¥åœ¨<span class="math inline">\([10^{-4},10^4]\)</span>é—´è°ƒèŠ‚ï¼›<span class="math inline">\(\gamma\)</span>æ§åˆ¶å¾„å‘ä½œç”¨èŒƒå›´ï¼Œ<span class="math inline">\(\gamma\)</span>è¶Šå¤§ï¼Œå¾„å‘ä½œç”¨èŒƒå›´è¶Šå°ï¼Œæœ‰å¯èƒ½å°†æ¯ä¸ªæ ·æœ¬ç‚¹å•ç‹¬å½¢æˆä¸€ä¸ªåˆ†ç±»ï¼Œå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œ<span class="math inline">\(\gamma\)</span>è¿‡å°ï¼Œå¾„å‘èŒƒå›´è¿‡å¤§ï¼Œå®¹æ˜“å°†2ä¸ªæ ·æœ¬æ˜ å°„ä¸ºåŒä¸€ä¸ªç‚¹ï¼Œæ— æ³•åŒºåˆ†ï¼Œä¸€èˆ¬<span class="math inline">\(\gamma=\frac{1}{æ ·æœ¬ç‰¹å¾æ•°}\)</span>ã€‚å¦å¤–ï¼Œè¿™2ä¸ªå‚æ•°å¯ä»¥é€šè¿‡äº¤å‰éªŒè¯å’Œgrid-searchæ¥è°ƒæ•´ã€‚ ## æ‰©å±• SVMå¤„ç†å¤šåˆ†ç±»é—®é¢˜çš„æ–¹å¼ä¸»è¦æœ‰2ç§ï¼š</p>
<ul>
<li>one-against-one åœ¨æ¯2ä¸ªç±»ä¹‹é—´éƒ½æ„é€ ä¸€ä¸ªbinary SVMï¼Œå…±æœ‰<span class="math inline">\(C_m^2\)</span>ä¸ªSVMï¼Œå¯¹æ–°æ•°æ®é‡‡ç”¨Votingçš„æ–¹å¼è¿›è¡Œåˆ†ç±»ã€‚</li>
<li>one-against-the-rest å¯¹æ¯ä¸ªç±»ï¼Œå°†å…¶ä½œä¸ºæ­£ç±»ï¼Œå…¶ä½™<span class="math inline">\(m-1\)</span>ä¸ªç±»ä½œä¸ºè´Ÿç±»ï¼Œå…±<span class="math inline">\(m\)</span>ä¸ªSVMï¼Œå¯¹æ–°æ•°æ®é‡‡ç”¨winner-takes-allç­–ç•¥ã€‚</li>
</ul>
<p>å¦‚æœæ ·æœ¬ä¸å‡è¡¡ï¼Œç›®æ ‡å‡½æ•°ä¸­çš„æƒ©ç½šé¡¹ä¸»è¦ç”±å¤šæ•°ç±»æ„æˆï¼Œè¶…å¹³é¢åå‘å°‘æ•°ç±»ï¼Œç”šè‡³å°†æ‰€æœ‰æ ·æœ¬éƒ½åˆ†åœ¨åŒä¸€ä¾§ã€‚ æ­¤æ—¶ç›®æ ‡å˜ä¸ºäº†åœ¨ä¸ä¸¥é‡æŸå¤±å¤šæ•°ç±»ç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œåœ¨å°‘æ•°ç±»ä¸Šè·å¾—å°½å¯èƒ½é«˜çš„åˆ†ç±»æ­£ç¡®ç‡ã€‚ä¸€èˆ¬æ¥è®²æœ‰2ç§åšæ³•ï¼š</p>
<ul>
<li>æ•°æ®åˆæˆ å¯¹å°‘æ•°ç±»æ ·æœ¬è¿›è¡Œåˆ†æå¹¶æ ¹æ®å…¶ç‰¹ç‚¹äººå·¥æ’å€¼åˆæˆæ–°æ ·æœ¬æ·»åŠ åˆ°æ•°æ®é›†ä¸­ï¼Œæ„æˆå‡è¡¡æ•°æ®é›†ã€‚æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æ˜¯SMOTE(Synthetic Minority Oversampling Technique)ã€‚</li>
<li>åŠ æƒSVM å°†å°‘æ•°ç±»åˆ†é”™çš„ä»£ä»·å¾ˆå¤§ï¼Œæ‰€ä»¥åœ¨æƒ©ç½šé¡¹ä¸­å¯¹ä¸¤ä¸ªç±»è®¾ç½®ä¸åŒçš„æƒ©ç½šç³»æ•°ï¼Œå°‘æ•°ç±»çš„ç³»æ•°è®¾ç½®æ›´å¤§ï¼Œç”šè‡³å¯ä»¥å¯¹æ¯ä¸ªæ ·æœ¬éƒ½è®¾ç½®ä¸åŒçš„æƒ©ç½šç³»æ•°ï¼Œæ­¤æ—¶åŸä¼˜åŒ–é—®é¢˜å˜ä¸ºï¼š <span class="math display">\[
\begin{array}{ll}
\min _{w, b, \xi} &amp; \frac{1}{2}\|w\|^{2}+C^+ \sum_{y_i=1} \xi_{i}+C^-\sum_{y_i=-1} \xi_{i} \\
\text { s.t. } &amp; y_{i}\left(w^T \phi(x_{i})+b\right) \geqslant 1-\xi_{i}, \quad i=1,2, \cdots, N \\
&amp; \xi_{i} \geqslant 0, \quad i=1,2, \cdots, N
\end{array}
\]</span> å¯¹å¶é—®é¢˜ï¼š <span class="math display">\[
\begin{array}{ll}
\min _{\alpha} &amp; \frac{1}{2} \sum_{i=1}^{N} \sum_{j=1}^{N} \alpha_{i} \alpha_{j} y_{i} y_{j}\left(K(x_{i},x_{j})\right)-\sum_{i=1}^{N} \alpha_{i} \\
\text { s.t. } &amp; \sum_{i=1}^{N} \alpha_{i} y_{i}=0 \\
&amp; 0 \leqslant \alpha_{i} \leqslant C^+, y_i=+1 \\
&amp; 0 \leqslant \alpha_{i} \leqslant C^-, y_i=-1
\end{array}
\]</span></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/10/23/IO%20Multiplexing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/23/IO%20Multiplexing/" class="post-title-link" itemprop="url">IO Multiplexing</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-23 10:28:00" itemprop="dateCreated datePublished" datetime="2020-10-23T10:28:00+08:00">2020-10-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å½“å¤šä¸ªç‹¬ç«‹çš„I/Oäº‹ä»¶åŒæ—¶å‘ç”Ÿæ—¶ï¼ŒI/Oå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§è§£å†³æ–¹å¼ã€‚ ä¸ºäº†æé«˜æœåŠ¡å™¨çš„ååé‡ï¼Œ<strong>å•ä¸ªçº¿ç¨‹</strong>é€šè¿‡è®°å½•è·Ÿè¸ªæ¯ä¸ªI/Oæµçš„çŠ¶æ€åŒæ—¶ç®¡ç†å¤šä¸ªI/Oæµï¼Œéå¸¸ç±»ä¼¼æ—¶åˆ†å¤ç”¨æŠ€æœ¯ã€‚ <img src="https://img-blog.csdnimg.cn/20200825092905568.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°æ–¹å¼æœ‰3ç§ï¼š<code>select()</code>ã€<code>poll()</code>å’Œ<code>epoll()</code>ã€‚ ## select <code>select()</code>ç³»ç»Ÿè°ƒç”¨ï¼š<code>int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);</code> <code>select()</code>ä¼šä¸€ç›´é˜»å¡ç›´åˆ°è‡³å°‘ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œå¯ä»¥è¯»å†™ï¼Œæˆ–è€…å‡ºç°å¼‚å¸¸ã€‚ ä¸­é—´3ä¸ªå‚æ•°ä¼šè¢«ä¿®æ”¹ï¼Œè¡¨ç¤ºå“ªä¸ªFDå‡†å¤‡å¥½äº†ï¼Œæœ€åä¸€ä¸ªè¡¨ç¤ºç­‰å¾…æ—¶é—´ï¼ŒNULLè¡¨ç¤ºæ— é™ç­‰å¾…ã€‚ è¿”å›å°±ç»ªçš„FDæ•°ç›®ï¼Œæœ‰é”™-1ã€‚åªçŸ¥é“æœ‰å°±ç»ªï¼Œä¸çŸ¥é“å“ªä¸ªFDå°±ç»ªäº†ã€‚ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> s = socket();</span><br><span class="line">bind();</span><br><span class="line">listen();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fd[];  <span class="comment">// éœ€è¦ç›‘å¬çš„socketé›†åˆ</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">	<span class="keyword">int</span> n = select();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fd.size(); ++i) &#123;</span><br><span class="line">		<span class="keyword">if</span> (FD_ISSET()) &#123;  <span class="comment">// åˆ¤æ–­å“ªä¸ªsocketæ¥æ”¶åˆ°æ•°æ®</span></span><br><span class="line">			<span class="comment">// å¤„ç†æ•°æ®</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <code>select()</code>æ˜¯é˜»å¡æ–¹æ³•ï¼Œåªæœ‰æŸä¸ªsocketæ¥æ”¶åˆ°æ•°æ®æ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œå”¤é†’è¿›ç¨‹ã€‚ ç›´æ¥çš„æ–¹å¼ç¼ºç‚¹å°±æ¯”è¾ƒå¤šï¼š</p>
<ul>
<li>æ—¶é—´å¼€é”€å¤§ï¼Œæ‰€ä»¥è§„å®šæœ€å¤šç›‘å¬1024ä¸ªsocketï¼›</li>
<li>æ¯æ¬¡è°ƒç”¨éƒ½è¦æŠŠfdé›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ã€‚</li>
<li>çº¿ç¨‹ä¸å®‰å…¨ï¼š</li>
</ul>
<blockquote>
<p>If a file descriptor being monitored by select() is closed in another thread, the result is unspecified. ## poll å»æ‰äº†1024çš„é™åˆ¶ï¼Œçº¿ç¨‹ä¸å®‰å…¨ã€‚ ## epoll çº¿ç¨‹å®‰å…¨ï¼ŒçŸ¥é“å“ªä¸ªFDå°±ç»ªï¼Œåªæœ‰Linuxæ”¯æŒã€‚ ç›¸æ¯”äº<code>select()</code>ï¼Œ<code>epoll()</code>ä¸ä¼šæ— å·®åˆ«è½®è¯¢ï¼Œåªå¤„ç†æ¥æ”¶åˆ°æ•°æ®çš„socketï¼Œè¿™æ ·å¤æ‚åº¦å°±é™ä½ä¸º<span class="math inline">\(O(k)\)</span>ã€‚ ## Reference <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/32163005/answer/55772739">I/Oå¤šè·¯å¤ç”¨æ˜¯ä»€ä¹ˆæ„æ€</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/10/18/%E9%AD%8F%E6%99%8B%E9%A3%8E%E5%BA%A6%E6%B5%85%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/18/%E9%AD%8F%E6%99%8B%E9%A3%8E%E5%BA%A6%E6%B5%85%E6%8E%A2/" class="post-title-link" itemprop="url">é­æ™‹é£åº¦æµ…æ¢</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-18 14:00:00" itemprop="dateCreated datePublished" datetime="2020-10-18T14:00:00+08:00">2020-10-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ä»å°å­¦ä½œæ–‡å¼€å§‹ï¼Œå°±å–œæ¬¢å†™ä¸€äº›è¾è—»åä¸½çš„è¯—æ­Œæ–‡ç« ã€‚ ç«¹æ—ä¸ƒè´¤æˆ‘å½“æ—¶åªå¬è¯´è¿‡å±±æ¶›ã€é˜®ç±å’Œåµ‡åº·ï¼Œå¼•ç”¨ä¹‹æ„æ˜¯è§‰è¿™å‡ ä½é—ä¸–ç‹¬ç«‹ã€å‚²ç„¶é£éª¨ï¼Œæ²¡æœ‰ä¸–ä¿—ç¾ç»Šï¼Œæ•´æ—¥ç´æ£‹ä¹¦ç”»ã€é¥®é…’ä½œä¹ã€ä¸é—®ä¸–äº‹ï¼Œæ½‡æ´’å†™æ„çš„ç”Ÿæ´»ï¼Œæ­£æ˜¯å¾å‘å¾€ä¹‹ã€‚ã€Šå¹¿é™µæ•£ã€‹å’Œã€Šä¸å±±å·¨æºç»äº¤ä¹¦ã€‹æ›´æ˜¯å‹¾èµ·äº†æˆ‘å¯¹äºåµ‡åº·æ— é™çš„å´‡æ‹œã€‚ æˆ‘æå–œæ¬¢åµ‡åº·å’Œçº³å…°æ€§å¾·ï¼Œå³ä½¿ä¸€äº›æ¯«æ— å…³è”çš„é¢˜ç›®ï¼Œä¹Ÿè¦ç”¨ä»–ä»¬çš„äº‹ä¾‹å¼ºè¡Œå»é˜è¿°è®ºç‚¹ã€‚ä½†ç”±äºåªå–œæ¬¢é’»ç ”è¿‘ç°ä»£çš„æˆ˜äº‰å²ï¼ˆå¯ä»¥åŸè°…ï¼Œç”·å­©ä¸€èˆ¬éƒ½å–œæ¬¢æªæ”¯ã€ç«ç‚®ç­‰è¿‘ç°ä»£æ­¦å™¨ï¼‰ï¼Œä¸€ç›´å¯¹å¤ä»£å²ä¸æ„Ÿå…´è¶£ï¼Œè§‰å¾—å‡ åƒå¹´å‰çš„æ–‡åŒ–æ•…äº‹ä¸è¿‡æ˜¯è½åã€è…æœ½çš„ä»£åè¯è€Œå·²ï¼Œæ‰€ä»¥å…¶å®å¯¹ä¸€äº›äººç‰©åªæ˜¯ç•¥çŸ¥ä¸€äºŒï¼Œæœ€è¿‘èŠ±äº†äº›æ—¶é—´é‡æ–°æ‹äº†ä¸€ä¸‹é­æ™‹é‚£æ®µå†å²ï¼Œæ•…åˆ†äº«äºæ­¤ã€‚ ## å†å²èƒŒæ™¯ æˆ‘ä¸€ç›´è§‰å¾—æƒ³è¦çœŸæ­£äº†è§£ä¸€æ®µæ–‡åŒ–ã€ä¸€ä¸ªäººç‰©ï¼Œå°±é¦–å…ˆè¦äº†è§£ä»–ä»¬æ‰€å¤„çš„å†å²æ—¶ä»£ã€‚ æ›¹æ“åœ¨ä¸œæ±‰æœ«å¹´çš„ç¾¤é›„é€é¹¿ä¸­â€œæŒŸå¤©å­ä»¥ä»¤è¯¸ä¾¯â€ï¼Œåœ¨ä¸‰å›½æœ«æœŸåŠ¿åŠ›æœ€å¼ºã€‚æ›¹æ“å»ä¸–åï¼Œå…¶å­æ›¹ä¸•äºå…¬å…ƒ220å¹´å»ºç«‹æ›¹é­æ”¿æƒã€‚å…¬å…ƒ265å¹´ï¼Œå¸é©¬ç‚å»ºç«‹è¥¿æ™‹ï¼Œå²ç§°æ™‹æ­¦å¸ã€‚ç«¹æ—ä¸ƒè´¤å°±æ˜¯ç”Ÿæ´»åœ¨è¿™æ ·ä¸€æ®µå†å²æ—¶æœŸï¼š å±±æ¶›ï¼š205~283 é˜®ç±ï¼š210~263 åµ‡åº·ï¼š224~263 åˆ˜ä¼¶ï¼š221~300 å‘ç§€ï¼š227~272 é˜®å’¸ï¼šä¸è¯¦ ç‹æˆï¼š234~305 æ›¹ä¸•å»ä¸–åï¼Œæ›¹å¡å³ä½ï¼Œå…¬å…ƒ239å¹´éš†å†¬æ—¶èŠ‚ï¼Œæ›¹å¡é©¾å´©ä¹‹é™…ï¼Œå°†çš‡ä½ä¼ ç»™ä»…ä»…8å²çš„æ›¹èŠ³ï¼Œå¹¶å°†å…¶åŒæ—¶æ‰˜å­¤ç»™å¸é©¬æ‡¿å’Œæ›¹çˆ½ï¼Œäºæ˜¯åœ¨æ¥ä¸‹æ¥æ¼«é•¿çš„å‡ åå¹´ä¸­ï¼Œæ›¹æ°é›†å›¢å’Œå¸é©¬æ°é›†å›¢å¼€å§‹äº†ä½ æ­»æˆ‘æ´»çš„æ”¿æ²»æ–—äº‰ï¼Œå²ç§°â€œæ›¹é©¬ä¹‹äº‰â€ã€‚ ## ç«¹æ—ä¸ƒè´¤ åœ¨é‚£ä¸ªæå…¶é»‘æš—åŠ¨è¡çš„ä¹±ä¸–ä¹‹ä¸­ï¼Œæ–‡å­¦å’Œè‰ºæœ¯å´å¾—åˆ°äº†å‡ºä¹æ„æ–™çš„å¤§å‘å±•ï¼Œäººä»¬å¯¹è‡ªç”±è§£æ”¾çš„è¿½æ±‚è¾¾åˆ°äº†æè‡´ï¼Œé²è¿…å…ˆç”Ÿç§°ä¹‹ä¸ºé­æ™‹é£åº¦ã€‚å½“æ—¶ç››è¡Œæ¸…è°ˆå’Œéšé€¸ï¼Œå¤äººçš„å¿ƒçµæ›´åŠ ä¸°å¯Œå’Œç¼ ç»µï¼Œè§„åˆ™çš„çº¦æŸå‹æŠ‘äº†ä¸ªæ€§ä¸è‡ªæˆ‘ï¼Œå´åœ¨é¢‘é¢‘äº¤æµä¸­è¿æ¥äº†æ–‡åŒ–çš„ç¹è£ã€‚ä¸è¦ç”¨æˆç‹è´¥å¯‡çš„è§‚ç‚¹å»è¯„ä»·å†å²äººç‰©ï¼Œå‚å·®ç™¾æ€ï¼Œå®ä¹ƒå¹¸ç¦æœ¬æºã€‚</p>
<p>è€Œå¯¹é­æ™‹é£åº¦å½±å“æœ€å¤§çš„è‡ªç„¶å°±æ˜¯ç«¹æ—ä¸ƒè´¤ï¼Œè™½ç„¶ç™¾å¹´ä¹‹ååäººå°†å…¶ç§°ä¹‹ä¸ºä¸ƒè´¤ï¼Œä½†è¿™ä¸ªæ–‡äººæ²™é¾™çš„è§„æ¨¡å…¶å®å¤§äº7äººï¼Œä¹‹æ‰€ä»¥å®šä¸ºä¸ƒè´¤ï¼Œæ®åˆ˜å¼ºè€å¸ˆçš„è¯´æ³•æ˜¯ä¸ºäº†æ”€é™„ã€Šè®ºè¯­ã€‹ï¼š</p>
<blockquote>
<p>è´¤è€…è¾Ÿä¸–ï¼Œå…¶æ¬¡è¾Ÿåœ°ï¼Œå…¶æ¬¡è¾Ÿè‰²ï¼Œå…¶æ¬¡è¾Ÿè¨€ã€‚ä½œè€…ä¸ƒäººçŸ£ã€‚</p>
</blockquote>
<p>å¦å¤–ï¼Œå…³äºç«¹æ—ä¸ƒè´¤æ˜¯å¦å› ä¸ºç»å¸¸åœ¨ç«¹æ—æ´»åŠ¨è€Œå¾—åä¹Ÿå­˜ç–‘ã€‚é™ˆå¯…æªå…ˆç”Ÿè®¤ä¸ºæœ‰å¯èƒ½æ˜¯å€Ÿä½›ç»ä¹‹ä¸­çš„â€œç«¹æ—ç²¾èˆâ€çš„æ•…äº‹æ¥è¡¨è¾¾å‡ºä¸–çš„ç†æƒ³ã€‚æ®è€ƒè¯ï¼Œä»–ä»¬çš„æ´»åŠ¨åœ°ç‚¹åœ¨éƒ½åŸæ´›é˜³ä»¥åŠå±±é˜³ï¼ˆä»Šäº‘å°å±±ï¼‰é™„è¿‘ï¼Œåæ¥å½“åœ°å¯èƒ½ä¸ºäº†å€Ÿç«¹æ—ä¸ƒè´¤çš„åå£°ä¿ƒè¿›æ—…æ¸¸ä¸šçš„å‘å±•ï¼Œæ‰€ä»¥äººå·¥æ ½ç§äº†ä¸€äº›ç«¹æ—ã€‚</p>
<p>å½“æ—¶æµè¡Œä¿®èº«é½å®¶æ²»å›½å¹³å¤©ä¸‹ï¼Œä½†æ˜¯è¿™äº›æ‰åæ¨ªæº¢çš„æ–‡äººå¼€å§‹å´ä¸æ„¿åšå®˜ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>â€œæ›¹é©¬ä¹‹äº‰â€æ„ˆæ¼”æ„ˆçƒˆï¼Œå†åŠ ä¸Šè¿™äº›åå£«çš„åæ°”å’Œå½±å“åŠ›ï¼Œä»–ä»¬è¢«é€¼ç«™é˜Ÿæ‰èƒ½å¾—ä»¥ç”Ÿå­˜ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ˜¯ç«™åœ¨å¸é©¬å®¶æ—ä¸€è¾¹ï¼Œè¿˜æ˜¯æ”¯æŒæ›¹æ°é›†å›¢å‘¢ï¼Ÿæ›¹çˆ½æ­¤æ—¶è¢«å°ä¸ºå¤§å°†å†›ï¼Œå¸é©¬æ‡¿åˆ™æ˜¯å¤ªå°‰ï¼Œé€‰æ‹©ç¨æœ‰ä¸æ…ï¼Œå¾ˆå¯èƒ½ä¼šè¢«ç§‹åç®—è´¦ã€‚</p>
<p>ä½œä¸ºè€å¤§å“¥ï¼Œå±±æ¶›æœ€å…ˆå—åˆ°â€œæ›¹é©¬ä¹‹äº‰â€çš„å†²å‡»ã€‚</p>
<p>å±±æ¶›æ—©å¹´ä¸§çˆ¶ï¼Œå‡ºèº«åº¶æ—ï¼Œéšå±…ä¸ä»•ï¼Œåˆ˜è€å¸ˆè¯´å¯èƒ½æ˜¯å› ä¸ºæ—¶æœºä¸æˆç†Ÿï¼Œ2ä¸ªæ”¿æ²»é›†å›¢çš„å½¢åŠ¿ä¸æ˜æœ—ã€‚å±±æ¶›æœ¬äººæ˜¯æœ‰æ”¿æ²»æŠ±è´Ÿçš„ï¼Œä½†ä¸ºäº†è‡ªä¿åªèƒ½æš‚æ—¶æ¨è„±å‡ºä»•é‚€è¯·ã€‚</p>
<p>å…¬å…ƒ244å¹´ï¼Œä»–è§‰å¾—å½¢åŠ¿æ˜æœ—ï¼Œè‡ªå·±çš„æœºä¼šæ¥äº†ï¼Œç»ˆäºåœ¨40å²æ—¶å¼€å§‹äº†å®˜å®¦ç”Ÿæ¶¯ï¼Œå¹¶ä¸”é€‰æ‹©ç«™åˆ°æ›¹çˆ½é˜Ÿä¼é‡Œã€‚</p>
<p>ä¸ºäº†å½»åº•å‡»è´¥æ›¹æ°é›†å›¢ï¼Œå¸é©¬æ‡¿ç§°ç—…ä¸æœï¼Œä»¥é€€ä¸ºè¿›ã€‚æå¯Œæ”¿æ²»å¤´è„‘çš„å±±æ¶›å—…å‡ºäº†ä¸åŒçš„å‘³é“ï¼Œçªç„¶é†’æ‚Ÿï¼Œå¤œåŠå¼ƒå®˜ã€‚</p>
<p>å±±æ¶›å¼ƒå®˜ä»¥åï¼Œå¸é©¬æ‡¿åœ¨ç§°ç—…è¿·æƒ‘æ›¹çˆ½çš„åŒæ—¶ï¼Œç§¯ç´¯å†›äº‹åŠ›é‡ã€è”ç»œæ›¹é­è€è‡£å–å¾—é“ä¹‰æ”¯æŒã€æ•£æ’­èˆ†è®ºè›Šæƒ‘äººå¿ƒï¼Œå®¶æ—åŠ¿åŠ›æ—¥æ¸å¼ºå¤§ã€‚è€Œå°±åœ¨æ­¤æ—¶ï¼Œå±±æ¶›ç»“äº¤äº†é˜®ç±ã€åµ‡åº·ç­‰åå£«ï¼Œæ•´æ—¥é†‰é¥®ç©ä¹ã€‚</p>
<p>å…¬å…ƒ249å¹´ï¼Œå¸é©¬æ‡¿å‘åŠ¨æ”¿å˜ï¼Œä¸€ä¸¾ç²‰ç¢äº†æ”¿æ•Œæ›¹çˆ½é›†å›¢ï¼Œå²ç§°â€œé«˜å¹³é™µä¹‹å˜â€ï¼Œä»¥è°‹åç½ªå¤„æ­»äº†æ›¹æ°æ•´ä¸ªå®¶æ—ï¼Œæ•°åƒäººæƒ¨æ­»ï¼Œç«¹æ—ä¸ƒè´¤ä¹Ÿå—åˆ°äº†æƒŠå“ã€‚æ¥ç€ä¸ºäº†ç¼“è§£ç™½è‰²ææ€–çš„æ°”æ°›ï¼Œå¸é©¬å®¶æ—å¼€å§‹æ‹›è´¤çº³å£«ã€ç¬¼ç»œäººå¿ƒï¼Œç«¹æ—ä¸ƒè´¤è‡ªç„¶ä¹Ÿåœ¨æ‹›è´¤ä¹‹åˆ—ï¼š</p>
<p>å±±æ¶›ç”±äºå’Œå¸é©¬æ°çš„å§»äº²å…³ç³»ï¼Œç¬¬äºŒæ¬¡åšå®˜ä¾¿å‡­å€Ÿäº²æˆšçš„èº«ä»½ä¸»åŠ¨æŠ•é å¸é©¬å¸ˆï¼Œä»æ­¤ä»¥åå®˜è¿äº¨é€šï¼Œæ­¥å…¥äº†ä»•é€”çš„å¿«è½¦é“ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨éŸ³ä¹ã€è¯—èµ‹æ–¹é¢æ‰åæ¨ªæº¢çš„é˜®ç±å°±æ˜¾å¾—å¼‚å¸¸å‡„æƒ¨ã€‚</p>
<p>é˜®ç±çš„èƒŒæ™¯ååˆ†å¤æ‚ï¼Œä»–çš„çˆ¶äº²é˜®ç‘€æ˜¯å»ºå®‰ä¸ƒå­ä¹‹ä¸€ï¼Œå’Œæ›¹é­å…³ç³»å¯†åˆ‡ï¼›åŒæ—¶ä»–åˆæ˜¯å¸é©¬æ°çš„äº²æˆšã€‚ è¢«æ‹›çº³æ—¶ï¼Œç”±äºå®³æ€•å¸é©¬æ‡¿çš„å± åˆ€ï¼Œäºæ˜¯é˜®ç±ç­”åº”ä¸ºå®˜ï¼Œåšäº†ä¸€ä¸ªé—²èŒã€‚ä½†ä»–å°¸ä½ç´ é¤ï¼Œæ•´æ—¥åˆ’æ°´æ‘¸é±¼ï¼Œå‡ ä¹æ²¡æœ‰ä½œä¸ºã€‚å¹¶ä¸”ä»–å’Œå¸é©¬æ°å€¡å¯¼çš„å°å»ºç¤¼æ•™æ ¼æ ¼ä¸å…¥ï¼ˆå¸é©¬æ°å½“æ—¶å·å¬â€œä»¥å­æ²»å¤©ä¸‹â€ï¼Œå…¬å…ƒ258å¹´å·¦å³ï¼Œé˜®ç±ä¸§æ¯ï¼Œä»–å…¬ç„¶è¿èƒŒç¤¼æ³•ï¼Œåœ¨è‘¬ç¤¼æœŸé—´å–é…’åƒè‚‰ï¼‰ï¼Œç”Ÿæ´»å¾—æå…¶ç—›è‹¦ä½†åˆä¸æƒ³è¿‡æ—©ç»“æŸç”Ÿå‘½ï¼Œæ‰€ä»¥åªèƒ½å¯„æ‰˜äºå¸é©¬æ‡¿çš„æ­»äº¡ã€‚</p>
<p>å¸é©¬æ‡¿æ­»åï¼Œå…¶å­å¸é©¬å¸ˆåˆæŠŠé˜®ç±å¬å»åšå®˜ã€‚å¸é©¬æ˜­ä¸Šå°åï¼Œä¸ºäº†æ‹‰æ‹¢é˜®ç±ï¼Œæƒ³è¦å°†é˜®ç±çš„å¥³å„¿å«ç»™å¸é©¬æ˜­çš„å„¿å­å¸é©¬ç‚ï¼Œé˜®ç±åªèƒ½ç”¨çƒ‚é†‰å¦‚æ³¥æ¥åº”ä»˜ã€‚å¤©å¤©è¿™æ ·ä¹Ÿä¸æ˜¯åŠæ³•ï¼Œä»–å°±ä¸»åŠ¨æ±‚å®˜ï¼Œè°ƒå¾€å¤–åœ°ï¼Œé‡‘è‰è„±å£³ä¹‹è®¡ï¼Œä½†å¾ˆä¸å¹¸ï¼Œåå¤©ååˆè¢«å¸é©¬æ˜­çœ‹ç©¿å¹¶å¬å›å¹•åºœã€‚ä»æ­¤æ…è¨€æ…è¡Œã€æ˜å“²ä¿èº«ã€éƒéƒå¯¡æ¬¢ã€‚</p>
<p>åµ‡åº·æ­»åï¼Œé˜®ç±æŠ‘éƒè€Œç»ˆï¼Œæ™šå¹´è¢«è¿«ä¸ºå¸é©¬æ˜­å†™äº†ä¸€ç¯‡æ­ŒåŠŸé¢‚å¾·çš„ã€ŠåŠè¿›æ–‡ã€‹ï¼Œæˆä¸ºäº†äººç”Ÿçš„æ±¡ç‚¹ã€‚</p>
<p>å‘ç§€è·Ÿåµ‡åº·å…³ç³»æœ€å¥½ï¼Œåµ‡åº·çš„æ­»ç»™ä»–å¸¦å»äº†å·¨å¤§çš„é˜´å½±ï¼Œåæ¥ä¸ºäº†è‡ªä¿ä¹Ÿè¸ä¸Šäº†ä»•é€”ã€‚</p>
<p>ç‹æˆåæ¥åšäº†å¤§å®˜ï¼Œå´å˜å¾—éå¸¸åå•¬ï¼Œè·Ÿå¹´è½»æ—¶å€™åˆ¤è‹¥ä¸¤äººï¼Œä½†æ˜¯ä»–ä¾ç„¶å¾ˆé‡æƒ…è°Šã€‚ é˜®å’¸åæ¥è¢«å±±æ¶›ä¸¾èï¼Œä½†æ²¡æœ‰è¢«ä»»ç”¨ã€‚</p>
<p>åˆ˜ä¼¶æ®è¯´æ˜¯7äººé‡Œæœ€ä¸‘çš„ï¼Œä½†æ˜¯ä»–çš„ç²¾ç¥è‡ªæˆ‘ååˆ†å¼ºå¤§ï¼Œæ•´æ—¥çƒ‚é†‰å¦‚æ³¥ï¼Œåœ¨é…’ä¸­æ”¾é£è‡ªæˆ‘ï¼Œæ™šæ™¯å‡„å‡‰ã€‚ä»£è¡¨ä½œã€Šé…’å¾·é¢‚ã€‹ï¼Œåˆ˜å¼ºè€å¸ˆè¯´ä»–æ˜¯çœŸæ­£çš„è¡Œä¸ºè‰ºæœ¯å®¶hhã€‚ ## åµ‡åº· åµ‡åº·å‡ºèº«æ™®é€šï¼Œè‡ªå¹¼é¢ æ²›æµç¦»ã€‚å’Œæ›¹æ“åŒä¹¡ï¼Œå…¶å¦»å­æ˜¯æ›¹æ“çš„æ›¾å­™å¥³é•¿ä¹äº­ä¸»ï¼Œåµ‡åº·æœ€åè¢«å¸é©¬æ˜­æ‰€æ€å¯èƒ½ä¸è¿™ä¸ªå› ç´ ä¹Ÿæœ‰å…³ç³»ã€‚è¯—æ­Œã€æ–‡ç« ã€ä¹¦æ³•ã€ä¹ç†é€ è¯£å¾ˆé«˜ï¼Œæ®ä¼ è¿˜æ˜¯ä¸ªå¤§å¸…å“¥ï¼Œå²ä¹¦è®°è½½ï¼š</p>
<blockquote>
<p>åµ‡åº·ä¸ºäººï¼Œè‚ƒè‚ƒå¦‚æ¾ä¸‹é£ï¼Œé…’é†‰æ—¶å€¾å€’ï¼Œè‹¥ç‰å±±ä¹‹å°†å´©ã€‚</p>
</blockquote>
<p>ä»–æå‡ºè¶Šåæ•™ä»»è‡ªç„¶ï¼Œåå¯¹ç¤¼æ•™ï¼Œè¿½æ±‚è‡ªç„¶å’Œæœ¬æˆ‘ï¼ŒåŒæ¶æ”¿æ²»æ–—äº‰ï¼Œæ®ä¼ åµ‡åº·åœ¨æ‰“é“æ—¶ï¼Œå¸é©¬æ°çš„èµ°ç‹—é’Ÿä¼šå‰æ¥æ¢è®¿ï¼Œæ‰€è°“é“ä¸åŒä¸ç›¸ä¸è°‹ï¼Œæ•…æ„æŠŠé’Ÿä¼šæ™¾åœ¨ä¸€è¾¹ä¸è¯´ï¼Œèµ°å‰è¿˜å†·å˜²çƒ­è®½äº†ä¸€é€šã€‚</p>
<p>å½“æ—¶å¸é©¬å¸ˆåºŸæ‰äº†æ›¹èŠ³ï¼Œå¼•èµ·æ·®å—å…µå˜ï¼Œåµ‡åº·ä¹Ÿæƒ³èµ·å…µå“åº”ï¼Œè¢«å±±æ¶›åŠé˜»ã€‚</p>
<p>å…¬å…ƒ255å¹´ï¼Œå¸é©¬å¸ˆåœ¨å¹³å®šå›ä¹±æ—¶ï¼Œç”±äºå¾—ç—…æ­»æ‰äº†ã€‚éšåå¸é©¬æ˜­ä¸Šå°ï¼Œå¸Œæœ›æ‹›çº³åµ‡åº·ï¼Œåµ‡åº·å€Ÿå£é¿åœ°æ²³ä¸œã€‚</p>
<p>åµ‡åº·ä»¥å®½åšå¾…äººï¼Œè™½ç„¶ä»–çš„å“¥å“¥åµ‡å–œè¿˜æœ‰å‡ ä¸ªæœ‹å‹åšäº†å¸é©¬æ°çš„å®˜ï¼Œä½†ä»ç„¶æ²¡æœ‰å½±å“ä»–ä»¬çš„å‹è°Šã€‚å¯¹å¾…æœ‹å‹å‹å¥½ï¼Œä½†æ˜¯å¯¹å¾…æ•Œäººå´åƒä¸¥å†¬ä¸€æ ·å†·å³»æ— æƒ…ï¼Œä¹Ÿå¯¼è‡´äº†åæ¥æ‚²å‰§çš„å‘ç”Ÿã€‚</p>
<p>åæ¥ä»–åˆå¤šæ¬¡æ‹’ç»å¸é©¬æ˜­çš„é‚€è¯·ï¼Œä½†å¾ˆä¸å¹¸ï¼Œåµ‡åº·æœ€ç»ˆè¿˜æ˜¯å·è¿›äº†æ”¿æ²»æ–—äº‰ï¼š çš‡å¸æ›¹é«¦ä¸€ç›´è¢«å¸é©¬æ˜­æ“æ§ï¼Œè¢«è¿«å°å…¶ä¸ºç›¸å›½ï¼Œçœ¼çœ‹åˆ†åˆ†é’Ÿå°±è¦è¢«å–ä»£çš„èŠ‚å¥ã€‚åæ¥ä¹Ÿç”±æ­¤è¯ç”Ÿä¸€ä¸ªæˆè¯­ï¼šå¸é©¬æ˜­ä¹‹å¿ƒâ€”â€”è·¯äººçš†çŸ¥ã€‚å…¬å…ƒ260å¹´ï¼Œæ›¹é«¦å¾ˆå¿«å°±è¢«å¸é©¬æ˜­å¹²æ‰äº†ï¼Œåˆæ‰¾äº†ä¸€ä¸ªå‚€å„¡ã€‚</p>
<p>å…¬å…ƒ261å¹´ï¼Œå±±æ¶›å‡è¿ï¼Œæ‰¾åˆ°åµ‡åº·å¸Œæœ›ä»–ä»£æ›¿è‡ªå·±ä¹‹å‰çš„å®˜èŒã€‚ä¸¤äººè™½ç„¶â€œå¥‘è‹¥é‡‘å…°â€ï¼Œä½†åµ‡åº·ä¾ç„¶æ„¤æ€’åœ°å†™ä¸‹ã€Šä¸å±±å·¨æºç»äº¤ä¹¦ã€‹ï¼Œæå°½è®½åˆºç¾è¾±å±±æ¶›ï¼Œä»–è§‰å¾—å±±æ¶›æ‹‰æ‹¢ä»–æ˜¯ä¸ºäº†ç¼“è§£è‡ªå·±çš„å°´å°¬ï¼Œä¸€èµ·ä¸‹æ°´å°±ä¸è§‰å¾—é‚£ä¹ˆç½ªè¿‡äº†ã€‚åµ‡åº·åœ¨ä¹¦é‡Œè‡ªæ˜å¿ƒå¿—ï¼šè‡ªå·±ç”Ÿæ€§ç–æ‡’ï¼Œé˜è¿°äº†è‡ªå·±åšå®˜çš„ä¸ƒä¸å ªã€äºŒä¸å¯ï¼š æ²¡æ³•ç¡æ‡’è§‰ï¼›å–œæ¬¢ä¼‘é—²å¼¹ç´ï¼Œå‡ºå»ç©ä¸è‡ªç”±ï¼›éœ€è¦æ­£è¥Ÿå±åï¼›ä¸å–œæ¬¢å†™å…¬åŠ¡ä¿¡ï¼›ä¸å–œæ¬¢åŠä¸§ï¼›ä¸å–œæ¬¢å’Œä¿—äººå…±äº‹ï¼›æ€§æƒ…ä¸è€çƒ¦ï¼Œä¸å–œæ¬¢åšç¹ççš„äº‹æƒ…ã€‚ è²è–„å¤ä»£çš„åœ£è´¤ï¼Œè¢«å‘ç°å°±æŒ‚äº†ï¼›æ€§æ ¼åˆšçƒˆã€å«‰æ¶å¦‚ä»‡ï¼Œæ²‰ä¸ä½æ°”ï¼Œä¸é€‚åˆåšå®˜ã€‚</p>
<p>å†å²ä¸Šå…³äºä¸¤äººæ˜¯å¦çœŸçš„ç»äº¤æœ‰äº‰è®ºï¼šå°¤å…¶æ˜¯åæ¥è¿˜å‘ç”Ÿäº†æ‰˜å­¤äº‹ä»¶ã€‚</p>
<p>å±‹æ¼åé€¢è¿å¤œé›¨ï¼Œæ¥ä¸‹æ¥åˆå‘ç”Ÿäº†å•å®‰äº‹ä»¶ï¼Œç›´æ¥å°†åµ‡åº·é€å…¥äº†ç«å‘ä¹‹ä¸­ï¼š</p>
<p>å•å·½æ˜¯å•å®‰çš„å“¥å“¥ï¼Œå¯¹å•å®‰çš„å¦»å­æœ‰éåˆ†ä¹‹æƒ³å¹¶ä¸”ç»™ä»–å¸¦äº†ç»¿å¸½å­ï¼Œå•å®‰å‘Šè¯‰äº†åµ‡åº·ï¼Œåµ‡åº·ä¸¥è¯è°´è´£äº†å•å·½ï¼Œä½†ä¸ºäº†å£°èª‰ï¼ŒåŠå•å®‰éšå¿ä¸å‘ï¼Œäº‹æƒ…å°±è¿™æ ·è¢«æ‚äº†ä¸‹æ¥ã€‚</p>
<p>å•å·½å’Œé’Ÿä¼šå…³ç³»å¾ˆå¥½ï¼Œä¸ºäº†æŠ¥å¤å•å®‰ï¼Œä»–å‘é’Ÿä¼šè¿›çŒ®è°—è¨€ï¼Œé’Ÿä¼šå¾ˆå¯èƒ½ä¸ºäº†ç‰µå‡ºåµ‡åº·ï¼Œä»¥æŠ¥ä¸€ç®­ä¹‹ä»‡ï¼Œä¸ä¹…åå°±æŠ“äº†å•å®‰ã€‚åµ‡åº·å¬åˆ°æ¶ˆæ¯åååˆ†æ„¤æ€’ï¼Œå†™äº†ä¸€å°ã€Šä¸å•é•¿æ‚Œç»äº¤ä¹¦ã€‹ï¼Œä¹‹ååªèº«å‰å¾€æ´›é˜³ï¼Œå»ä¸ºå•å®‰è¾©æŠ¤ã€‚</p>
<p>å•å®‰åœ¨æµæ”¾é€”ä¸­ï¼Œç»™åµ‡åº·å†™äº†ä¸€å°è¨€è¾æ¿€çƒˆçš„ä¿¡ã€‚å¤§æ„æ˜¯è¯´å¤©ä¸‹å¤§ä¹±ï¼Œè‡ªå·±æ‰¿å—å†¤å±ˆï¼Œä»–è¦æ”¹å¤©æ¢åœ°ã€‚è¿™å°ä¿¡å¾ˆå¿«è½åˆ°äº†é’Ÿä¼šæ‰‹ä¸Šï¼Œé’Ÿä¼šç»ˆäºç­‰åˆ°äº†æœºä¼šã€‚</p>
<p>å•å®‰äº‹ä»¶ç”±æ­¤å‡çº§ä¸ºè°‹åç½ªï¼Œåµ‡åº·è¢«å½“ä½œåŒçŠ¯æŠ“äº†ã€‚å¸é©¬æ˜­æœ¬æ¥å°±å¿Œæƒ®åµ‡åº·ï¼Œå¯¹ä»–çš„ä¸åˆä½œæ€åº¦æ€€æ¨åœ¨å¿ƒï¼Œä½†å¯¹äºæ˜¯å¦è¦æ€åµ‡åº·ä¹ŸçŠ¹è±«ä¸å†³ï¼Œæ­¤æ—¶é’Ÿä¼šåˆç«™äº†å‡ºæ¥ä¸Šçº²ä¸Šçº¿ï¼Œè¯´åµ‡åº·ä¸Šä¸è‡£å¤©å­ï¼Œä¸‹ä¸äº‹ç‹ä¾¯ï¼Œç§ä¸‹åˆç½—ç»‡äº†å‡ ä¸ªç†ç”±ï¼šä»–è¯´åµ‡åº·æ˜¯äººä¸­é¾™å‡¤ï¼Œå¹¶ä¸”å½“å¹´æœ‰èµ·å…µè°‹åä¹‹æ„ã€‚</p>
<p>æ¬²åŠ ä¹‹ç½ªï¼Œä½•æ‚£æ— è¾ï¼Ÿäºæ˜¯å•å®‰å’Œåµ‡åº·è¢«å…³å…¥æ­»å›šç‰¢æˆ¿ï¼Œç­‰å¾…ç§‹åé—®æ–©ã€‚</p>
<p>å‘½çŠ¯å°äººï¼Œåµ‡åº·å…¥ç‹±åï¼Œæœ‰å‡ åƒå¤ªå­¦ç”Ÿä¸ºä»–æŠ±æ‰“ä¸å¹³ã€‚ä»–ä¹Ÿåœ¨ç‹±ä¸­åæ€è‡ªå·±ï¼Œå†™ä¸‹äº†ã€Šå¹½æ„¤è¯—ã€‹ï¼Œè§‰å¾—è‡ªå·±è™½ç„¶å¿ƒåœ°å–„è‰¯ï¼Œä½†å´æ²¡æœ‰è¯†åˆ«åäººçš„èƒ½åŠ›ã€‚</p>
<p>ä¸´æ­»å‰å°†å…¶å„¿å­åµ‡ç»æ‰˜ä»˜ç»™å±±æ¶›ï¼Œæœ‰äººè¯´è¿™æ˜¯ä¸ºäº†ç¼“è§£å±±æ¶›çš„æ„§ç–šä¹‹æ„ï¼Œå±±æ¶›æ¥å—äº†åµ‡åº·çš„æ‰˜å­¤ï¼ŒæŠŠåµ‡ç»åŸ¹å…»çš„å¾ˆå¥½ï¼š</p>
<blockquote>
<p>å·¨æºåœ¨ï¼Œæ±ä¸å­¤çŸ£ï¼</p>
</blockquote>
<p>å°±åœ¨è¡Œåˆ‘å‰ï¼Œå¤ªå­¦ç”Ÿåˆè¯·æ„¿é‡Šæ”¾åµ‡åº·å½“å¤ªå­¦è€å¸ˆã€‚å¸é©¬æ˜­çœ‹åˆ°åµ‡åº·å¦‚æ­¤çš„å½±å“åŠ›ï¼Œæ€å¿ƒæ›´é‡ï¼š å…¬å…ƒ263å¹´ï¼Œåµ‡åº·ä¸å•å®‰ä¸€èµ·åœ¨éƒ½åŸæ´›é˜³è¢«å¤„æ­»ã€‚</p>
<p>æ®è®°è½½ï¼Œè¡Œåˆ‘é‚£å¤©äººå±±äººæµ·ï¼Œåµ‡åº·é¡¾çœ‹æ—¥å½±ã€ç¥è‰²å¦ç„¶ã€‚</p>
<p>åµ‡åº·æ‰¾å“¥å“¥åµ‡å–œè¦äº†ä¸€æŠŠç´ï¼Œåµ‡å–œæœç„¶éšèº«æºå¸¦ï¼Œè€Œä¸”åµ‡åº·çš„å¼¹å¥è¦æ±‚ç«Ÿç„¶è¢«åŒæ„ï¼š åœ¨åˆ‘åœºä¸Šï¼Œä»–å¹³é™å‘¼å¸ï¼Œè°ƒæ•´ç´å¼¦ï¼Œå¼¹å®Œäº†æœ€åçš„å“€æ­Œã€Šå¹¿é™µæ•£ã€‹åè¯´åˆ°ï¼šå½“å¹´æœ‰ä¸€ä¸ªæœ‹å‹è¢å­å°¼æ±‚å­¦æ­¤æ•£ï¼Œè‡ªå·±ç”±äºåæƒœï¼Œæ²¡æœ‰æ•™ç»™ä»–ï¼š</p>
<blockquote>
<p>å¹¿é™µæ•£äºä»Šç»çŸ£ï¼ ## Reference åŒæµå¤§å­¦çš„åˆ˜å¼ºè€å¸ˆæ˜¯é­æ™‹å²çš„ä¸“å®¶ï¼Œç™¾å®¶è®²å›å’Œä¸Šæµ·å›¾ä¹¦é¦†ç³»åˆ—è®²åº§ä¸­éƒ½æ”¶å½•äº†ä»–çš„ç²¾å½©åˆ†äº«ï¼š <a target="_blank" rel="noopener" href="http://tv.cctv.com/lm/bjjt/index.shtml#&amp;Type=0&amp;Y=2010&amp;M=10">ç™¾å®¶è®²å›ä¹‹ç«¹æ—ä¸ƒè´¤</a> <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Zt411d7Fr">ç«¹æ—ä¸ƒè´¤ä¸é­æ™‹é£åº¦</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/10/04/Bomb%20Lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/04/Bomb%20Lab/" class="post-title-link" itemprop="url">Bomb Lab</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-04 09:09:00" itemprop="dateCreated datePublished" datetime="2020-10-04T09:09:00+08:00">2020-10-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ç»™äº†<code>bomb.c</code>å’Œ<code>bomb</code>äºŒè¿›åˆ¶å¯æ‰§è¡Œç›®æ ‡ç¨‹åºï¼Œ<code>bomb.c</code>ä¸èƒ½ç›´æ¥ç¼–è¯‘å’Œè¿è¡Œï¼Œåªæ˜¯æœ‰ä¸€äº›æç¤ºï¼Œä½†æ˜¯ç¨‹åºå¤§è‡´ç»“æ„æ˜¯ï¼šæœ‰6ä¸ªå…³å¡ï¼Œæ¯ä¸ªéƒ½éœ€è¦è¾“å…¥ï¼ˆstdin/æ–‡ä»¶ï¼‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿è¡Œååˆ¤æ–­æ˜¯å¦è¾“å…¥äº†æ­£ç¡®çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬éœ€è¦åæ±‡ç¼–<code>bomb</code>ï¼Œæ‰¾åˆ°è¿™6ä¸ªæ­£ç¡®çš„å­—ç¬¦ä¸²ã€‚ æˆ‘æ˜¯åœ¨Amazonçš„äº‘æœåŠ¡å™¨ä¸Šå®Œæˆçš„ï¼Œ64ä½Red Hatã€‚</p>
<p>ç¬¬ä¸€æ­¥æŠŠæ±‡ç¼–ä»£ç æ‰”åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d bomb &gt; bomb.asm</span><br></pre></td></tr></table></figure>
<h2 id="phase-1">phase 1</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br><span class="line">  400ee9:	e8 4a 04 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">  400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2:	e8 43 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  400efb:	c3                   	retq</span><br></pre></td></tr></table></figure>
<p>å½“å‚æ•°å°‘äº7ä¸ªæ—¶ï¼Œ å‚æ•°ä»å·¦åˆ°å³æ”¾å…¥å¯„å­˜å™¨: rdi, rsi, rdx, rcx, r8, r9ã€‚ æˆ‘ä»¬çš„inputä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å­˜å…¥rdiï¼Œç¬¬äºŒä¸ªå‚æ•°0x402400å­˜å…¥rsiï¼Œä¼ å…¥å‡½æ•°å¤„ç†ï¼Œ è°ƒç”¨äº†<code>401338</code>å¤„çš„å‡½æ•°<code>strings_not_equal</code>ï¼š</p>
<p>åœ¨400ee4è®¾ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹402400é‡Œæ˜¯å•¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gdb</span><br><span class="line">file bomb</span><br><span class="line">b *0x400ee4</span><br><span class="line">run</span><br><span class="line">x/s Addr// æ˜¾ç¤ºå†…å­˜å€¼ä¸ºå­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200703101513705.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> ä¸ºäº†ç¡®è®¤è¿™å°±æ˜¯æˆ‘ä»¬è¦çš„ç­”æ¡ˆï¼Œå†å»çœ‹çœ‹è°ƒç”¨çš„å‡½æ•°ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">0000000000401338 &lt;strings_not_equal&gt;:</span><br><span class="line">  401338:	41 54                	push   %r12</span><br><span class="line">  40133a:	55                   	push   %rbp</span><br><span class="line">  40133b:	53                   	push   %rbx</span><br><span class="line">  40133c:	48 89 fb             	mov    %rdi,%rbx # ç¬¬ä¸€ä¸ªå‚æ•°(åœ°å€)å­˜å…¥rbx</span><br><span class="line">  40133f:	48 89 f5             	mov    %rsi,%rbp # ç¬¬äºŒä¸ªå‚æ•°(åœ°å€)å­˜å…¥rbp</span><br><span class="line">  401342:	e8 d4 ff ff ff       	callq  40131b &lt;string_length&gt; # ç”¨rdiçš„å€¼è°ƒç”¨string_length</span><br><span class="line">  401347:	41 89 c4             	mov    %eax,%r12d # è¿”å›å€¼å­˜å…¥r12d</span><br><span class="line">  40134a:	48 89 ef             	mov    %rbp,%rdi # ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºå…¥å‚è°ƒç”¨string_length</span><br><span class="line">  40134d:	e8 c9 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  401352:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401357:	41 39 c4             	cmp    %eax,%r12d # æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦</span><br><span class="line">  40135a:	75 3f                	jne    40139b &lt;strings_not_equal+0x63&gt; # ä¸ç›¸ç­‰è·³è½¬</span><br><span class="line">  40135c:	0f b6 03             	movzbl (%rbx),%eax # å°†rbxåœ°å€ä¸­çš„å€¼(inputçš„ç¬¬ä¸€ä¸ªå­—æ¯)å­˜å…¥eax</span><br><span class="line">  40135f:	84 c0                	test   %al,%al</span><br><span class="line">  401361:	74 25                	je     401388 &lt;strings_not_equal+0x50&gt;</span><br><span class="line">  401363:	3a 45 00             	cmp    0x0(%rbp),%al # æ¯”è¾ƒrbpåœ°å€ä¸­çš„å€¼(å¾…æ¯”è¾ƒçš„ç¬¬ä¸€ä¸ªå­—æ¯)</span><br><span class="line">  401366:	74 0a                	je     401372 &lt;strings_not_equal+0x3a&gt; # ç›¸ç­‰è·³è½¬</span><br><span class="line">  401368:	eb 25                	jmp    40138f &lt;strings_not_equal+0x57&gt; # ä¸ç›¸ç­‰è·³è½¬</span><br><span class="line">  40136a:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  40136d:	0f 1f 00             	nopl   (%rax)</span><br><span class="line">  401370:	75 24                	jne    401396 &lt;strings_not_equal+0x5e&gt;</span><br><span class="line">  401372:	48 83 c3 01          	add    $0x1,%rbx # æŒ‡é’ˆ+1</span><br><span class="line">  401376:	48 83 c5 01          	add    $0x1,%rbp # æŒ‡é’ˆ+1</span><br><span class="line">  40137a:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40137d:	84 c0                	test   %al,%al</span><br><span class="line">  40137f:	75 e9                	jne    40136a &lt;strings_not_equal+0x32&gt; # è·³å›å¾ªç¯</span><br><span class="line">  401381:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  401386:	eb 13                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401388:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  40138d:	eb 0c                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40138f:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401394:	eb 05                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401396:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  40139b:	89 d0                	mov    %edx,%eax</span><br><span class="line">  40139d:	5b                   	pop    %rbx</span><br><span class="line">  40139e:	5d                   	pop    %rbp</span><br><span class="line">  40139f:	41 5c                	pop    %r12</span><br><span class="line">  4013a1:	c3                   	retq</span><br></pre></td></tr></table></figure> æ‰€ä»¥è¿™ä¸ªå‡½æ•°å°±æ˜¯æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒï¼Œå…ˆæ¯”è¾ƒé•¿åº¦ï¼Œå†æ¯”è¾ƒæ¯ä¸ªå­—ç¬¦ã€‚æ•…æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªkeyå°±æ˜¯Border relations with Canada have never been better. ## phase 2 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">  400efc:	55                   	push   %rbp</span><br><span class="line">  400efd:	53                   	push   %rbx</span><br><span class="line">  400efe:	48 83 ec 28          	sub    $0x28,%rsp # æ ˆæŒ‡é’ˆ-40</span><br><span class="line">  400f02:	48 89 e6             	mov    %rsp,%rsi # æ ˆæŒ‡é’ˆä½œä¸ºç¬¬äºŒä¸ªå‚æ•°</span><br><span class="line">  400f05:	e8 52 05 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  400f0a:	83 3c 24 01          	cmpl   $0x1,(%rsp) # æ£€æŸ¥æ˜¯å¦ç›¸ç­‰</span><br><span class="line">  400f0e:	74 20                	je     400f30 &lt;phase_2+0x34&gt; # ç›¸ç­‰è·³è½¬</span><br><span class="line">  400f10:	e8 25 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f15:	eb 19                	jmp    400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f17:	8b 43 fc             	mov    -0x4(%rbx),%eax # (rbx-4)èµ‹ç»™eax</span><br><span class="line">  400f1a:	01 c0                	add    %eax,%eax</span><br><span class="line">  400f1c:	39 03                	cmp    %eax,(%rbx) # æ¯”è¾ƒå½“å‰æ•°ä¸ä¸‹ä¸€ä¸ªæ•°</span><br><span class="line">  400f1e:	74 05                	je     400f25 &lt;phase_2+0x29&gt; # ç›¸ç­‰è·³è½¬</span><br><span class="line">  400f20:	e8 15 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f25:	48 83 c3 04          	add    $0x4,%rbx</span><br><span class="line">  400f29:	48 39 eb             	cmp    %rbp,%rbx # æ˜¯å¦æ¯”å®Œäº†6ä¸ªæ•°</span><br><span class="line">  400f2c:	75 e9                	jne    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f2e:	eb 0c                	jmp    400f3c &lt;phase_2+0x40&gt;</span><br><span class="line">  400f30:	48 8d 5c 24 04       	lea    0x4(%rsp),%rbx # æ ˆæŒ‡é’ˆ+4èµ‹ç»™rbx</span><br><span class="line">  400f35:	48 8d 6c 24 18       	lea    0x18(%rsp),%rbp # æ ˆæŒ‡é’ˆ+24èµ‹ç»™rbp</span><br><span class="line">  400f3a:	eb db                	jmp    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f3c:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  400f40:	5b                   	pop    %rbx</span><br><span class="line">  400f41:	5d                   	pop    %rbp</span><br><span class="line">  400f42:	c3                   	retq</span><br></pre></td></tr></table></figure> ç¬¬ä¸€æ¬¡æ˜¯1ï¼Œç¬¬äºŒæ¬¡æ˜¯2ï¼Œ4ï¼Œ8ï¼Œ16ï¼Œ32 ## phase 3 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43:	48 83 ec 18          	sub    $0x18,%rsp # æ ˆæŒ‡é’ˆ-24</span><br><span class="line">  400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx # æ ˆæŒ‡é’ˆ+12èµ‹ç»™rcx</span><br><span class="line">  400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx # æ ˆæŒ‡é’ˆ+8èµ‹ç»™rdx</span><br><span class="line">  400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">  400f56:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400f5b:	e8 90 fc ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt; # è¿”å›å€¼å­˜å…¥eax</span><br><span class="line">  400f60:	83 f8 01             	cmp    $0x1,%eax</span><br><span class="line">  400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt; # å¤§äºè·³è½¬</span><br><span class="line">  400f65:	e8 d0 04 00 00       	callq  40143a &lt;explode_bomb&gt; # å¦åˆ™çˆ†ç‚¸</span><br><span class="line">  400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp) #(rsp+8)å³è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•´æ•°ä¸7æ¯”è¾ƒ</span><br><span class="line">  400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt; # å¤§äºçˆ†ç‚¸</span><br><span class="line">  400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax # è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•´æ•°èµ‹ç»™eax</span><br><span class="line">  400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8) # è·³è½¬8*rax+0x402470</span><br><span class="line">  400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax</span><br><span class="line">  400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line">  400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line">  400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line">  400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line">  400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line">  400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line">  400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fb2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fb9:	b8 37 01 00 00       	mov    $0x137,%eax</span><br><span class="line">  400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax</span><br><span class="line">  400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;</span><br><span class="line">  400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fc9:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  400fcd:	c3                   	retq</span><br></pre></td></tr></table></figure> 400f51å°†åœ°å€0x4025cfèµ‹ç»™esiï¼Œä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œçœ‹ä¸‹è¿™ä¸ªåœ°å€æœ‰å•¥ï¼šä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠå‰é¢é—®é¢˜çš„ç­”æ¡ˆä»åœ¨ä¸€ä¸ªæ–‡ä»¶ans.txtä¸­ï¼Œ <img src="https://img-blog.csdnimg.cn/20200703164446264.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¾“å…¥æ˜¯2ä¸ªæ•´æ•°ï¼Œç¬¬ä¸€ä¸ªä¸èƒ½å¤§äº7ï¼ŒåŸºäºç¬¬ä¸€ä¸ªæ•´æ•°ï¼ˆ0-7ï¼‰è·³è½¬...... </explode_bomb>&lt;/phase_3+0x86&gt;&lt;/phase_3+0x7b&gt;</explode_bomb>&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x7b&gt;&lt;/phase_3+0x6a&gt;</explode_bomb>&lt;/phase_3+0x27&gt;</phase_3>&lt;/phase_2+0x1b&gt;&lt;/phase_2+0x40&gt;&lt;/phase_2+0x1b&gt;</explode_bomb>&lt;/phase_2+0x29&gt;&lt;/phase_2+0x34&gt;</explode_bomb>&lt;/phase_2+0x34&gt;</read_six_numbers></phase_2>&lt;/strings_not_equal+0x63&gt;&lt;/strings_not_equal+0x63&gt;&lt;/strings_not_equal+0x63&gt;&lt;/strings_not_equal+0x32&gt;&lt;/strings_not_equal+0x5e&gt;&lt;/strings_not_equal+0x57&gt;&lt;/strings_not_equal+0x3a&gt;&lt;/strings_not_equal+0x50&gt;&lt;/strings_not_equal+0x63&gt;</string_length></string_length></strings_not_equal></explode_bomb>&lt;/phase_1+0x17&gt;</strings_not_equal></phase_1></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/09/26/%E8%B0%88%E8%B0%88%E6%88%91%E7%9A%84%E7%90%86%E6%83%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/26/%E8%B0%88%E8%B0%88%E6%88%91%E7%9A%84%E7%90%86%E6%83%B3/" class="post-title-link" itemprop="url">è°ˆè°ˆæˆ‘çš„ç†æƒ³</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-26 16:03:00" itemprop="dateCreated datePublished" datetime="2020-09-26T16:03:00+08:00">2020-09-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Say Goodbye~</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/09/26/%E8%B0%88%E8%B0%88%E6%88%91%E7%9A%84%E7%90%86%E6%83%B3/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/09/16/MIT%20Operating%20System%20Engineering#0%20Booting%20a%20PC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/16/MIT%20Operating%20System%20Engineering#0%20Booting%20a%20PC/" class="post-title-link" itemprop="url">MIT Operating System Engineering#0 Booting a PC</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-16 01:25:00" itemprop="dateCreated datePublished" datetime="2020-09-16T01:25:00+08:00">2020-09-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em>æœ€è¿‘åœ¨å­¦MITçš„OSè¯¾ç¨‹ï¼Œlabç»å¯¹ä¸šç•Œè‰¯å¿ƒã€‚ XJTUçš„æ“ä½œç³»ç»Ÿè¯¾å°±æ˜¯å†™ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ”¹ä¸‹è¿›ç¨‹è½¯ä¸­æ–­é€šä¿¡çš„ä»£ç ï¼Œä»£ç é‡ä¸è¶³500ã€‚ã€‚ã€‚ MITä¸Šè¯¾ç”¨xv6æ¥æ•™å­¦ï¼Œlabæ˜¯åšä¸€ä¸ªå®Œæ•´çš„å°å‹æ“ä½œç³»ç»ŸJOSã€‚</em></p>
<hr />
<h2 id="é…ç½®ç¯å¢ƒ">é…ç½®ç¯å¢ƒ</h2>
<p>è™½ç„¶æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œä½†æ˜¯è¿™çœŸçš„æ˜¯ä»¤äººå¤´ç–¼çš„äº‹ã€‚é™„ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/eye_water/article/details/80638463">å›¾æ–‡æ•™ç¨‹</a> éœ€è¦ä¸€å°x86æœºå™¨ï¼Œä¸€èˆ¬çš„Linuxå‘è¡Œç‰ˆåº”è¯¥éƒ½å¯ä»¥ï¼Œå¯ä»¥ä½¿ç”¨<code>unabenlme -a</code>æŸ¥çœ‹ï¼Œå¦‚æœæ˜¾ç¤º<code>xxx GNU/Linux</code>å°±è¡Œï¼ŒMITçš„å­¦ç”Ÿå¯ä»¥ä½¿ç”¨é…ç½®å¥½çš„è¿œç¨‹Serverã€‚ æœ¬æ¥æ‰“ç®—ç™½å«–ä¸‹Harvardçš„æœåŠ¡å™¨ï¼Œä½†æ˜¯æ²¡æœ‰<code>root</code>æƒé™ï¼Œåªèƒ½å¯æ€œå·´å·´åœ°åœ¨Winç¯å¢ƒç”¨è™šæ‹Ÿæœºã€‚ å¹³å°ï¼šVmware Player15ï¼Œ<a target="_blank" rel="noopener" href="http://old-releases.ubuntu.com/releases/14.04.5/">Ubuntu-14.04.5-desktop-i386.iso</a></p>
<ul>
<li>æ£€éªŒç¼–è¯‘é“¾ <code>objdump -i</code>ï¼šç¬¬äºŒè¡Œæ˜¾ç¤ºelf32-i386ï¼› <code>gcc -m32 -print-libgcc-file-name</code>ï¼šæ‰“å°å‡º/usr/lib/gcc/i686-linux-gnu/4.8/libgcc.a</li>
<li>å®‰è£…gitï¼š<code>sudo apt-get install git</code></li>
<li>ä¸‹è½½qemu å»ºè®®ä¸è¦ä½œæ­»ï¼Œå®‰è£…MIT Patchè¿‡çš„ç‰ˆæœ¬ï¼š<code>git clone https://github.com/mit-pdos/6.828-qemu.git qemu</code></li>
<li>å®‰è£…ä¾èµ–åº“ å®˜æ–¹è¯´è¦è£…5ä¸ªåº“ï¼Œä½†å…¶å®libtool-binå¥½åƒæ‰¾ä¸åˆ°ï¼Œä¸è¿‡ä¸å½±å“åç»­ï¼š <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt<span class="literal">-get</span> install libsdl1.<span class="number">2</span><span class="literal">-dev</span></span><br><span class="line">sudo apt<span class="literal">-get</span> install libglib2.<span class="number">0</span><span class="literal">-dev</span></span><br><span class="line">sudo apt<span class="literal">-get</span> install libz<span class="literal">-dev</span></span><br><span class="line">sudo apt<span class="literal">-get</span> install libpixman<span class="literal">-1</span><span class="literal">-dev</span></span><br></pre></td></tr></table></figure></li>
<li>é…ç½®qemu åˆ‡åˆ°qemuç›®å½•ï¼Œ<code>./configure --disable-kvm --disable-werror --target-list="i386-softmmu x86_64-softmmu"</code> <code>[--prefix=PFX]</code>å¯é€‰å‚æ•°æ˜¯é€‰æ‹©å®‰è£…è·¯å¾„ï¼Œè¿™é‡Œå°±é»˜è®¤åœ¨<code>/usr/local</code></li>
<li>å®‰è£…qemuï¼š<code>sudo make &amp;&amp; sudo make install</code></li>
<li>ä¸‹è½½å®éªŒä»£ç  æ ¹ç›®å½•ä¸‹æ–°å»º6.828ç›®å½•ï¼Œåˆ‡åˆ°è¯¥ç›®å½•ï¼Œ<code>git clone https://pdos.csail.mit.edu/6.828/2018/jos.git lab</code>ï¼Œåˆ‡åˆ°<code>lab</code>ç›®å½•ï¼Œ<code>make</code>å°±å¯ä»¥äº†ã€‚ ## PC Bootstrap ç‰©ç†åœ°å€ç©ºé—´ï¼š <img src="https://img-blog.csdnimg.cn/20200523082913317.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> ä»¥å‰çš„PCå†…å­˜åªæœ‰1MBï¼ŒLow Memoryæ˜¯PCå”¯ä¸€èƒ½ç”¨çš„RAMã€‚VGA Displayæ˜¯VGAç¼“å†²åŒºå’Œå›ºä»¶ï¼ŒBIOSä»¥å‰éƒ½åœ¨ROMä¸­ï¼Œä¸è¿‡ç°ä»Šéƒ½åœ¨é—ªå­˜ä¸­ï¼Œåšå®Œç³»ç»Ÿåˆå§‹åŒ–ï¼ˆPCIæ€»çº¿ç­‰é‡è¦è®¾å¤‡ï¼‰ï¼Œå¯»æ‰¾bootableè®¾å¤‡(ç¡¬ç›˜)ï¼Œè¯»å–boot loaderåŠ è½½OSï¼Œå°†æ§åˆ¶æƒè½¬OSã€‚åæ¥å†…å­˜è¿œè¿œè¶…è¿‡1MBï¼Œå¯ç”¨çš„ä¹Ÿå°±æœ‰Extended Memoryï¼Œä¸è¿‡ä¸ºäº†åå‘å…¼å®¹ï¼Œè¿˜æ˜¯ä¿ç•™äº†Low Memoryï¼Œè¿™æ ·å¯ç”¨çš„RAMå°±è¢«åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ã€‚å¦‚æœ64ä½ç³»ç»Ÿï¼Œé‚£ä¹ˆå†…å­˜æ›´å¤§ï¼Œè¿™æ ·ä¸ºäº†å…¼å®¹ï¼Œ32-bit memory mapped devicesè¿˜æ˜¯è¦ä¿ç•™ï¼Œå°±åˆè¢«å‰²è£‚äº†ã€‚ ## The Boot Loader ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºå­˜æ”¾å¯åŠ¨ç¨‹åºï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ±‡ç¼–æ–‡ä»¶<code>boot/boot.S</code>å’Œä¸€ä¸ªCæ–‡ä»¶<code>boot/main.c</code>ï¼Œå¯åŠ¨ç¨‹åºå°†CPUä»å®æ¨¡å¼è½¬ä¸º32ä½ä¿æŠ¤æ¨¡å¼ï¼Œé€šè¿‡ç‰¹æ®Šçš„I/OæŒ‡ä»¤è¯»å–å†…æ ¸ã€‚ ## The Kernel</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://eimadrigal.github.io/2020/09/04/Web%20Proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="EIMadrigal">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EI Madrigal's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/04/Web%20Proxy/" class="post-title-link" itemprop="url">Web Proxy</a>
        </h2>

        <div class="post-meta">

		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-04 14:26:00" itemprop="dateCreated datePublished" datetime="2020-09-04T14:26:00+08:00">2020-09-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="intro">Intro</h2>
<p>Web Proxyæ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„ä¸­é—´äººï¼šæµè§ˆå™¨è®¿é—®ç½‘é¡µæ—¶ï¼Œå°†è¯·æ±‚å‘ç»™ä»£ç†ï¼Œç”±ä»£ç†å°†è¯¥è¯·æ±‚å‘ç»™æœåŠ¡å™¨ï¼›æœåŠ¡å™¨è¿”å›ç»“æœæ—¶ï¼Œå…ˆå‘é€ç»™ä»£ç†ï¼Œç”±ä»£ç†å‘ç»™æµè§ˆå™¨ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆåšï¼Œæ˜¯å› ä¸ºå¯ä»¥åœ¨Proxyè¿™åšä¸€äº›äº‹æƒ…ï¼š - é˜²ç«å¢™ï¼š<del>æœ‰äº›ä¸èƒ½ç›´æ¥è®¿é—®çš„ç½‘ç«™å¯ä»¥é€šè¿‡ä»£ç†å»è®¿é—®</del> ï¼› - åŒ¿åå™¨ï¼šä»£ç†å¯ä»¥éšè—æµè§ˆå™¨çš„ä¿¡æ¯ï¼Œä½¿å…¶å¯¹æœåŠ¡å™¨åŒ¿åï¼› - ç¼“å­˜ï¼šæš‚å­˜æœåŠ¡å™¨è¿”å›ç»“æœï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚</p>
<p>æœ¬é¡¹ç›®è¦å®ç°ä¸€ä¸ªç®€å•çš„Web Proxyï¼Œæ”¯æŒä»¥ä¸‹Featuresï¼š - ä¸­é—´äººåŠŸèƒ½ - å¹¶å‘ - ç¼“å­˜ ## Background Knowledge - HTTP/1.0 GET å½“ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥URL<code>http://www.cnblogs.com/EIMadrigal</code>å¹¶æŒ‰ä¸‹å›è½¦åï¼Œæµè§ˆå™¨ä¼šå‘ä»£ç†å‘é€HTTPè¯·æ±‚ï¼Œè¯·æ±‚è¡Œå¯èƒ½å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://www.cnblogs.com:8080/EIMadrigal HTTP/1.1</span><br></pre></td></tr></table></figure> ä»£ç†è¦å°†è¿™ä¸ªè¯·æ±‚è§£æä¸ºä¸»æœºå<code>www.cnblogs.com</code>ã€ç«¯å£<code>8080</code>å’Œè·¯å¾„<code>/EIMadrigal</code>ï¼Œä¹‹åä»£ç†å¯ä»¥å°è¯•è¿æ¥<code>www.cnblogs.com</code>å¹¶ä¸”å‘æœåŠ¡å™¨å‘é€æ–°çš„HTTPè¯·æ±‚ï¼Œè¯·æ±‚è¡Œå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /EIMadrigal HTTP/1.0</span><br></pre></td></tr></table></figure> - Request Header <img src="https://img-blog.csdnimg.cn/20200726153711559.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¯·æ±‚å¤´å¯èƒ½æœ‰å¤šè¡Œï¼Œæ¯è¡Œçš„åŸºæœ¬ç»„æˆå°±æ˜¯å¤´éƒ¨å­—æ®µåå’Œå€¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šHTTPè¯·æ±‚çš„æ¯ä¸€è¡Œéƒ½ä»¥<code>\r\n</code>ç»“æŸï¼Œå¹¶ä¸”æ•´ä¸ªè¯·æ±‚æ˜¯ä»¥ç©ºè¡Œ<code>\r\n</code>ç»“æŸã€‚ é¡¹ç›®è¦æ±‚ï¼š<strong>å¯¹äºæµè§ˆå™¨è‡ªå¸¦çš„request headerï¼Œä»£ç†åº”è¯¥åŸå°ä¸åŠ¨åœ°è½¬å‘</strong>ã€‚ä½†å¿…é¡»å°†ä»¥ä¸‹4é¡¹è¡¥é½ï¼Œå³å¦‚æœè‡ªå¸¦çš„è¯·æ±‚å¤´åŒ…å«ä»¥ä¸‹4é¡¹ä¹‹ä¸€ï¼Œå°±æŒ‰ç…§è‡ªå¸¦è¯·æ±‚å¤´è½¬å‘ï¼›å¦åˆ™æŒ‰ç…§ä¸‹é¢çš„é»˜è®¤å€¼è½¬å‘ã€‚å¯¹äºè‡ªå¸¦çš„å…¶å®ƒè¯·æ±‚å¤´ï¼Œç›´æ¥è½¬å‘å³å¯ï¼š</p>
<p>Hostï¼šæœåŠ¡å™¨ä¸»æœºåï¼Œå¦‚æœæµè§ˆå™¨è‡ªå¸¦ï¼Œç›´æ¥è½¬å‘ï¼›å¦åˆ™ä½¿ç”¨è¯·æ±‚è¡Œé‡Œè§£æå‡ºçš„hostnameã€‚ User-Agentï¼šç”¨æˆ·çš„æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨ç­‰ä¿¡æ¯ã€‚ Connectionï¼šç¬¬ä¸€æ¬¡è¯·æ±‚/å“åº”å®Œæˆåï¼Œå½“å‰è¿æ¥æ˜¯å¦keep aliveã€‚ Proxy-Connectionï¼šåŒä¸Šã€‚ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host: www.cnblogs.com</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (X11; Linux x86_64; rv:<span class="number">10.0</span><span class="number">.3</span>) Gecko/<span class="number">20120305</span> Firefox/<span class="number">10.0</span><span class="number">.3</span></span><br><span class="line">Connection: close</span><br><span class="line">Proxy-Connection: close</span><br></pre></td></tr></table></figure> - ç«¯å£ è¯·æ±‚ç«¯å£ï¼šURLä¸­çš„å¯é€‰å­—æ®µï¼Œå¦‚æœç”¨æˆ·è¾“å…¥æ—¶æŒ‡å®šï¼Œä»£ç†åº”è¯¥è¿æ¥æŒ‡å®šç«¯å£ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤ç«¯å£80ã€‚ ç›‘å¬ç«¯å£ï¼šä»£ç†åº”è¯¥åœ¨è¯¥ç«¯å£ç›‘å¬ç”¨æˆ·çš„è¿æ¥è¯·æ±‚ï¼Œç”±å‘½ä»¤è¡Œå‚æ•°ç»™å‡ºã€‚å¯ä»¥æ˜¯1024~65536ä¹‹é—´çš„æœªè¢«å…¶ä»–è¿›ç¨‹å ç”¨çš„ä»»æ„å€¼ã€‚ ## Implementation - Sequential Web Proxy ä»£ç†é¦–å…ˆè¦æ¥æ”¶æµè§ˆå™¨HTTPè¯·æ±‚ï¼Œå°†æµè§ˆå™¨çš„æ ‡å‡†è¯·æ±‚è§£æï¼Œè½¬æ¢ä¸ºè‡ªå·±çš„è¯·æ±‚å‘é€ã€‚ è¿™é‡Œçš„å®ç°ä¸éš¾ï¼Œåªè¦æ¨¡ä»¿Tiny Serveråœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­ç›‘å¬æ¥è‡ªæµè§ˆå™¨çš„è¯·æ±‚ï¼Œæ¥æ”¶ä¹‹ååœ¨<code>void doit(int fd)</code>é‡Œå®Œæˆè§£æè¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€å°†å¤„ç†åçš„è¯·æ±‚å‘é€ç»™serverã€æ¥æ”¶serverçš„å“åº”å¹¶å†™å›æµè§ˆå™¨ã€‚ ä¸€äº›æ¯”è¾ƒæ–¹ä¾¿çš„å‡½æ•°ï¼š <code>int accept(int listenfd, struct sockaddr *addr, int *addrlen)</code>ï¼šåœ¨<code>listenfd</code>ç­‰å¾…è¿æ¥è¯·æ±‚ï¼Œå°†clientçš„socketä¿¡æ¯å’Œé•¿åº¦å­˜å…¥<code>addr</code>å’Œ<code>addrlen</code>ï¼› <code>int Open_clientfd(char *hostname, char *port)</code>ï¼šOpen connection to server at &lt;hostname, port&gt;, return a socket descriptor ready for reading and writing. è¯»å†™æ—¶å¯ä»¥ä½¿ç”¨æä¾›çš„RIOåŒ…ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¯·æ±‚çš„è§£æï¼šæ€è·¯æ˜¯åœ¨proxyè¿™é‡Œæ•´åˆæ‰€æœ‰çš„è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ä¿¡æ¯ï¼Œå¯¹äºæ‰€æœ‰æµè§ˆå™¨å‘æ¥çš„è¯·æ±‚å¤´çš„å†…å®¹ï¼ŒåŸå°ä¸åŠ¨ä¿å­˜åˆ°<code>reqHeader</code>é‡Œï¼›å¯¹äºé»˜è®¤çš„4ä¸ªè¯·æ±‚å¤´ï¼Œç¼ºå°‘å‡ ä¸ªï¼Œå°±æŒ‰ç…§è§„å®šå†…å®¹å¢åŠ è¿›å»ã€‚ è¿˜è¦æ³¨æ„ï¼šå› ä¸ºè§„å®š<code>Connection</code>å’Œ<code>Proxy-Connection</code>éƒ½æœ‰Connectionè¿™ä¸ªå•è¯ï¼Œæ‰€ä»¥ç”¨<code>strstr</code>æŸ¥æ‰¾çš„æ—¶å€™ï¼šå¦‚æœæµè§ˆå™¨è‡ªå¸¦çš„è¯·æ±‚å¤´æ²¡æœ‰<code>Connection</code>ä½†æ˜¯æœ‰<code>Proxy-Connection</code>ï¼Œè¿™æ—¶ç¨‹åºå°±å¯èƒ½è¯¯åˆ¤ä¸ºæœ‰<code>Connection</code>ï¼Œæ‰€ä»¥æœ€å¥½ç”¨å‡½æ•°<code>strncmp</code>æˆ–è€…<code>memcmp</code>ã€‚</p>
<p>è¦å†™ä¸€ä¸ªéå¸¸robustçš„URIè§£æå™¨è¿˜æ˜¯æŒºç¹ççš„ï¼Œç”±äºCæ²¡æœ‰æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä¹Ÿè®¸å¯ä»¥ç”¨å…¶ä»–è¯­è¨€å†™å¥½ç¼–è¯‘æˆåº“ï¼Œç„¶åCç¨‹åºè°ƒç”¨ï¼Ÿï¼‰ï¼Œéœ€è¦è€ƒè™‘çš„æƒ…å†µå¾ˆå¤šã€‚ é¦–å…ˆæ˜ç¡®URIçš„æ ¼å¼ï¼šä¸€èˆ¬ç”±4éƒ¨åˆ†ç»„æˆï¼šprotocol://hostname:[port]/path/[parameters][?query][#fragment] åè®®ç›®å‰åªæ”¯æŒHTTPå’ŒHTTPSï¼Œå…¶å®ƒä¸€å¾‹ä¸åˆæ³•ã€‚ å› ä¸ºä¸€æ—¦å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œprotocolå’Œhostnameå°±æ²¡ç”¨äº†ï¼Œåªéœ€è¦pathä»¥åŠåé¢çš„queryå’Œfragmentï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå°†/ä¹Ÿæ”¾å…¥pathå­—æ®µï¼Œå› ä¸ºå…¶è¡¨ç¤ºæ ¹ç›®å½•ï¼Œä½†æ˜¯å¯¹äºqueryå’Œfragmentï¼Œæ²¡æœ‰æ”¾?å’Œ#ï¼Œå› ä¸ºæ‰¾åˆ°è¯·æ±‚å†…å®¹çš„ä½ç½®åï¼Œä¸€äº›å…·ä½“çš„æœç´¢/ç‰‡æ®µç›´æ¥ç”¨å…³é”®å­—å³å¯ï¼Œä¸?å’Œ#æ²¡å…³ç³»ï¼Œåªæœ‰/ç‰¹æ®Šä¸€äº›ã€‚ - Multiple Concurrent Requests å¯¹äºIterative Serverï¼ŒåŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼š<img src="https://img-blog.csdnimg.cn/20200821122702755.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> å½“ç¬¬äºŒä¸ªå®¢æˆ·è¯•å›¾å»è¿æ¥ï¼šè°ƒç”¨<code>connect</code>ä¼šæ­£å¸¸è¿”å›ï¼Œä½†Serverä¸ä¼š<code>Accept</code>è¯¥è¯·æ±‚ï¼Œä¼šç”¨TCP Listen BacklogæŠ€æœ¯å°†è¯¥è¯·æ±‚å…¥é˜Ÿï¼›è°ƒç”¨<code>rio_writen</code>ä¹Ÿä¼šæ­£å¸¸è¿”å›ï¼ŒServerä¼šæŠŠå†™å…¥çš„æ•°æ®å­˜å…¥ç¼“å­˜ï¼›è°ƒç”¨<code>rio_readlineb</code>ä¼šé˜»å¡ï¼Œå› ä¸ºServeræ²¡æœ‰å‘é€ä»»ä½•çš„responseã€‚</p>
<p>è§£å†³æ–¹æ³•å°±æ˜¯å¹¶å‘å¤„ç†ï¼Œæˆ‘ä»¬çš„ä»£ç†è¦èƒ½åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå…·ä½“çš„æ–¹æ³•å¾ˆå¤šï¼šå¤šè¿›ç¨‹ã€I/Oå¤šè·¯å¤ç”¨ã€é¢„çº¿ç¨‹åŒ–ï¼ˆç±»ä¼¼ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ï¼Œå…ˆåˆ›å»ºnä¸ªçº¿ç¨‹ï¼Œç›¸å½“äºnä¸ªç¼“å†²åŒºï¼‰ï¼Œæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯ä¸“é—¨æœ‰ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ç›‘å¬ï¼Œæ¯æ”¶åˆ°ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå°±å¼€ä¸€ä¸ªæ–°çº¿ç¨‹å»è¿›è¡Œè¯»å†™ã€‚è¿™é‡Œè¦é‡‡ç”¨<strong>å¯åˆ†ç¦»</strong>çš„çº¿ç¨‹æ¨¡å‹ï¼šå½“å…¶ç»ˆæ­¢æ—¶ï¼Œå†…å­˜èµ„æºä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å›æ”¶ã€‚</p>
<p>è¿™éƒ¨åˆ†æœ¬æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯å†™å®Œåæµ‹è¯•å‘ç°æŒ‚äº†ï¼š <img src="https://img-blog.csdnimg.cn/20200811181713826.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™å¾ˆå¯èƒ½æ˜¯NOP Serverå‡ºäº†é—®é¢˜ï¼Œè¿™ä¸ªServeræ˜¯ç”¨Pythonå†™çš„ï¼Œæˆ‘å»å¯åŠ¨äº†ä¸€ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nop-server.py <span class="number">15000</span></span><br></pre></td></tr></table></figure> å‘ç°ï¼š <img src="https://img-blog.csdnimg.cn/20200811182155577.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™ä¸ªé—®é¢˜æ˜¯Pythonçš„ç‰ˆæœ¬ä¸åŒ¹é…ï¼ŒæŠŠ<code>nop-server.py</code>ç¬¬ä¸€è¡Œçš„<code>#!/usr/bin/python</code>æ”¹ä¸º<code>#!/usr/bin/python3</code>å³å¯ï¼ŒæŒ‡å®šç”¨python3çš„è§£é‡Šå™¨æ‰§è¡Œè„šæœ¬ã€‚</p>
<p>å¹¶å‘è¿™å—ä¹Ÿå¦¥äº†ï¼š <img src="https://img-blog.csdnimg.cn/20200811182851976.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿™é‡Œçš„æµ‹è¯•é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šClient1é€šè¿‡proxyè¿æ¥åˆ°nop-serverï¼Œè¿™ä¸ªæœåŠ¡å™¨æ°¸è¿œä¸ä¼šå‘é€responseï¼Œä¹Ÿå°±æ˜¯è¿™æ¡è¿æ¥ä¸€ç›´ä¿æŒï¼›Client2é€šè¿‡proxyè¿æ¥åˆ°Tinyï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä»Tinyå–ä¸ªæ–‡ä»¶å›æ¥ï¼Œå¦‚æœèƒ½ï¼Œè¯´æ˜å¹¶å‘æ˜¯okçš„ï¼Œå¦‚æœä¸èƒ½ï¼Œè¯´æ˜ä¸æ”¯æŒå¹¶å‘ã€‚ä¹‹æ‰€ä»¥è¦ç”¨nop-serverï¼Œæ˜¯å› ä¸ºè¿™ä¸œè¥¿å¯ä»¥ä¸€ç›´è¿æ¥ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚å¦‚æœClient1ä¹Ÿæ˜¯é€šè¿‡proxyè¿Tinyï¼Œé‚£ä¹ˆå¯èƒ½å¾ˆå¿«å°±æ‰§è¡Œå®Œäº†ï¼Œè¿™æ—¶Client2å†å»è¿æ¥ï¼Œå¾ˆå¯èƒ½å°±ä¸æ˜¯å¹¶å‘çš„è®¿é—®äº†ï¼Œå¤±å»äº†æµ‹è¯•çš„æ„ä¹‰ã€‚</p>
<p>åšç¬¬ä¸‰éƒ¨åˆ†ä¹‹å‰ï¼Œå…ˆå®é™…æµ‹è¯•ä¸‹proxyçš„å¥å£®æ€§ã€‚ç”¨FireFoxæµè§ˆå™¨è¯•è¯•ï¼Œå…ˆå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åè®¾ç½®æµè§ˆå™¨çš„ä»£ç†æ–¹å¼ï¼š <img src="https://img-blog.csdnimg.cn/20200811194820393.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> åœ¨8080ç«¯å£è¿è¡Œproxyï¼Œç„¶åæ‰¾ä¸ªHTTPç½‘ç«™<code>http://csrankings.org/</code>è¯•ä¸€ä¸‹ï¼Œç°åœ¨ç½‘ç«™åŸºæœ¬éƒ½æ˜¯HTTPSï¼Œçœ‹æ¥åç»­çš„Featuresè¦æ”¯æŒHTTPSäº†ï¼ˆå…ˆæŒ–ä¸ªå‘ï¼‰ã€‚</p>
<p>è¿è¡Œproxyä¹‹å‰ï¼Œç”»é£æ˜¯è¿™æ ·çš„ï¼š <img src="https://img-blog.csdnimg.cn/20200811200533477.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¿è¡Œproxyä¹‹åï¼š <img src="https://img-blog.csdnimg.cn/20200821133459152.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> é€šè¿‡ä»£ç†è®¿é—®è¯¥ç½‘é¡µæ—¶ï¼Œé¡µé¢åªèƒ½åŠ è½½ä¸€éƒ¨åˆ†ï¼Œæ”¶åˆ°59420Bæ•°æ®åï¼Œä¼š<code>segmentation fault</code> ï¼Œæœ€åå‘ç° ä¸»è¦åŸå› æ˜¯<code>init_cache()</code>æ—¶ç©ºé—´åˆ†é…å†™é”™äº†ï¼Œä½†æ˜¯ä¿®æ”¹ååˆå‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼š <img src="https://img-blog.csdnimg.cn/20200824160910224.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> æ˜¯<code>memcpy</code>æ—¶å€™æ•°ç»„è¶Šç•Œï¼Œå¤„ç†bufferæ—¶å€™è¦åƒä¸‡å°å¿ƒã€‚</p>
<p>è¿™é‡Œè¦æ”¹ä¸‹<code>csapp.c</code>ä¸­çš„é”™è¯¯å¤„ç†ï¼Œé‡Œé¢éƒ½æ˜¯ç›´æ¥<code>exit(0)</code>ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸èƒ½éšä¾¿ç»ˆæ­¢ï¼Œæ‰€ä»¥æˆ‘ä»¬æ³¨é‡Šæ‰æ‰€æœ‰Error-handling functionsé‡Œçš„<code>exit()</code>ï¼Œå¦‚æœåœ¨è¯»æ•°æ®æˆ–è€…ä»€ä¹ˆæ—¶å€™é‡åˆ°é”™è¯¯ï¼Œ<code>return</code>å³å¯ï¼š<code>exit()</code>æ˜¯ç³»ç»Ÿè°ƒç”¨çº§åˆ«çš„ï¼Œç»“æŸæ•´ä¸ªè¿›ç¨‹ï¼›<code>return</code>æ˜¯å‡½æ•°çº§åˆ«çš„ï¼Œè¿”å›ç»™è°ƒç”¨è€…ï¼Œå½“ç„¶åœ¨<code>main()</code>é‡Œ<code>return</code>ä¹Ÿå°±æ˜¯<code>exit(0)</code>ã€‚ - Caching Web Objects ç¼“å­˜å¯ä»¥è¯´æ˜¯æ•´ä¸ªé¡¹ç›®çš„éš¾ç‚¹ï¼Œéœ€è¦è€ƒè™‘çš„é—®é¢˜æ¯”è¾ƒå¤šã€‚ä¸ºäº†æ¨¡å—åŒ–ï¼Œå°†è¿™ä¸€éƒ¨åˆ†å•ç‹¬å†™ä½œ<code>cache.c/cache.h</code>ï¼Œå¹¶ä¿®æ”¹<code>Makefile</code>ã€‚ ä¸»è¦é—®é¢˜æœ‰2ä¸ªï¼š 1ã€å¤šçº¿ç¨‹åŒæ­¥ï¼šå¯¹äºcacheçš„è®¿é—®åº”å½“æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å†™ï¼Œè¿™å°±æ˜¯å…¸å‹çš„è¯»è€…-å†™è€…é—®é¢˜ï¼ˆåˆç”¨åˆ°æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†äº†ï¼‰ï¼› 2ã€æ›¿æ¢ç­–ç•¥ï¼šcacheå—çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæ²¡æœ‰ç©ºé—´æ—¶å°±éœ€è¦æ¢å‡ºæ¢å…¥ã€‚ä¸€èˆ¬æ¥è®²éƒ½æ˜¯é‡‡ç”¨LRUæ–¹å¼ï¼Œä¸€ä¸ªå•çº¿ç¨‹çš„ä¸¥æ ¼çš„LRU Cacheå¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://leetcode.com/problems/lru-cache/">leetcode146é¢˜</a>ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆæ¥è§£å†³é—®é¢˜ä¸€ï¼š è¯»è€…å†™è€…é—®é¢˜å¯ä»¥åˆ†ä¸ºè¯»ä¼˜å…ˆã€å†™ä¼˜å…ˆ2ç§ï¼š è¯»ä¼˜å…ˆï¼šæ¥äº†ä¸€ä¸ªè¯»è¿›ç¨‹ï¼Œé™¤éæœ‰ä¸€ä¸ªå†™è¿›ç¨‹æ­£åœ¨è®¿é—®ï¼Œå¦åˆ™è¯»è€…ç›´æ¥å»è¯»ï¼Œå¯èƒ½å¯¼è‡´å†™è¿›ç¨‹é¥¥é¥¿ï¼› å†™ä¼˜å…ˆï¼šæœ‰è¿›ç¨‹è¯»æ—¶ï¼Œå¦‚æœæ¥äº†å†™è¿›ç¨‹ï¼Œé‚£ä¹ˆç¦æ­¢åç»­è¯»è¿›ç¨‹è¯·æ±‚ï¼Œç°æœ‰è¿›ç¨‹è¯»å®Œåï¼Œå†™è¿›ç¨‹ç«‹å³å»å†™ï¼Œå¯èƒ½å¯¼è‡´è¯»è¿›ç¨‹é¥¥é¥¿ã€‚ å†™ä¼˜å…ˆå®ç°èµ·æ¥ç¨å¾®éº»çƒ¦ä¸€äº›ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨è¯»ä¼˜å…ˆã€‚è¿™é‡Œå°±ä¸è‡ªå·±å®ç°è¯»è€…å†™è€…äº†ï¼Œä½¿ç”¨è¯»å†™é”<code>pthread_rwlock_t</code>ï¼Œç¡®ä¿ä¸ä¼šæ­»é”ã€‚</p>
<p>æ¥ç€æ¥è§£å†³é—®é¢˜äºŒï¼š è¦å®ç°å¤šçº¿ç¨‹å¹¶å‘LRU Cacheï¼Œç”±äºCå®ç°åŒå‘é“¾è¡¨å’ŒHashtableæœ‰ç‚¹ç¹çï¼Œæ‰€ä»¥é¡¹ç›®è¦æ±‚<strong>è¿‘ä¼¼LRU</strong>å³å¯ï¼šæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€ä¸ªcacheå—é™„åŠ ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œæ¯å½“è¯¥å—è¢«è®¿é—®æ—¶ï¼Œå°±æ›´æ–°æ—¶é—´æˆ³ã€‚éœ€è¦æ›¿æ¢æ—¶ï¼Œæ¢å‡ºæ—¶é—´æˆ³æœ€å°çš„å—å³å¯ã€‚è¿™æ ·å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼šè¯»çš„æ—¶å€™ä¹Ÿéœ€è¦æ›´æ–°æ—¶é—´æˆ³ï¼Œä½†æ›´æ–°æ—¶é—´éœ€è¦åŠ å†™é”ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å ç”¨å†™é”ï¼Œé‚£ä¹ˆè¯»è¿›ç¨‹å°±æ— æ³•æ›´æ–°æ—¶é—´æˆ³ï¼Œä¹Ÿå°±ä¸æ˜¯ä¸¥æ ¼çš„LRUäº†ã€‚</p>
<p>Cacheçš„å®ç°æ—¢å¯ä»¥åƒmalloc labä¸€æ ·é‡‡ç”¨åˆ†çº§çš„æ€æƒ³ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å‡åˆ†æ‰€æœ‰ç©ºé—´ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š - åˆå§‹åŒ– - æŸ¥Cache - å¦‚æœmissï¼Œå¯»æ‰¾å¯ç”¨ä½ç½® - æ‰¾åˆ°å¯ç”¨å—ï¼Œç¼“å­˜æ»¡è¶³å¤§å°æ¡ä»¶çš„Object - æ›´æ–°æ—¶é—´æˆ³</p>
<p>æœ€å¤§çš„ç¼“å­˜å¯¹è±¡æ˜¯100KBï¼Œä¸€å…±çš„ç©ºé—´1MBï¼Œå¹³å‡å¯ä»¥ç¼“å­˜10ä¸ªObjectï¼Œè¿™æ ·ä¼šæµªè´¹24KBç©ºé—´ã€‚æ‰€ä»¥é‡‡ç”¨åˆ†çº§çš„æ–¹æ³•ï¼š 100KB * 5å— = 500KB 50KB * 6å— = 300KB 20KB * 5å— = 100KB 10KB * 10å— = 100KB 1KB * 24å— = 24KB æ¥ç€æ¥æ„æ€ä¸‹å­˜å‚¨ç»“æ„ï¼Œ<strong>è®¾è®¡æ•°æ®ç»“æ„</strong>å’Œ<strong>ç±»ï¼ˆå‡½æ•°ï¼‰æ¥å£</strong>æ˜¯æˆ‘è®¤ä¸ºåšä¸€ä¸ªå·¥ç¨‹æœ€éš¾çš„éƒ¨åˆ†ï¼Œå½“ç„¶è¿˜æœ‰æœ€åçš„æ•ˆç‡ä¼˜åŒ–é—®é¢˜ï¼š ä¸€ä¸ªcache lineæœ€åŸºæœ¬çš„æ„æˆéœ€è¦å­˜å‚¨URIå’ŒOBJï¼Œå› ä¸ºä¸‹æ¬¡ç”¨æˆ·è¯·æ±‚æ—¶ä»£ç†éœ€è¦çŸ¥é“è¯·æ±‚çš„æ˜¯å“ªä¸ªç½‘ç«™çš„ä»€ä¹ˆå†…å®¹ï¼ˆé€šè¿‡URIç¡®å®šï¼‰ï¼Œè¿›è€Œå¦‚æœæŸ¥æ‰¾åˆ°ï¼Œå°†å†…å®¹OBJç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚åŒæ—¶è¿˜éœ€è¦ä¸€ä¸ªæ—¶é—´æˆ³ä»¥åŠç”¨äºåŒæ­¥çš„è¯»å†™é”ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> *uri;</span><br><span class="line">    <span class="keyword">char</span> *obj;</span><br><span class="line">    <span class="keyword">int</span> objSize;</span><br><span class="line">    <span class="keyword">int64_t</span> time;</span><br><span class="line">    <span class="keyword">pthread_rwlock_t</span> rwlock; </span><br><span class="line">&#125; cache_line;</span><br></pre></td></tr></table></figure> ä¸€å…±æœ‰5ç§ç±»å‹çš„cacheï¼Œæ¯ç§ç±»å‹æœ‰ä¸€ä¸ªnumberï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘è¯¥ç§cacheç¬¬ä¸€å—çš„æŒ‡é’ˆpï¼ŒpæŒ‡å‘è¯¥ç§çš„ç¬¬ä¸€å°å—ï¼Œp+1æŒ‡å‘è¯¥ç§çš„ç¬¬äºŒå°å—ï¼Œä»¥æ­¤ç±»æ¨ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> numOfLine;</span><br><span class="line">    cache_line *cachep;</span><br><span class="line">&#125; cache_type;</span><br></pre></td></tr></table></figure> æ•°æ®ç»“æ„è®¾è®¡å®Œåï¼Œéœ€è¦è®¾è®¡å‡½æ•°æ¥å£ï¼Œcacheçš„æ“ä½œæœ‰åˆå§‹åŒ–ã€æŸ¥æ‰¾ã€å†™å…¥ï¼ˆæ›¿æ¢ï¼‰å’Œé‡Šæ”¾ï¼š åˆå§‹åŒ–éœ€è¦ä¸ºcache blockåˆ†é…ç©ºé—´ï¼Œå°†æ¯ä¸€å—çš„æ—¶é—´æˆ³ç½®0ï¼Œè¡¨ç¤ºè¯¥å—æ²¡æœ‰å­˜å‚¨å†…å®¹ï¼› æŸ¥æ‰¾æ—¶éœ€è¦éå†æ‰€æœ‰çš„typeï¼Œå†åœ¨è¯¥typeä¸­éå†æ‰€æœ‰çš„blockï¼Œå¦‚æœæ—¶é—´æˆ³ä¸ä¸º0ï¼Œæ¯”å¯¹æµè§ˆå™¨éœ€è¦è®¿é—®çš„URIä¸å½“å‰å—çš„URIæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¡¨ç¤ºcache hitï¼Œç›´æ¥å†™å›ç»™ç›¸åº”çš„fdï¼›æ›´æ–°æ—¶é—´æˆ³æ—¶ï¼Œç²’åº¦è¶Šç»†è¶Šå¥½ï¼Œè¿™é‡Œç”¨<code>gettimeofday</code>ç²¾ç¡®åˆ°å¾®ç§’çº§åˆ«ï¼›è¯»å–æ—¶å¦‚æœèƒ½ç”³è¯·åˆ°å†™é”ï¼Œå°±æ›´æ–°æ—¶é—´ï¼Œå¦åˆ™å°±ä¸æ›´æ–°ï¼› å†™å…¥æ—¶éœ€è¦å…ˆè®¡ç®—objectå¤§å°ï¼Œå¯»æ‰¾ç©ºé—²çš„cache blockï¼Œæ²¡æœ‰éœ€è¦æ›¿æ¢ï¼Œæ»¡è¶³è¦æ±‚åå­˜å…¥cacheï¼Œå¹¶ä¸”å°†ç»“æœè¿”ç»™æµè§ˆå™¨ã€‚è¿™é‡Œè¦æ³¨æ„å¯»æ‰¾ç©ºé—²å—æ—¶è¦<strong>ä»å°å¾€å¤§</strong>ï¼Œå¦åˆ™å¾ˆå¯èƒ½ä¸€ä¸ªå¾ˆå°çš„objectå ç”¨äº†ä¸€å—å¾ˆå¤§çš„blockï¼Œé€ æˆä¸¥é‡æµªè´¹ï¼Œç±»ä¼¼äºæ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åŠ¨æ€åˆ†é…ä¸­çš„æœ€ä½³é€‚åº”ç®—æ³•ã€‚ é‚£ä¹ˆè¿™ç§åˆ†çº§çš„æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šæ¯ç§ç±»å‹çš„cacheå—<strong>å¤§å°å›ºå®š</strong>ï¼Œå¾ˆå¯èƒ½50KBçš„å—åªå­˜äº†10KBå†…å®¹ï¼Œé€ æˆæµªè´¹ï¼Œç±»ä¼¼äºå›ºå®šåˆ†åŒºåˆ†é…ã€‚ å…³äºæ›¿æ¢ï¼Œæˆ‘ä»¬é‡‡å–<strong>å±€éƒ¨ç½®æ¢</strong>ç­–ç•¥ï¼šå³éœ€è¦æ¢å…¥çš„objectå¤§å°å¦‚æœæ˜¯30KBï¼Œæˆ‘ä»¬åªç”¨50KBè¿™ç§ç±»å‹å»å­˜å‚¨ï¼Œå¦‚æœ50KBçš„å—ç”¨å®Œäº†ï¼Œå°±éœ€è¦æ¢å‡ºä¸€å—50KBï¼Œå³ä½¿æ­¤æ—¶100KBçš„å—æœ‰ç©ºé—²ï¼Œä¹Ÿä»ç„¶å®Œæˆç½®æ¢è¿‡ç¨‹ã€‚</p>
<p>å†™å®Œcacheåï¼Œéœ€è¦ä¿®æ”¹<code>Makefile</code>ï¼Œåœ¨<code>proxy.c</code>ä¸­å¢åŠ cacheçš„éƒ¨åˆ†ã€‚è¿è¡Œå®Œä»¥åï¼Œå¯ä»¥ç”¨<code>make clean</code>æ¸…é™¤ç›®å½•ä¸‹å¤šä½™çš„åƒåœ¾æ–‡ä»¶ï¼Œæ¯”å¦‚<code>.o</code>æ–‡ä»¶ç­‰ã€‚ ## Test æµ‹è¯•çš„æ–¹å¼ä¸€å…±æœ‰3ç§ï¼š</p>
<ul>
<li>è‡ªåŠ¨åŒ–æµ‹è¯• åˆ©ç”¨è¯¾ç¨‹æä¾›çš„è„šæœ¬<code>driver.sh</code>è‡ªåŠ¨è¿›è¡Œï¼Œæ‰§è¡Œä¹‹å‰ï¼Œéœ€è¦å®‰è£…ä¸€äº›å·¥å…·ï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install net-tools</span><br></pre></td></tr></table></figure> åšå®Œæ‰€æœ‰å†…å®¹åï¼Œå…ˆç”¨<code>driver.sh</code>è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°cacheéƒ¨åˆ†æ²¡åˆ†ã€‚ã€‚ã€‚å¾—ï¼Œå¼€å§‹debugå§ï¼æˆ‘è§‰å¾—GDBå¥½éš¾ç”¨å•Šï¼Œæ‰€ä»¥éƒ½æ˜¯é€šè¿‡<code>printf</code>deçš„ã€‚</li>
</ul>
<p>ç”¨curlå…ˆé€šè¿‡proxyå‘ä¸ªè¯·æ±‚ï¼Œç„¶åçœ‹çœ‹proxyæœ‰æ²¡æœ‰ç¼“å­˜æœåŠ¡å™¨è¿”å›çš„å†…å®¹ã€‚ æœ€åå‘ç°åœ¨<code>write_cache</code>æ—¶éœ€è¦ç”¨åˆ°URIï¼Œä½†æ˜¯ä¹‹å‰è§£ææ—¶å€™æŠŠURIæ”¹äº†ï¼Œä¸€å®šæ³¨æ„URIæœ€å¥½ä¸è¦æ”¹ï¼Œè®¾ç½®ä¸º<code>const</code>æ¯”è¾ƒä¿é™©ã€‚</p>
<p>å®Œäº†ä»¥åï¼Œcacheæ»¡åˆ†äº†ï¼Œbasicåˆé”™äº†ä¸€ä¸ªï¼Œfetchå¯æ‰§è¡Œå¯¹è±¡æ–‡ä»¶tinyæ—¶ï¼š <img src="https://img-blog.csdnimg.cn/20200819212506210.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> ä¸€å¼€å§‹æ€€ç–‘æ˜¯tinyå¤ªå¤§äº†ï¼ŒæŸä¸ªæ•°ç»„çˆ†æ‰äº†ã€‚çœ‹äº†ä¸‹tinyæœ‰36000+Bï¼Œç¼“å­˜ç©ºé—´è¶³å¤Ÿï¼Œä½†æ˜¯å¯èƒ½å†™å…¥æ—¶å€™æœ‰äº›bugã€‚tinyæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯èƒ½æ¯”è¾ƒç‰¹æ®Šï¼Ÿå¾ˆå¥‡æ€ªçš„æ˜¯ï¼šæ˜æ˜<code>objSize</code>æ˜¯36000+ï¼Œä½†æ˜¯<code>strlen(obj)</code>åªæœ‰100ï¼Œæ€€ç–‘æ–‡ä»¶ä¸­å¯èƒ½æœ‰<code>\0</code>ï¼Œæå‰ç»ˆæ­¢äº†<code>strlen</code>çš„è®¡æ•°ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯<code>write_cache</code>å‚æ•°ä¸ä»…è¦æœ‰<code>uri</code>å’Œ<code>obj</code>ï¼Œè¿˜è¦æœ‰<code>obj</code>çš„é•¿åº¦<code>len</code>ï¼Œå¦åˆ™ç›´æ¥ç”¨<code>strlen</code>è·å–é•¿åº¦å¯èƒ½å°±æŒ‚äº†ã€‚åæ¥ä¿®æ”¹ä»¥åå°±æ»¡åˆ†äº†ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œå¦‚æœç”¨<code>char*</code>ä¼ å‚ï¼Œä¸€å®šè¦é™„å¸¦å‚æ•°<code>len</code>ï¼Œå› ä¸ºä¸ä¸€å®šè¯»å–çš„æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ<code>\0</code>ä¹Ÿå°±æ˜¯<code>0</code>å¾ˆå®¹æ˜“å‡ºç°ï¼Œç”¨<code>strlen</code>å¤§æ¦‚ç‡ä¼šçˆ†æ‰ã€‚</p>
<p>æœ€ç»ˆæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š <img src="https://img-blog.csdnimg.cn/20200819221810760.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> <img src="https://img-blog.csdnimg.cn/20200819221846500.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> - åˆ©ç”¨<code>curl</code>å·¥å…· <code>curl</code>å¯ä»¥ç”¨æ¥ç”ŸæˆHTTPè¯·æ±‚ï¼šå‡è®¾Severåœ¨ç«¯å£15213ç›‘å¬ï¼Œä»£ç†åœ¨ç«¯å£15214ç›‘å¬ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤ç»ç”±ä»£ç†å‘é€è¯·æ±‚ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v --proxy http:<span class="comment">//localhost:15214 http://localhost:15213/home.html</span></span><br></pre></td></tr></table></figure> æˆ‘ä»¬ç”¨è¯¥å·¥å…·æµ‹è¯•ä¸‹Sequential Web Proxyï¼š é¦–å…ˆå¯åŠ¨Tiny Web Serverå’ŒProxyï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./tiny 15213</span><br><span class="line">./proxy 15214</span><br></pre></td></tr></table></figure> ç„¶åæ‰§è¡Œ<code>curl</code>å‘½ä»¤ï¼š <img src="https://img-blog.csdnimg.cn/20200730162654329.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /> è¯´æ˜åŸºæœ¬åŠŸèƒ½æ˜¯OKçš„ï¼ï¼ - å®é™…æµè§ˆå™¨æµ‹è¯• æ»¡åˆ†ä¹‹åï¼Œä¸‡é‡Œé•¿å¾èµ°äº†ä¸€åŠå§ï¼Œå› ä¸ºè¦åœ¨å®é™…æµè§ˆå™¨æµ‹è¯•ï¼Œä¸æ–­å¢å¼ºç¨‹åºçš„<strong>é²æ£’æ€§</strong>ã€‚ æµ‹è¯•ä¹‹å‰ï¼Œå…ˆç¦ç”¨æµè§ˆå™¨è‡ªå¸¦çš„cacheï¼Œæ¸…ç©ºä¹‹å‰çš„ç¼“å­˜ã€‚ æµ‹ä¸‹å†…å­˜æ³„æ¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valgrind --leak-check=full --show-leak-kinds=all ./proxy 8080</span><br></pre></td></tr></table></figure>
<h2 id="codereference">Code&amp;Reference</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/EIMadrigal/15-213/tree/master/Web%20Proxy">code here</a> <a target="_blank" rel="noopener" href="http://csapp.cs.cmu.edu/3e/labs.html">reference here</a> ## TODO æ¥ä¸‹æ¥çš„å·¥ä½œå¯æ‹“å±•çš„è¿˜æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š - å¢åŠ å¯¹HTTPSçš„æ”¯æŒï¼ˆçœ‹èµ·æ¥å¹¶ä¸ç®€å•ï¼‰ - Cacheè¿™é‡Œè¿˜æœ‰å¾ˆå¤šå¯ä¼˜åŒ–çš„åœ°æ–¹ï¼ˆåˆ†é…ç­–ç•¥ã€ç½®æ¢ç­–ç•¥...ï¼‰ - ç›®å‰åªæ”¯æŒGETæ–¹å¼ï¼Œè¿˜å¯ä»¥æ‹“å±•åˆ°POSTæ–¹å¼</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="EIMadrigal"
      src="/images/favicon.png">
  <p class="site-author-name" itemprop="name">EIMadrigal</p>
  <div class="site-description" itemprop="description">Hello World</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">166</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/EIMadrigal" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;EIMadrigal" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:andrew.renj@gmail.com" title="E-Mail â†’ mailto:andrew.renj@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/EIMadrigal" title="cnblogs â†’ https:&#x2F;&#x2F;www.cnblogs.com&#x2F;EIMadrigal" rel="noopener" target="_blank"><i class="fab fa-codiepie fa-fw"></i>cnblogs</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/EIMadrigal" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;EIMadrigal" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018-02 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">EIMadrigal</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">Total views: <span id="busuanzi_value_site_pv"></span></span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">Total visitors: <span id="busuanzi_value_site_uv"></span></span>
    <span class="post-meta-divider">|</span>

<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);
    var countOffset = 20000;

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset);
            clearInterval(int);
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


</body>
</html>
